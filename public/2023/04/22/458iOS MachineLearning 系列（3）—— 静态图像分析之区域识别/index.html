<script src="https://eqcn.ajz.miesnfu.com/wp-content/plugins/wp-3d-pony/live2dw/lib/L2Dwidget.min.js"></script> 
<script>
　　let models = [
    "https://unpkg.com/live2d-widget-model-chitose@1.0.5/assets/chitose.model.json",
    "https://unpkg.com/live2d-widget-model-shizuku@1.0.5/assets/shizuku.model.json",
    "https://unpkg.com/live2d-widget-model-koharu@1.0.5/assets/koharu.model.json",
    "https://unpkg.com/live2d-widget-model-haruto@1.0.5/assets/haruto.model.json",
    "https://unpkg.com/live2d-widget-model-miku@1.0.5/assets/miku.model.json",
    "https://unpkg.com/live2d-widget-model-z16@1.0.5/assets/z16.model.json"
];
let m = models[Math.round(Math.random()*5)];
　　L2Dwidget.init({ 
　　"model": {jsonPath:m,"scale": 1 }, 
　　"display": { "position": "left", "width": 200, "height": 300,"hOffset": 0, "vOffset": -20 }, 
　　"mobile": { "show": true, "scale": 0.5 }, 
　　"react": { "opacityDefault": 0.7, "opacityOnHover": 0.2 } });
</script> 
<!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="珲少的技术博客">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <link rel="dns-prefetch" href="http://huishao.cc">
    <!--SEO-->

<meta name="description" content="珲少的技术博客">



<meta name="keywords" content="珲少">



<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">
    <!--Title-->


<title>iOS MachineLearning 系列（3）—— 静态图像分析之区域识别 | 珲少的技术博客</title>


    <link rel="alternate" href="/atom.xml" title="珲少的技术博客" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    





    
</head>

</html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  style="background-image:url(http://7xpw2b.com1.z0.glb.clouddn.com/hexo-sinppet/img/banner.png)"  >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='珲少'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
        	<!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
                <h2> 学如逆水行舟 </h2>
            
    	</div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://huishao.cc">珲少的技术博客</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>主页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/archives/"><i class="fa "></i>归档</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="iOS MachineLearning 系列（3）—— 静态图像分析之区域识别">
            
	            iOS MachineLearning 系列（3）—— 静态图像分析之区域识别
            
        </h1>
        <div class="post-meta">
    
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a href="/categories/从机器学习到AI">
            从机器学习到AI
        </a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
                
            
        </span>
    </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2023/04/22</span>
        </span>
    
</div>

            
            
    </div>
    
    <div class="post-body post-content">
        <h1 id="iOS-MachineLearning-系列（3）——-静态图像分析之区域识别"><a href="#iOS-MachineLearning-系列（3）——-静态图像分析之区域识别" class="headerlink" title="iOS MachineLearning 系列（3）—— 静态图像分析之区域识别"></a>iOS MachineLearning 系列（3）—— 静态图像分析之区域识别</h1><p>本系列的前一篇文章介绍了如何使用iOS中自带的API对图片中的矩形区域进行分析。在图像静态分析方面，矩形区域分析是非常基础的部分。API还提供了更多面向应用的分析能力，如文本区域分析，条形码二维码的分析，人脸区域分析，人体分析等。本篇文章主要介绍这些分析API的应用。关于矩形识别的基础文章，链接如下：</p>
<p><a href="https://my.oschina.net/u/2340880/blog/8671152" target="_blank" rel="noopener">https://my.oschina.net/u/2340880/blog/8671152</a></p>
<h2 id="1-文本区域分析"><a href="#1-文本区域分析" class="headerlink" title="1 - 文本区域分析"></a>1 - 文本区域分析</h2><p>文本区域分析相比矩形区域分析更加上层，其API接口也更加简单。分析请求的创建示例如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> textDetectionRequest: <span class="type">VNDetectTextRectanglesRequest</span> = &#123;</span><br><span class="line">    <span class="keyword">let</span> textDetectRequest = <span class="type">VNDetectTextRectanglesRequest</span> &#123; request, error <span class="keyword">in</span></span><br><span class="line">        <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">            <span class="keyword">self</span>.drawTask(request: request <span class="keyword">as</span>! <span class="type">VNDetectTextRectanglesRequest</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 是否报告字符边框区域</span></span><br><span class="line">    textDetectRequest.reportCharacterBoxes = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">return</span> textDetectRequest</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure>
<p>其请求的发起方式，回调结果的处理与矩形分析一文中介绍的一致，这里就不再赘述。唯一不同的是，其分析的结果中新增了characterBoxes属性，用来获取每个字符的所在区域。</p>
<p>文本区域识别效果如下图所示：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-3090f1a99c656a9d19cdd4931894a5b31e7.png" alt></p>
<h2 id="2-条形码二维码识别"><a href="#2-条形码二维码识别" class="headerlink" title="2 - 条形码二维码识别"></a>2 - 条形码二维码识别</h2><p>条形码和二维码在生活中非常常见，Vision框架中提供的API不仅支持条码区域的检测，还可以直接将条码的内容识别出来。</p>
<p>条码分析请求使用VNDetectBarcodesRequest类创建，如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">VNDetectBarcodesRequest</span> : <span class="title">VNImageBasedRequest</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 类属性，获取所支持的条码类型</span></span><br><span class="line">    <span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">var</span> <span class="title">supportedSymbologies</span>: [<span class="title">VNBarcodeSymbology</span>] </span>&#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 设置分析时要支持的条码类型</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> symbologies: [<span class="type">VNBarcodeSymbology</span>]</span><br><span class="line">    <span class="comment">// 结果列表</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> results: [<span class="type">VNBarcodeObservation</span>]? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果我们不对symbologies属性进行设置，则默认会尝试识别所有支持的类型。示例代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="built_in">lazy</span> <span class="keyword">var</span> barCodeDetectionRequest: <span class="type">VNDetectBarcodesRequest</span> = &#123;</span><br><span class="line">    <span class="keyword">let</span> barCodeDetectRequest = <span class="type">VNDetectBarcodesRequest</span> &#123;[<span class="keyword">weak</span> <span class="keyword">self</span>] request, error <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> <span class="keyword">self</span> <span class="keyword">else</span> &#123;<span class="keyword">return</span>&#125;</span><br><span class="line">        <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">            <span class="keyword">self</span>.drawTask(request: request <span class="keyword">as</span>! <span class="type">VNDetectBarcodesRequest</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    barCodeDetectRequest.revision = <span class="type">VNDetectBarcodesRequestRevision1</span></span><br><span class="line">    <span class="keyword">return</span> barCodeDetectRequest</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure>
<p>需要注意，实测需要将分析所使用的算法版本revision设置为VNDetectBarcodesRequestRevision1。默认使用的版本可能无法分析出结果。</p>
<p>条码分析的结果类VNBarcodeObservation中会封装条码的相关数据，如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">VNBarcodeObservation</span> : <span class="title">VNRectangleObservation</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 当前条码的类型</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> symbology: <span class="type">VNBarcodeSymbology</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 条码的描述对象，不同类型的条码会有不同的子类实现</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> barcodeDescriptor: <span class="type">CIBarcodeDescriptor</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 条码内容</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> payloadStringValue: <span class="type">String</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>VNBarcodeObservation类也是继承自VNRectangleObservation类的，因此其也可以分析出条码所在的区域，需要注意，对于条形码来说其只能分析出条码的位置，对于二维码来说，其可以准确的识别出二维码的区域，如下图所示：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-941384f0b46f09489de8a687de22b608419.png" alt></p>
<p><img src="https://oscimg.oschina.net/oscnet/up-1b8ff45db111639e4d8e8b55d87f03e1756.png" alt></p>
<p>注：互联网上有很多可以生成条码的工具，例如：</p>
<p><a href="https://www.idcd.com/tool/barcode/encode" target="_blank" rel="noopener">https://www.idcd.com/tool/barcode/encode</a></p>
<h2 id="3-轮廓检测"><a href="#3-轮廓检测" class="headerlink" title="3 - 轮廓检测"></a>3 - 轮廓检测</h2><p>相比前面两种图像分析能力，轮廓检测的能力要更加复杂也更加强大一些。其可以通过图片的对比度差异来对内容轮廓进行分析。轮廓分析使用VNDetectContoursRequest类来创建请求。此类主要功能列举如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">VNDetectContoursRequest</span> : <span class="title">VNImageBasedRequest</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 轮廓检测时的对比度设置，取值0-3之间，此值越大，检测结果越精确（对于高对比度图片）</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> contrastAdjustment: <span class="type">Float</span></span><br><span class="line">    <span class="comment">// 作为对比度分界的像素，取值0-1之间，默认0.5，会取居中值</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> contrastPivot: <span class="type">NSNumber</span>?</span><br><span class="line">    <span class="comment">// 设置检测时是否是检测暗色对象，默认为true，即认为背景色浅。设置为false则会在暗色图中检测明亮的对象轮廓</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> detectsDarkOnLight: <span class="type">Bool</span></span><br><span class="line">    <span class="comment">// 设置检测图片时的缩放，轮廓检测会将图片进行压缩，此值取值范围为[64..NSUIntegerMax]，取最大值时表示使用原图</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> maximumImageDimension: <span class="type">Int</span></span><br><span class="line">    <span class="comment">// 结果数组</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> results: [<span class="type">VNContoursObservation</span>]? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其检测结果VNContoursObservation类中封装了轮廓的路径信息，在进行轮廓检测时，最外层的轮廓可能有很多内层轮廓组成，这些信息也封装在此类中。如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">VNContoursObservation</span> : <span class="title">VNObservation</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 内部轮廓个数</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> contourCount: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 获取指定的轮廓对象</span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">contour</span><span class="params">(at contourIndex: Int)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">VNContour</span></span><br><span class="line">    <span class="comment">// 顶级轮廓个数</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> topLevelContourCount: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 顶级轮廓数组</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> topLevelContours: [<span class="type">VNContour</span>] &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 根据indexPath获取轮廓对象</span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">contour</span><span class="params">(at indexPath: IndexPath)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">VNContour</span></span><br><span class="line">    <span class="comment">// 路径，会包含内部所有轮廓</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> normalizedPath: <span class="type">CGPath</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需要注意，其返回的CGPath路径依然是以单位矩形为参照的，我们要将其绘制出来，需要对其进行转换，转换其实非常简单，现对其进行方法，并进行x轴方向的镜像反转，之后向下进行平移一个标准单位即可。示例如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">drawTask</span><span class="params">(request: VNDetectContoursRequest)</span></span> &#123;</span><br><span class="line">    boxViews.forEach &#123; v <span class="keyword">in</span></span><br><span class="line">        v.removeFromSuperview()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> result <span class="keyword">in</span> request.results ?? [] &#123;</span><br><span class="line">        <span class="keyword">let</span> oriPath = result.normalizedPath</span><br><span class="line">        <span class="keyword">var</span> transform = <span class="type">CGAffineTransform</span>.identity.scaledBy(x: imageView.frame.width, y: -imageView.frame.height).translatedBy(x: <span class="number">0</span>, y: -<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">let</span> layer = <span class="type">CAShapeLayer</span>()</span><br><span class="line">        <span class="keyword">let</span> path = oriPath.copy(using: &amp;transform)</span><br><span class="line">        layer.bounds = <span class="keyword">self</span>.imageView.bounds</span><br><span class="line">        layer.anchorPoint = <span class="type">CGPoint</span>(x: <span class="number">0</span>, y: <span class="number">0</span>)</span><br><span class="line">        imageView.layer.addSublayer(layer)</span><br><span class="line">        layer.path = path</span><br><span class="line">        layer.strokeColor = <span class="type">UIColor</span>.blue.cgColor</span><br><span class="line">        layer.backgroundColor = <span class="type">UIColor</span>.white.cgColor</span><br><span class="line">        layer.fillColor = <span class="type">UIColor</span>.gray.cgColor</span><br><span class="line">        layer.lineWidth = <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>原图与绘制的轮廓图如下所示：</p>
<p>原图：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-dc1398141a420ba81920ba62e3299f88319.png" alt></p>
<p>轮廓：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-e9a75fb7f6b267b0270c7606b481b15c49e.png" alt></p>
<p>可以通过VNContoursObservation对象来获取其内的所有轮廓对象，VNContour定义如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">VNContour</span> : <span class="title">NSObject</span>, <span class="title">NSCopying</span>, <span class="title">VNRequestRevisionProviding</span> </span>&#123;</span><br><span class="line">    <span class="comment">// indexPath</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> indexPath: <span class="type">IndexPath</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 子轮廓个数</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> childContourCount: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 子轮廓对象数组</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> childContours: [<span class="type">VNContour</span>] &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 通过index获取子轮廓</span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">childContour</span><span class="params">(at childContourIndex: Int)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">VNContour</span></span><br><span class="line">    <span class="comment">// 描述轮廓的点数</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> pointCount: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 轮廓路径</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> normalizedPath: <span class="type">CGPath</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 轮廓的纵横比</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> aspectRatio: <span class="type">Float</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 简化的多边形轮廓，参数设置简化的阈值</span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">polygonApproximation</span><span class="params">(epsilon: Float)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">VNContour</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>理论上说，我们对所有的子轮廓进行绘制，也能得到一样的路径图像，例如：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">drawTask</span><span class="params">(request: VNDetectContoursRequest)</span></span> &#123;</span><br><span class="line">    boxViews.forEach &#123; v <span class="keyword">in</span></span><br><span class="line">        v.removeFromSuperview()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> result <span class="keyword">in</span> request.results ?? [] &#123;</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span> ..&lt; result.contourCount &#123;</span><br><span class="line">            <span class="keyword">let</span> contour = <span class="keyword">try</span>! result.contour(at: i)</span><br><span class="line">            <span class="keyword">var</span> transform = <span class="type">CGAffineTransform</span>.identity.scaledBy(x: imageView.frame.width, y: -imageView.frame.height).translatedBy(x: <span class="number">0</span>, y: -<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">let</span> layer = <span class="type">CAShapeLayer</span>()</span><br><span class="line">            <span class="keyword">let</span> path = contour.normalizedPath.copy(using: &amp;transform)</span><br><span class="line">            layer.bounds = <span class="keyword">self</span>.imageView.bounds</span><br><span class="line">            layer.anchorPoint = <span class="type">CGPoint</span>(x: <span class="number">0</span>, y: <span class="number">0</span>)</span><br><span class="line">            imageView.layer.addSublayer(layer)</span><br><span class="line">            layer.path = path</span><br><span class="line">            layer.strokeColor = <span class="type">UIColor</span>.blue.cgColor</span><br><span class="line">            layer.backgroundColor = <span class="type">UIColor</span>.clear.cgColor</span><br><span class="line">            layer.fillColor = <span class="type">UIColor</span>.clear.cgColor</span><br><span class="line">            layer.lineWidth = <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下图：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-90f52ae0cec78c332d643ff4924c4fe7fb0.png" alt></p>
<h2 id="4-文档区域识别"><a href="#4-文档区域识别" class="headerlink" title="4 - 文档区域识别"></a>4 - 文档区域识别</h2><p>文档识别可以分析出图片中的文本段落，使用VNDetectDocumentSegmentationRequest来创建分析请求，VNDetectDocumentSegmentationRequest没有额外特殊的属性，其分析结果为一组VNRectangleObservation对象，可以获取到文档所在的矩形区域。这里不再过多解说。</p>
<h2 id="5-人脸区域识别"><a href="#5-人脸区域识别" class="headerlink" title="5 - 人脸区域识别"></a>5 - 人脸区域识别</h2><p>人脸识别在生活中也有着很广泛的应用，在进行人脸对比识别等高级处理前，我们通常需要将人脸的区域先提取出来，Vision框架中也提供了人脸区域识别的接口，使用VNDetectFaceRectanglesRequest类来创建请求即可。VNDetectFaceRectanglesRequest类本身比较加单，继承自VNImageBasedRequest类，无需进行额外的配置即可使用，其分析的结果为一组VNFaceObservation对象，分析效果如下图所示：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-a57d29b95c0f2729d725bae6bfd4f509089.png" alt></p>
<p>VNFaceObservation类本身是继承自VNDetectedObjectObservation类的，因此我们可以直接获取到人脸的区域。VNFaceObservation中还有许多其他有用的信息：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">VNFaceObservation</span> : <span class="title">VNDetectedObjectObservation</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 面部特征对象</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> landmarks: <span class="type">VNFaceLandmarks2D</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 人脸在z轴的旋转度数，取值为-PI到PI之间</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> roll: <span class="type">NSNumber</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 人脸在y轴的旋转度数，取值为-PI/2到PI/2之间</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> yaw: <span class="type">NSNumber</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 人脸在x轴的旋转度数，取值为-PI/2到PI/2之间</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> pitch: <span class="type">NSNumber</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过roll，yaw和pitch这3个属性，我们可以获取到人脸在空间中的角度相关信息。landmarks属性则比较复杂，其封装了人脸的特征点。并且VNDetectFaceRectanglesRequest请求是不会分析面部特征的，此属性会为nil，关于面部特征，我们后续介绍。</p>
<p>人脸特征分析请求使用VNDetectFaceLandmarksRequest创建，其返回的结果中会有landmarks数据，示例代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">drawTask</span><span class="params">(request: VNDetectFaceLandmarksRequest)</span></span> &#123;</span><br><span class="line">    boxViews.forEach &#123; v <span class="keyword">in</span></span><br><span class="line">        v.removeFromSuperview()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> result <span class="keyword">in</span> request.results ?? [] &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> box = result.boundingBox</span><br><span class="line">        <span class="comment">// 坐标系转换</span></span><br><span class="line">        box.origin.y = <span class="number">1</span> - box.origin.y - box.size.height</span><br><span class="line">        <span class="keyword">let</span> v = <span class="type">UIView</span>()</span><br><span class="line">        v.backgroundColor = .clear</span><br><span class="line">        v.layer.borderColor = <span class="type">UIColor</span>.red.cgColor</span><br><span class="line">        v.layer.borderWidth = <span class="number">2</span></span><br><span class="line">        imageView.addSubview(v)</span><br><span class="line">        <span class="keyword">let</span> size = imageView.frame.size</span><br><span class="line">        v.frame = <span class="type">CGRect</span>(x: box.origin.x * size.width, y: box.origin.y * size.height, width: box.size.width * size.width, height: box.size.height * size.height)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 进行特征绘制</span></span><br><span class="line">        <span class="keyword">let</span> landmarks = result.landmarks</span><br><span class="line">        <span class="comment">// 拿到所有特征点</span></span><br><span class="line">        <span class="keyword">let</span> allPoints = landmarks?.allPoints?.normalizedPoints</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> faceRect = result.boundingBox</span><br><span class="line">        <span class="comment">// 进行绘制</span></span><br><span class="line">        <span class="keyword">for</span> point <span class="keyword">in</span> allPoints ?? [] &#123;</span><br><span class="line">            <span class="comment">//faceRect的宽高是个比例，我们对应转换成View上的人脸区域宽高</span></span><br><span class="line">            <span class="keyword">let</span> rectWidth = imageView.frame.width * faceRect.width</span><br><span class="line">            <span class="keyword">let</span> rectHeight = imageView.frame.height * faceRect.height</span><br><span class="line">            <span class="comment">// 进行坐标转换</span></span><br><span class="line">            <span class="comment">// 特征点的x坐标为人脸区域的比例，</span></span><br><span class="line">            <span class="comment">// 1. point.x * rectWidth 得到在人脸区域内的x位置</span></span><br><span class="line">            <span class="comment">// 2. + faceRect.minX * imageView.frame.width 得到在View上的x坐标</span></span><br><span class="line">            <span class="comment">// 3. point.y * rectHeight + faceRect.minY * imageView.frame.height获得Y坐标</span></span><br><span class="line">            <span class="comment">// 4. imageView.frame.height -  的作用是y坐标进行翻转</span></span><br><span class="line">            <span class="keyword">let</span> tempPoint = <span class="type">CGPoint</span>(x: point.x * rectWidth + faceRect.minX * imageView.frame.width, y: imageView.frame.height - (point.y * rectHeight + faceRect.minY * imageView.frame.height))</span><br><span class="line">            <span class="keyword">let</span> subV = <span class="type">UIView</span>()</span><br><span class="line">            subV.backgroundColor = .red</span><br><span class="line">            subV.frame = <span class="type">CGRect</span>(x: tempPoint.x - <span class="number">2</span>, y: tempPoint.y - <span class="number">2</span>, width: <span class="number">4</span>, height: <span class="number">4</span>)</span><br><span class="line">            imageView.addSubview(subV)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>VNFaceLandmarks2D中封装了很多特征信息，上面的示例代码会将所有的特征点进行绘制，我们也可以根据需要取部分特征点：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">VNFaceLandmarks2D</span> : <span class="title">VNFaceLandmarks</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 所有特征点</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> allPoints: <span class="type">VNFaceLandmarkRegion2D</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 只包含面部轮廓的特征点</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> faceContour: <span class="type">VNFaceLandmarkRegion2D</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 左眼位置的特征点</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> leftEye: <span class="type">VNFaceLandmarkRegion2D</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 右眼位置的特征点</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> rightEye: <span class="type">VNFaceLandmarkRegion2D</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 左眉特征点</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> leftEyebrow: <span class="type">VNFaceLandmarkRegion2D</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 右眉特征点</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> rightEyebrow: <span class="type">VNFaceLandmarkRegion2D</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 鼻子特征点</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> nose: <span class="type">VNFaceLandmarkRegion2D</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 鼻尖特征点</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> noseCrest: <span class="type">VNFaceLandmarkRegion2D</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 中间特征点</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> medianLine: <span class="type">VNFaceLandmarkRegion2D</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 外唇特征点</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> outerLips: <span class="type">VNFaceLandmarkRegion2D</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 内唇特征点</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> innerLips: <span class="type">VNFaceLandmarkRegion2D</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 左瞳孔特征点</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> leftPupil: <span class="type">VNFaceLandmarkRegion2D</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 右瞳孔特征点</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> rightPupil: <span class="type">VNFaceLandmarkRegion2D</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>VNFaceLandmarkRegion2D类中具体封装了特征点位置信息，需要注意，特征点的坐标是相对人脸区域的比例值，要进行转换。</p>
<p><strong>主要提示：特征检测在模拟器上可能不能正常工作，可以使用真机测试。</strong></p>
<p>默认人脸特征分析会返回76个特征点，我们可以通过设置VNDetectFaceLandmarksRequest请求实例的constellation属性来修改使用的检测算法，枚举如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">VNRequestFaceLandmarksConstellation</span> : <span class="title">UInt</span>, @<span class="title">unchecked</span> <span class="title">Sendable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> constellationNotDefined = <span class="number">0</span></span><br><span class="line">    <span class="comment">// 使用65个特征点的算法</span></span><br><span class="line">    <span class="keyword">case</span> constellation65Points = <span class="number">1</span></span><br><span class="line">    <span class="comment">// 使用73个特征点的算法</span></span><br><span class="line">    <span class="keyword">case</span> constellation76Points = <span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下图：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-c685c2f1c704b912ccef0602b610bff8b94.png" alt></p>
<p>Vision框架的静态区域分析中与人脸分析相关的还有一种，使用VNDetectFaceCaptureQualityRequest请求可以分析当前捕获到的人脸的质量，使用此请求分析的结果中会包含如下属性：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">VNFaceObservation</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 人脸捕获的质量</span></span><br><span class="line">    <span class="meta">@nonobjc</span> <span class="keyword">public</span> <span class="keyword">var</span> faceCaptureQuality: <span class="type">Float</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>faceCaptureQualit值越接近1，捕获的人脸效果越好。</p>
<h2 id="6-水平线识别"><a href="#6-水平线识别" class="headerlink" title="6 - 水平线识别"></a>6 - 水平线识别</h2><p>VNDetectHorizonReques用来创建水平线分析请求，其可以分析出图片中的水平线位置。此请求本身比较简单，其返回的结果对象为VNHorizonObservation，如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">VNHorizonObservation</span> : <span class="title">VNObservation</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 角度</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> angle: <span class="type">CGFloat</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分析结果如下图所示：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-64dd93cfaeaf3f4b1b7a9d1c904f7695145.png" alt></p>
<h2 id="7-人体相关识别"><a href="#7-人体相关识别" class="headerlink" title="7 - 人体相关识别"></a>7 - 人体相关识别</h2><p>人体姿势识别也是Vision框架非常强大的一个功能，其可以将静态图像中人体的关键节点分析出来，通过这些关键节点，我们可以对人体当前的姿势进行推断。在运动矫正，健康检查等应用中应用广泛。人体姿势识别请求使用VNDetectHumanBodyPoseRequest类创建，如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">VNDetectHumanBodyPoseRequest</span> : <span class="title">VNImageBasedRequest</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 获取所支持检查的关键节点</span></span><br><span class="line">    <span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">supportedJointNames</span>(<span class="title">forRevision</span> <span class="title">revision</span>: <span class="title">Int</span>) <span class="title">throws</span> -&gt; [<span class="title">VNHumanBodyPoseObservation</span>.<span class="title">JointName</span>]</span></span><br><span class="line"><span class="class">    // 获取所支持检查的关键节组</span></span><br><span class="line"><span class="class">    <span class="title">open</span> <span class="title">class</span> <span class="title">func</span> <span class="title">supportedJointsGroupNames</span>(<span class="title">forRevision</span> <span class="title">revision</span>: <span class="title">Int</span>) <span class="title">throws</span> -&gt; [<span class="title">VNHumanBodyPoseObservation</span>.<span class="title">JointsGroupName</span>]</span></span><br><span class="line"><span class="class">    // 分析结果</span></span><br><span class="line"><span class="class">    <span class="title">open</span> <span class="title">var</span> <span class="title">results</span>: [<span class="title">VNHumanBodyPoseObservation</span>]? </span>&#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>VNHumanBodyPoseObservatio分析结果类中封装的有各个关键节点的坐标信息，如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">VNHumanBodyPoseObservation</span> : <span class="title">VNRecognizedPointsObservation</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 可用的节点名</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> availableJointNames: [<span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointName</span>] &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 可用的节点组名</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> availableJointsGroupNames: [<span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointsGroupName</span>] &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 获取某个节点坐标</span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">recognizedPoint</span><span class="params">(<span class="number">_</span> jointName: VNHumanBodyPoseObservation.JointName)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">VNRecognizedPoint</span></span><br><span class="line">    <span class="comment">// 获取某个节点组</span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">recognizedPoints</span><span class="params">(<span class="number">_</span> jointsGroupName: VNHumanBodyPoseObservation.JointsGroupName)</span></span> <span class="keyword">throws</span> -&gt; [<span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointName</span> : <span class="type">VNRecognizedPoint</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面示例代码演示了如何对身体姿势节点进行解析：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">drawTask</span><span class="params">(request: VNDetectHumanBodyPoseRequest)</span></span> &#123;</span><br><span class="line">    boxViews.forEach &#123; v <span class="keyword">in</span></span><br><span class="line">        v.removeFromSuperview()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> result <span class="keyword">in</span> request.results ?? [] &#123;</span><br><span class="line">        <span class="keyword">for</span> point <span class="keyword">in</span> result.availableJointNames &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> p = <span class="keyword">try</span>? result.recognizedPoint(point) &#123;</span><br><span class="line">                <span class="keyword">let</span> v = <span class="type">UIView</span>(frame: <span class="type">CGRect</span>(x: p.x * imageView.bounds.width - <span class="number">2</span>, y: (<span class="number">1</span> - p.y) * imageView.bounds.height - <span class="number">2.0</span>, width: <span class="number">4</span>, height: <span class="number">4</span>))</span><br><span class="line">                imageView.addSubview(v)</span><br><span class="line">                v.backgroundColor = .red</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下图：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-b18855d8efe967f4b00a239bd8b766ee9d9.png" alt></p>
<p>所有支持的身体节点名和节点组名列举如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 身体节点</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">VNHumanBodyPoseObservation</span>.<span class="title">JointName</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 鼻子节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> nose: <span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="comment">// 左眼节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> leftEye: <span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="comment">// 右眼节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> rightEye: <span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="comment">// 左耳节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> leftEar: <span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="comment">// 右耳节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> rightEar: <span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="comment">// 左肩节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> leftShoulder: <span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="comment">// 右肩节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> rightShoulder: <span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="comment">// 脖子节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> neck: <span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="comment">// 左肘节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> leftElbow: <span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="comment">// 右肘节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> rightElbow: <span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="comment">// 左腕节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> leftWrist: <span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="comment">// 右腕节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> rightWrist: <span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="comment">// 左髋节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> leftHip: <span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="comment">// 右髋节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> rightHip: <span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="comment">// 身体节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> root: <span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="comment">// 左膝节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> leftKnee: <span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="comment">// 右膝节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> rightKnee: <span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="comment">// 左踝节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> leftAnkle: <span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="comment">// 右踝节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> rightAnkle: <span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 节点组</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">VNHumanBodyPoseObservation</span>.<span class="title">JointsGroupName</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 面部节点组</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> face: <span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointsGroupName</span></span><br><span class="line">    <span class="comment">// 躯干节点组</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> torso: <span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointsGroupName</span> </span><br><span class="line">    <span class="comment">// 左臂节点组</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> leftArm: <span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointsGroupName</span> </span><br><span class="line">     <span class="comment">// 右臂节点组</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> rightArm: <span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointsGroupName</span> </span><br><span class="line">    <span class="comment">// 左腿节点组</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> leftLeg: <span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointsGroupName</span> </span><br><span class="line">    <span class="comment">// 右腿节点组</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> rightLeg: <span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointsGroupName</span> </span><br><span class="line">    <span class="comment">// 所有节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> all: <span class="type">VNHumanBodyPoseObservation</span>.<span class="type">JointsGroupName</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>与人体姿势识别类似，VNDetectHumanHandPoseRequest用来对手势进行识别，VNDetectHumanHandPoseRequest定义如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">VNDetectHumanHandPoseRequest</span> : <span class="title">VNImageBasedRequest</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 支持的手势节点</span></span><br><span class="line">    <span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">supportedJointNames</span>(<span class="title">forRevision</span> <span class="title">revision</span>: <span class="title">Int</span>) <span class="title">throws</span> -&gt; [<span class="title">VNHumanHandPoseObservation</span>.<span class="title">JointName</span>]</span></span><br><span class="line"><span class="class">    // 支持的手势节点组</span></span><br><span class="line"><span class="class">    <span class="title">open</span> <span class="title">class</span> <span class="title">func</span> <span class="title">supportedJointsGroupNames</span>(<span class="title">forRevision</span> <span class="title">revision</span>: <span class="title">Int</span>) <span class="title">throws</span> -&gt; [<span class="title">VNHumanHandPoseObservation</span>.<span class="title">JointsGroupName</span>]</span></span><br><span class="line"><span class="class">    // 设置最大支持的检测人手数量，默认2，最大6</span></span><br><span class="line"><span class="class">    <span class="title">open</span> <span class="title">var</span> <span class="title">maximumHandCount</span>: <span class="title">Int</span></span></span><br><span class="line"><span class="class">    // 识别结果</span></span><br><span class="line"><span class="class">    <span class="title">open</span> <span class="title">var</span> <span class="title">results</span>: [<span class="title">VNHumanHandPoseObservation</span>]? </span>&#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>VNHumanHandPoseObservation类的定义如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">VNHumanHandPoseObservation</span> : <span class="title">VNRecognizedPointsObservation</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 可用的节点名</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> availableJointNames: [<span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointName</span>] &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 可用的节点组名</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> availableJointsGroupNames: [<span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointsGroupName</span>] &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 获取坐标点</span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">recognizedPoint</span><span class="params">(<span class="number">_</span> jointName: VNHumanHandPoseObservation.JointName)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">VNRecognizedPoint</span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">recognizedPoints</span><span class="params">(<span class="number">_</span> jointsGroupName: VNHumanHandPoseObservation.JointsGroupName)</span></span> <span class="keyword">throws</span> -&gt; [<span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointName</span> : <span class="type">VNRecognizedPoint</span>]</span><br><span class="line">    <span class="comment">// 获取手性</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> chirality: <span class="type">VNChirality</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>chiralit属性用来识别左右手，枚举如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@frozen <span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">VNChirality</span> : <span class="title">Int</span>, @<span class="title">unchecked</span> <span class="title">Sendable</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 未知</span></span><br><span class="line">    <span class="keyword">case</span> unknown = <span class="number">0</span></span><br><span class="line">    <span class="comment">// 左手</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">left</span> = -<span class="number">1</span></span><br><span class="line">    <span class="comment">// 右手</span></span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">right</span> = <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在手势识别中，可用的节点名列举如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">VNHumanHandPoseObservation</span>.<span class="title">JointName</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 手腕节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> wrist: <span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="comment">// 拇指关节节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> thumbCMC: <span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> thumbMP: <span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> thumbIP: <span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> thumbTip: <span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 食指关节节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> indexMCP: <span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> indexPIP: <span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> indexDIP: <span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> indexTip: <span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 中指关节节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> middleMCP: <span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> middlePIP: <span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> middleDIP: <span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> middleTip: <span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 无名指关节节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> ringMCP: <span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> ringPIP: <span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> ringDIP: <span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> ringTip: <span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 小指关节节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> littleMCP: <span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> littlePIP: <span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> littleDIP: <span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> littleTip: <span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointName</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">VNHumanHandPoseObservation</span>.<span class="title">JointsGroupName</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 拇指</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> thumb: <span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointsGroupName</span></span><br><span class="line">    <span class="comment">// 食指</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> indexFinger: <span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointsGroupName</span></span><br><span class="line">    <span class="comment">// 中指</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> middleFinger: <span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointsGroupName</span></span><br><span class="line">    <span class="comment">// 无名指</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> ringFinger: <span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointsGroupName</span></span><br><span class="line">    <span class="comment">// 小指</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> littleFinger: <span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointsGroupName</span></span><br><span class="line">    <span class="comment">// 全部</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> all: <span class="type">VNHumanHandPoseObservation</span>.<span class="type">JointsGroupName</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下图：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-ad80dd6039f6dc72a9cb3eb9e0b4684933b.png" alt></p>
<p>如果我们只需要识别人体的躯干部位，则使用VNDetectHumanRectanglesRequest会非常方便，VNDetectHumanRectanglesRequest定义如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">VNDetectHumanRectanglesRequest</span> : <span class="title">VNImageBasedRequest</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 设置是否仅仅检测上半身，默认为true</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> upperBodyOnly: <span class="type">Bool</span></span><br><span class="line">    <span class="comment">// 分析结果</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> results: [<span class="type">VNHumanObservation</span>]? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>人体躯干识别的结果用法与矩形识别类似，效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-b223d4620e89caa6bf3f82ed2e627849f62.png" alt></p>
<p><strong>需要注意：人体姿势识别和手势识别的API在模拟器上可能无法正常的工作。</strong></p>
<p>本篇文章，我们介绍了许多关于静态图像区域分析和识别的API，这些接口功能强大，且设计的非常简洁。文本中所涉及到的代码，都可以在如下Demo中找到：</p>
<p><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2FZYHshao%2FMachineLearnDemo" target="_blank" rel="noopener">https://github.com/ZYHshao/MachineLearnDemo</a></p>
<blockquote>
<p>专注技术，懂的热爱，愿意分享，做个朋友</p>
</blockquote>

    </div>

    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © 微信：15137348047
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
    
        <a href="/2023/04/18/457iOS MachineLearning 系列（2）—— 静态图像分析之矩形识别/" class="next-post btn btn-default" title='iOS MachineLearning 系列（2）—— 静态图像分析之矩形识别'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">iOS MachineLearning 系列（2）—— 静态图像分析之矩形识别</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
<div id="lv-container" data-id="city" data-uid="MTAyMC8zNzY0Ny8xNDE3OA==">
  <script type="text/javascript">
     (function(d, s) {
         var j, e = d.getElementsByTagName(s)[0];
         if (typeof LivereTower === 'function') { return; }
         j = d.createElement(s);
         j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
         j.async = true;
         e.parentNode.insertBefore(j, e);
     })(document, 'script');
  </script>
</div>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#iOS-MachineLearning-系列（3）——-静态图像分析之区域识别"><span class="toc-text">iOS MachineLearning 系列（3）—— 静态图像分析之区域识别</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-文本区域分析"><span class="toc-text">1 - 文本区域分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-条形码二维码识别"><span class="toc-text">2 - 条形码二维码识别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-轮廓检测"><span class="toc-text">3 - 轮廓检测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-文档区域识别"><span class="toc-text">4 - 文档区域识别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-人脸区域识别"><span class="toc-text">5 - 人脸区域识别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-水平线识别"><span class="toc-text">6 - 水平线识别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-人体相关识别"><span class="toc-text">7 - 人体相关识别</span></a></li></ol></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12"> 
                <span>Copyright &copy; 2018
                </span> | 
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> | 
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



<script src="/js/app.js?rev=@@hash"></script>


</body>
</html>
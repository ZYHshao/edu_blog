<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="珲少的技术博客">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <link rel="dns-prefetch" href="http://huishao.cc">
    <!--SEO-->

<meta name="description" content="珲少的技术博客"/>



<meta name="keywords" content="珲少"/>



<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />
    <!--Title-->


<title>iOS中WebKit框架应用与解析 | 珲少的技术博客</title>


    <link rel="alternate" href="/atom.xml" title="珲少的技术博客" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    





    
</head>


<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  style="background-image:url(http://7xpw2b.com1.z0.glb.clouddn.com/hexo-sinppet/img/banner.png)"  >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='珲少'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
        	<!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
                <h2> 学如逆水行舟 </h2>
            
    	</div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://huishao.cc">珲少的技术博客</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>主页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/archives/"><i class="fa "></i>归档</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="iOS中WebKit框架应用与解析">
            
	            iOS中WebKit框架应用与解析
            
        </h1>
        <div class="post-meta">
    
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a href="/categories/iOS逻辑初窥">
            iOS逻辑初窥
        </a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
                
            
        </span>
    </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2016/06/24</span>
        </span>
    
</div>

            
            
    </div>
    
    <div class="post-body post-content">
        <h2 id="iOS中WebKit框架应用与解析"><a href="#iOS中WebKit框架应用与解析" class="headerlink" title="iOS中WebKit框架应用与解析"></a>iOS中WebKit框架应用与解析</h2><h3 id="一、引言"><a href="#一、引言" class="headerlink" title="一、引言"></a>一、引言</h3><pre><code>在iOS8之前，在应用中嵌入网页通常需要使用UIWebView这样一个类，这个类通过URL或者HTML文件来加载网页视图，功能十分有限，只能作为辅助嵌入原生应用程序中。虽然UIWebView也可以做原生与JavaScript交互的相关处理，然而也有很大的局限性，JavaScript要调用原生方法通常需要约定好协议之后通过Request来传递。WebKit框架中添加了一些原生与JavaScript交互的方法，增强了网页视图与原生的交互能力。并且WebKit框架中采用导航堆栈的模型来管理网页的跳转，开发者也可以更加容易的控制和管理网页的渲染。关于UIWebView的相关使用，在前面的博客中有详细介绍，地址如下。
</code></pre><p>UIWebView的使用详解：<a href="http://my.oschina.net/u/2340880/blog/469916" target="_blank" rel="noopener">http://my.oschina.net/u/2340880/blog/469916</a>。</p>
<h3 id="二、WebKit框架概览"><a href="#二、WebKit框架概览" class="headerlink" title="二、WebKit框架概览"></a>二、WebKit框架概览</h3><pre><code>WebKit框架中涉及的类很多，框架的设计十分面向对象和模块化，开发者在使用时可以轻松的写出结构清晰的代码。在进行使用前，我们首先应该清楚整个框架的结构和开发思路，下面一张脑图中基本列出了WebKit框架中所涉及到的所有重要的类以及他们之间的相互关系：
</code></pre><p><img src="http://static.oschina.net/uploads/space/2016/0624/104532_WAVb_2340880.png" alt="">如上图所示，WebKit框架中最核心的类应该属于WKWebView了，这个类专门用来渲染网页视图，其他类和协议都将基于它和服务于它。</p>
<p>WKWebView：网页的渲染与展示，通过WKWebViewConfiguration可以进行配置。</p>
<p>WKWebViewConfiguration：这个类专门用来配置WKWebView。</p>
<p>WKPreference:这个类用来进行M相关设置。</p>
<p>WKProcessPool：这个类用来配置进程池，与网页视图的资源共享有关。</p>
<p>WKUserContentController：这个类主要用来做native与JavaScript的交互管理。</p>
<p>WKUserScript：用于进行JavaScript注入。</p>
<p>WKScriptMessageHandler：这个类专门用来处理JavaScript调用native的方法。</p>
<p>WKNavigationDelegate：网页跳转间的导航管理协议，这个协议可以监听网页的活动。</p>
<p>WKNavigationAction：网页某个活动的示例化对象。</p>
<p>WKUIDelegate：用于交互处理JavaScript中的一些弹出框。</p>
<p>WKBackForwardList：堆栈管理的网页列表。</p>
<p>WKBackForwardListItem：每个网页节点对象。</p>
<h3 id="三、使用WKWebViewConfiguration对WebView进行配置"><a href="#三、使用WKWebViewConfiguration对WebView进行配置" class="headerlink" title="三、使用WKWebViewConfiguration对WebView进行配置"></a>三、使用WKWebViewConfiguration对WebView进行配置</h3><pre><code>使用下面的代码可以创建一个WKWebView视图，创建WebView视图时，需要使用WKWebViewConfiguration来进行配置：
</code></pre><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">WKWebView</span> * WK;</span><br><span class="line"><span class="built_in">WKWebViewConfiguration</span> * config = [[<span class="built_in">WKWebViewConfiguration</span> alloc]init];</span><br><span class="line">WK = [[<span class="built_in">WKWebView</span> alloc]initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="keyword">self</span>.view.frame.size.width, <span class="keyword">self</span>.view.frame.size.height<span class="number">-40</span>) configuration:config];</span><br><span class="line">[WK loadRequest:[<span class="built_in">NSURLRequest</span> requestWithURL:[<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://www.baidu.com"</span>]]];</span><br></pre></td></tr></table></figure>
<p>WKWebViewConfiguration中可以进行配置的方法和属性如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置进程池</span></span><br><span class="line"><span class="built_in">WKProcessPool</span> * pool = [[<span class="built_in">WKProcessPool</span> alloc]init];</span><br><span class="line">config.processPool = pool;</span><br></pre></td></tr></table></figure>
<p>WKProcessPool类中没有暴露任何属性和方法，配置为同一个进程池的WebView会共享数据，例如Cookie、用户凭证等，开发者可以通过编写管理类来分配不同维度的WebView在不同进程池中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//进行偏好设置</span><br><span class="line">WKPreferences * preference = [[WKPreferences alloc]init];</span><br><span class="line">//最小字体大小 当将javaScriptEnabled属性设置为NO时，可以看到明显的效果</span><br><span class="line">preference.minimumFontSize = 0;</span><br><span class="line">//设置是否支持javaScript 默认是支持的</span><br><span class="line">preference.javaScriptEnabled = YES;</span><br><span class="line">//设置是否允许不经过用户交互由javaScript自动打开窗口</span><br><span class="line">preference.javaScriptCanOpenWindowsAutomatically = YES;</span><br><span class="line">config.preferences = preference;</span><br></pre></td></tr></table></figure>
<p>WKPerference实例为WebView提供一个偏好设置。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置内容交互控制器 用于处理JavaScript与native交互</span></span><br><span class="line"><span class="built_in">WKUserContentController</span> * userController = [[<span class="built_in">WKUserContentController</span> alloc]init];</span><br><span class="line"><span class="comment">//设置处理代理并且注册要被js调用的方法名称</span></span><br><span class="line">[userController addScriptMessageHandler:<span class="keyword">self</span> name:<span class="string">@"name"</span>];</span><br><span class="line"><span class="comment">//js注入，注入一个测试方法。</span></span><br><span class="line"><span class="built_in">NSString</span> *javaScriptSource = <span class="string">@"function userFunc()&#123;window.webkit.messageHandlers.name.postMessage( &#123;\"name\":\"HS\"&#125;)&#125;"</span>;</span><br><span class="line"><span class="built_in">WKUserScript</span> *userScript = [[<span class="built_in">WKUserScript</span> alloc] initWithSource:javaScriptSource injectionTime:<span class="built_in">WKUserScriptInjectionTimeAtDocumentStart</span> forMainFrameOnly:<span class="literal">YES</span>];<span class="comment">// forMainFrameOnly:NO(全局窗口)，yes（只限主窗口）</span></span><br><span class="line">[userController addUserScript:userScript];</span><br><span class="line">config.userContentController = userController;</span><br></pre></td></tr></table></figure>
<p>WKUserContentController专门用来管理native与JavaScript的交互行为，addScriptMessageHandler:name:方法来注册要被js调用的方法名称，之后再JavaScript中使用window.webkit.messageHandlers.name.postMessage()方法来像native发送消息，支持OC中字典，数组，NSNumber等原生数据类型，JavaScript代码中的name要和上面注册的相同。在native代理的回调方法中，会获取到JavaScript传递进来的消息，如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)userContentController:(<span class="built_in">WKUserContentController</span> *)userContentController didReceiveScriptMessage:(<span class="built_in">WKScriptMessage</span> *)message&#123;</span><br><span class="line">    <span class="comment">//这里可以获取到JavaScript传递进来的消息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>WKScriptMessage类是JavaScript传递的对象实例，其中属性如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//传递的消息主体</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>) <span class="keyword">id</span> body;</span><br><span class="line"><span class="comment">//传递消息的WebView</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">weak</span>) <span class="built_in">WKWebView</span> *webView;</span><br><span class="line"><span class="comment">//传递消息的WebView当前页面对象</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>) <span class="built_in">WKFrameInfo</span> *frameInfo;</span><br><span class="line"><span class="comment">//消息名称</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br></pre></td></tr></table></figure>
<p>WKUserContentController实例的addUserScript:用于注入JavaScript代码，后面会专门介绍。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置数据存储store</span></span><br><span class="line">config.websiteDataStore = [<span class="built_in">WKWebsiteDataStore</span> defaultDataStore];</span><br></pre></td></tr></table></figure>
<p>WebKit框架采用其本身的缓存框架，WKWebsiteDataStore类用来处理数据的存储，其中属性和方法如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">WKWebsiteDataStore</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="comment">//获取默认的存储器 此存储器为持久性的会被写入磁盘</span></span><br><span class="line">+ (<span class="built_in">WKWebsiteDataStore</span> *)defaultDataStore;</span><br><span class="line"><span class="comment">//获取一个临时的存储器</span></span><br><span class="line">+ (<span class="built_in">WKWebsiteDataStore</span> *)nonPersistentDataStore;</span><br><span class="line"><span class="comment">//存储器是否是临时的</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">getter</span>=isPersistent) <span class="built_in">BOOL</span> persistent;</span><br><span class="line"><span class="comment">//所有可以存储的类型</span></span><br><span class="line">+ (<span class="built_in">NSSet</span>&lt;<span class="built_in">NSString</span> *&gt; *)allWebsiteDataTypes;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置是否将网页内容全部加载到内存后再渲染</span></span><br><span class="line">config.suppressesIncrementalRendering = <span class="literal">NO</span>;</span><br><span class="line"><span class="comment">//设置HTML5视频是否允许网页播放 设置为NO则会使用本地播放器</span></span><br><span class="line">config.allowsInlineMediaPlayback =  <span class="literal">YES</span>;</span><br><span class="line"><span class="comment">//设置是否允许ariPlay播放</span></span><br><span class="line">config.allowsAirPlayForMediaPlayback = <span class="literal">YES</span>;</span><br><span class="line"><span class="comment">//设置视频是否需要用户手动播放  设置为NO则会允许自动播放</span></span><br><span class="line">config.requiresUserActionForMediaPlayback = <span class="literal">NO</span>;</span><br><span class="line"><span class="comment">//设置是否允许画中画技术 在特定设备上有效</span></span><br><span class="line">config.allowsPictureInPictureMediaPlayback = <span class="literal">YES</span>;</span><br><span class="line"><span class="comment">//设置选择模式 是按字符选择 还是按模块选择</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">typedef NS_ENUM(NSInteger, WKSelectionGranularity) &#123;</span></span><br><span class="line"><span class="comment">    //按模块选择</span></span><br><span class="line"><span class="comment">    WKSelectionGranularityDynamic,</span></span><br><span class="line"><span class="comment">    //按字符选择</span></span><br><span class="line"><span class="comment">    WKSelectionGranularityCharacter,</span></span><br><span class="line"><span class="comment">&#125; NS_ENUM_AVAILABLE_IOS(8_0);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">config.selectionGranularity = <span class="built_in">WKSelectionGranularityCharacter</span>;</span><br><span class="line"><span class="comment">//设置请求的User-Agent信息中应用程序名称 iOS9后可用</span></span><br><span class="line">config.applicationNameForUserAgent = <span class="string">@"HS"</span>;</span><br></pre></td></tr></table></figure>
<h3 id="四、WKWebView中的属性和方法解析"><a href="#四、WKWebView中的属性和方法解析" class="headerlink" title="四、WKWebView中的属性和方法解析"></a>四、WKWebView中的属性和方法解析</h3><pre><code>下面列举了WKWebView中常用的属性和方法。
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">//设置导航代理</span><br><span class="line">@property (nullable, nonatomic, weak) id &lt;WKNavigationDelegate&gt; navigationDelegate;</span><br><span class="line">//设置UI代理</span><br><span class="line">@property (nullable, nonatomic, weak) id &lt;WKUIDelegate&gt; UIDelegate;</span><br><span class="line">//导航列表</span><br><span class="line">@property (nonatomic, readonly, strong) WKBackForwardList *backForwardList;</span><br><span class="line">//通过url加载网页视图</span><br><span class="line">- (nullable WKNavigation *)loadRequest:(NSURLRequest *)request;</span><br><span class="line">//通过文件加载网页视图</span><br><span class="line">- (nullable WKNavigation *)loadFileURL:(NSURL *)URL allowingReadAccessToURL:(NSURL *)readAccessURL NS_AVAILABLE(10_11, 9_0);</span><br><span class="line">//通过HTML字符串加载网页视图</span><br><span class="line">- (nullable WKNavigation *)loadHTMLString:(NSString *)string baseURL:(nullable NSURL *)baseURL;</span><br><span class="line">//通过data数据加载网页视图</span><br><span class="line">- (nullable WKNavigation *)loadData:(NSData *)data MIMEType:(NSString *)MIMEType characterEncodingName:(NSString *)characterEncodingName baseURL:(NSURL *)baseURL NS_AVAILABLE(10_11, 9_0);</span><br><span class="line">//渲染导航列表中的某个网页节点</span><br><span class="line">- (nullable WKNavigation *)goToBackForwardListItem:(WKBackForwardListItem *)item;</span><br><span class="line">//网页标题</span><br><span class="line">@property (nullable, nonatomic, readonly, copy) NSString *title;</span><br><span class="line">//网页的url</span><br><span class="line">@property (nullable, nonatomic, readonly, copy) NSURL *URL;</span><br><span class="line">//网页是否正在加载中</span><br><span class="line">@property (nonatomic, readonly, getter=isLoading) BOOL loading;</span><br><span class="line">//加载进度 可以监听这个属性的值配合UIProgressView来设计进度条</span><br><span class="line">@property (nonatomic, readonly) double estimatedProgress;</span><br><span class="line">//是否全部是安全连接</span><br><span class="line">@property (nonatomic, readonly) BOOL hasOnlySecureContent;</span><br><span class="line">//证书列表</span><br><span class="line">@property (nonatomic, readonly, copy) NSArray *certificateChain;</span><br><span class="line">//是否可以回退</span><br><span class="line">@property (nonatomic, readonly) BOOL canGoBack;</span><br><span class="line">//是否可以前进</span><br><span class="line">@property (nonatomic, readonly) BOOL canGoForward;</span><br><span class="line">//回退网页</span><br><span class="line">- (nullable WKNavigation *)goBack;</span><br><span class="line">//前进网页</span><br><span class="line">- (nullable WKNavigation *)goForward;</span><br><span class="line">//刷新网页</span><br><span class="line">- (nullable WKNavigation *)reload;</span><br><span class="line">//忽略缓存的刷新</span><br><span class="line">- (nullable WKNavigation *)reloadFromOrigin;</span><br><span class="line">//停止加载</span><br><span class="line">- (void)stopLoading;</span><br><span class="line">//执行JavaScript代码</span><br><span class="line">- (void)evaluateJavaScript:(NSString *)javaScriptString completionHandler:(void (^ __nullable)(__nullable id, NSError * __nullable error))completionHandler;</span><br><span class="line">//是否允许右滑返回手势</span><br><span class="line">@property (nonatomic) BOOL allowsBackForwardNavigationGestures;</span><br></pre></td></tr></table></figure>
<p>WKBackForwardList类为导航管理的网页列表类，其中属性方法意义如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">WKBackForwardList</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="comment">//当前所在的网页节点</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">strong</span>) <span class="built_in">WKBackForwardListItem</span> *currentItem;</span><br><span class="line"><span class="comment">//前进的一个网页节点</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">strong</span>) <span class="built_in">WKBackForwardListItem</span> *forwardItem;</span><br><span class="line"><span class="comment">//回退的一个网页节点</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">strong</span>) <span class="built_in">WKBackForwardListItem</span> *backItem;</span><br><span class="line"><span class="comment">//获取某个index的网页节点</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">WKBackForwardListItem</span> *)itemAtIndex:(<span class="built_in">NSInteger</span>)index;</span><br><span class="line"><span class="comment">//获取回退的节点数组</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>) <span class="built_in">NSArray</span>&lt;<span class="built_in">WKBackForwardListItem</span> *&gt; *backList;</span><br><span class="line"><span class="comment">//获取前进的节点数组</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>) <span class="built_in">NSArray</span>&lt;<span class="built_in">WKBackForwardListItem</span> *&gt; *forwardList;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>在WebKit中，网页节点被抽象成为了WKBackForwardListItem类，这个类中封装的属性如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">WKBackForwardListItem</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="comment">//当前节点的URL</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">copy</span>) <span class="built_in">NSURL</span> *URL;</span><br><span class="line"><span class="comment">//当前节点的标题</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *title;</span><br><span class="line"><span class="comment">//创建此WebView的初始URL</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">copy</span>) <span class="built_in">NSURL</span> *initialURL;</span><br></pre></td></tr></table></figure>
<h3 id="五、关于native与JavaScript交互"><a href="#五、关于native与JavaScript交互" class="headerlink" title="五、关于native与JavaScript交互"></a>五、关于native与JavaScript交互</h3><pre><code>WebKit中的native与JavaScript的交互主要有4类。
</code></pre><h4 id="1-JavaScript调用native方法"><a href="#1-JavaScript调用native方法" class="headerlink" title="1.JavaScript调用native方法"></a>1.JavaScript调用native方法</h4><pre><code>这种方式是由WKUserContentController注册，并在代理方法中实现的。
</code></pre><h4 id="2-native调用JavaScript方法"><a href="#2-native调用JavaScript方法" class="headerlink" title="2.native调用JavaScript方法"></a>2.native调用JavaScript方法</h4><pre><code>这种方式通过WKWebView直接调用evaluteJavaScript:completionHandler:方法来实现。
</code></pre><h4 id="3-将JavaScript代码注入"><a href="#3-将JavaScript代码注入" class="headerlink" title="3.将JavaScript代码注入"></a>3.将JavaScript代码注入</h4><pre><code>这种方式可以在网页中注入一些自定义的JavaScript代码，也可以注入自定义的方法，再使用evaluteJavaScript:completionHandler:来调用方法。JavaScript代码的注入也是通过WKUserContentController来完成的，使用addUserScript:方法来注入JavaScript，其中需要通过WKUserScript类来生成要注入的对象，这个类使用如下方法来进行实例化：
</code></pre><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">source为要注入的js代码</span></span><br><span class="line"><span class="comment">WKUserScriptInjectionTime设置注入的时机</span></span><br><span class="line"><span class="comment">forMainFrameOnly参数设置是否只在主页面注入</span></span><br><span class="line"><span class="comment">typedef NS_ENUM(NSInteger, WKUserScriptInjectionTime) &#123;</span></span><br><span class="line"><span class="comment">    //原js代码运行前注入</span></span><br><span class="line"><span class="comment">    WKUserScriptInjectionTimeAtDocumentStart,</span></span><br><span class="line"><span class="comment">    //原js代码运行后注入</span></span><br><span class="line"><span class="comment">    WKUserScriptInjectionTimeAtDocumentEnd</span></span><br><span class="line"><span class="comment">&#125; NS_ENUM_AVAILABLE(10_10, 8_0);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithSource:(<span class="built_in">NSString</span> *)source injectionTime:(<span class="built_in">WKUserScriptInjectionTime</span>)injectionTime forMainFrameOnly:(<span class="built_in">BOOL</span>)forMainFrameOnly;</span><br></pre></td></tr></table></figure>
<h4 id="4-通过WKUIDelegate来交互"><a href="#4-通过WKUIDelegate来交互" class="headerlink" title="4.通过WKUIDelegate来交互"></a>4.通过WKUIDelegate来交互</h4><pre><code>这种方式主要用于相应JavaScript中的弹出框，后面会详细介绍这个协议。
</code></pre><h3 id="六、WKNavagationDelegate中方法解析"><a href="#六、WKNavagationDelegate中方法解析" class="headerlink" title="六、WKNavagationDelegate中方法解析"></a>六、WKNavagationDelegate中方法解析</h3><pre><code>WKNavagationDelegate协议重要有两个作用，监听页面渲染流程与控制页面跳转，其中方法如下：
</code></pre><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">决定是否响应网页的某个动作，例如加载，回退，前进，刷新等，在这个方法中，必须执行decisionHandler()代码块，并将是否允许这个活动执行在block中进行传入</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">WKNavigationAction是网页动作的抽象化，其中封装了许多行为信息，后面会介绍</span></span><br><span class="line"><span class="comment">WKNavigationActionPolicy为开发者回执，枚举如下：</span></span><br><span class="line"><span class="comment">typedef NS_ENUM(NSInteger, WKNavigationActionPolicy) &#123;</span></span><br><span class="line"><span class="comment">    //取消此次行为</span></span><br><span class="line"><span class="comment">    WKNavigationActionPolicyCancel,</span></span><br><span class="line"><span class="comment">    //允许此次行为</span></span><br><span class="line"><span class="comment">    WKNavigationActionPolicyAllow,</span></span><br><span class="line"><span class="comment">&#125; NS_ENUM_AVAILABLE(10_10, 8_0);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">-(<span class="keyword">void</span>)webView:(<span class="built_in">WKWebView</span> *)webView decidePolicyForNavigationAction:(<span class="built_in">WKNavigationAction</span> *)navigationAction decisionHandler:(<span class="keyword">void</span> (^)(<span class="built_in">WKNavigationActionPolicy</span>))decisionHandler&#123;</span><br><span class="line">    decisionHandler(<span class="built_in">WKNavigationActionPolicyAllow</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//需要响应身份验证时调用 同样在block中需要传入用户身份凭证</span></span><br><span class="line">-(<span class="keyword">void</span>)webView:(<span class="built_in">WKWebView</span> *)webView didReceiveAuthenticationChallenge:(<span class="built_in">NSURLAuthenticationChallenge</span> *)challenge completionHandler:(<span class="keyword">void</span> (^)(<span class="built_in">NSURLSessionAuthChallengeDisposition</span>, <span class="built_in">NSURLCredential</span> * _Nullable))completionHandler&#123;</span><br><span class="line">    <span class="comment">//用户身份信息</span></span><br><span class="line">    <span class="built_in">NSURLCredential</span> *newCred = [<span class="built_in">NSURLCredential</span> credentialWithUser:<span class="string">@""</span></span><br><span class="line">                                                          password:<span class="string">@""</span></span><br><span class="line">                                                       persistence:<span class="built_in">NSURLCredentialPersistenceNone</span>];</span><br><span class="line">    <span class="comment">// 为 challenge 的发送方提供 credential</span></span><br><span class="line">    [[challenge sender] useCredential:newCred</span><br><span class="line">           forAuthenticationChallenge:challenge];</span><br><span class="line">    completionHandler(<span class="built_in">NSURLSessionAuthChallengeUseCredential</span>,newCred);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//接收到数据后是否允许执行渲染</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">其中，WKNavigationResponse为请求回执信息</span></span><br><span class="line"><span class="comment">WKNavigationResponsePokicy为开发者回执，枚举如下：</span></span><br><span class="line"><span class="comment">typedef NS_ENUM(NSInteger, WKNavigationResponsePolicy) &#123;</span></span><br><span class="line"><span class="comment">    //取消渲染</span></span><br><span class="line"><span class="comment">    WKNavigationResponsePolicyCancel,</span></span><br><span class="line"><span class="comment">    //允许渲染</span></span><br><span class="line"><span class="comment">    WKNavigationResponsePolicyAllow,</span></span><br><span class="line"><span class="comment">&#125; NS_ENUM_AVAILABLE(10_10, 8_0);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">-(<span class="keyword">void</span>)webView:(<span class="built_in">WKWebView</span> *)webView decidePolicyForNavigationResponse:(<span class="built_in">WKNavigationResponse</span> *)navigationResponse decisionHandler:(<span class="keyword">void</span> (^)(<span class="built_in">WKNavigationResponsePolicy</span>))decisionHandler&#123;</span><br><span class="line">    decisionHandler(<span class="built_in">WKNavigationResponsePolicyAllow</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//=====================下面这个协议方法用于监听流程=========================================</span></span><br><span class="line"><span class="comment">//页面加载启动时调用</span></span><br><span class="line">-(<span class="keyword">void</span>)webView:(<span class="built_in">WKWebView</span> *)webView didStartProvisionalNavigation:(<span class="built_in">WKNavigation</span> *)navigation&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//当主机接收到的服务重定向时调用</span></span><br><span class="line">-(<span class="keyword">void</span>)webView:(<span class="built_in">WKWebView</span> *)webView didReceiveServerRedirectForProvisionalNavigation:(<span class="built_in">WKNavigation</span> *)navigation&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//内容到达主机时调用</span></span><br><span class="line">-(<span class="keyword">void</span>)webView:(<span class="built_in">WKWebView</span> *)webView didCommitNavigation:(<span class="built_in">WKNavigation</span> *)navigation&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//主页加载完成时调用</span></span><br><span class="line">-(<span class="keyword">void</span>)webView:(<span class="built_in">WKWebView</span> *)webView didFinishNavigation:(<span class="built_in">WKNavigation</span> *)navigation&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//提交发生错误时调用</span></span><br><span class="line">-(<span class="keyword">void</span>)webView:(<span class="built_in">WKWebView</span> *)webView didFailNavigation:(<span class="built_in">WKNavigation</span> *)navigation withError:(<span class="built_in">NSError</span> *)error&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//主页数据加载发生错误时调用</span></span><br><span class="line">-(<span class="keyword">void</span>)webView:(<span class="built_in">WKWebView</span> *)webView didFailProvisionalNavigation:(<span class="keyword">null_unspecified</span> <span class="built_in">WKNavigation</span> *)navigation withError:(<span class="keyword">nonnull</span> <span class="built_in">NSError</span> *)error&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//进程被终止时调用</span></span><br><span class="line">-(<span class="keyword">void</span>)webViewWebContentProcessDidTerminate:(<span class="built_in">WKWebView</span> *)webView&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="七、WKUIDelegate协议中方法解析"><a href="#七、WKUIDelegate协议中方法解析" class="headerlink" title="七、WKUIDelegate协议中方法解析"></a>七、WKUIDelegate协议中方法解析</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建新的webView时调用的方法</span></span><br><span class="line">-(<span class="built_in">WKWebView</span> *)webView:(<span class="built_in">WKWebView</span> *)webView createWebViewWithConfiguration:(<span class="built_in">WKWebViewConfiguration</span> *)configuration forNavigationAction:(<span class="built_in">WKNavigationAction</span> *)navigationAction windowFeatures:(<span class="built_in">WKWindowFeatures</span> *)windowFeatures&#123;</span><br><span class="line">    <span class="keyword">return</span> webView;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//关闭webView时调用的方法</span></span><br><span class="line">-(<span class="keyword">void</span>)webViewDidClose:(<span class="built_in">WKWebView</span> *)webView&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//下面这些方法是交互JavaScript的方法</span></span><br><span class="line"><span class="comment">//JavaScript调用alert方法后回调的方法 message中为alert提示的信息 必须要在其中调用completionHandler()</span></span><br><span class="line">-(<span class="keyword">void</span>)webView:(<span class="built_in">WKWebView</span> *)webView runJavaScriptAlertPanelWithMessage:(<span class="built_in">NSString</span> *)message initiatedByFrame:(<span class="built_in">WKFrameInfo</span> *)frame completionHandler:(<span class="keyword">void</span> (^)(<span class="keyword">void</span>))completionHandler&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,message);</span><br><span class="line">    completionHandler();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//JavaScript调用confirm方法后回调的方法 confirm是js中的确定框，需要在block中把用户选择的情况传递进去</span></span><br><span class="line">-(<span class="keyword">void</span>)webView:(<span class="built_in">WKWebView</span> *)webView runJavaScriptConfirmPanelWithMessage:(<span class="built_in">NSString</span> *)message initiatedByFrame:(<span class="built_in">WKFrameInfo</span> *)frame completionHandler:(<span class="keyword">void</span> (^)(<span class="built_in">BOOL</span>))completionHandler&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,message);</span><br><span class="line">    completionHandler(<span class="literal">YES</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//JavaScript调用prompt方法后回调的方法 prompt是js中的输入框 需要在block中把用户输入的信息传入</span></span><br><span class="line">-(<span class="keyword">void</span>)webView:(<span class="built_in">WKWebView</span> *)webView runJavaScriptTextInputPanelWithPrompt:(<span class="built_in">NSString</span> *)prompt defaultText:(<span class="built_in">NSString</span> *)defaultText initiatedByFrame:(<span class="built_in">WKFrameInfo</span> *)frame completionHandler:(<span class="keyword">void</span> (^)(<span class="built_in">NSString</span> * _Nullable))completionHandler&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,prompt);</span><br><span class="line">    completionHandler(<span class="string">@"123"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="八、扩展"><a href="#八、扩展" class="headerlink" title="八、扩展"></a>八、扩展</h3><pre><code>首先，在注册要被JavaScript调用的方法时需要设置代理，在不需要时需要将代理移除，WKUserContentController中也提供了移除这个代理的方法，如果不移除，将会造成WebView不能释放。方法如下：
</code></pre><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注册一个监听方法</span></span><br><span class="line">- (<span class="keyword">void</span>)addScriptMessageHandler:(<span class="keyword">id</span> &lt;<span class="built_in">WKScriptMessageHandler</span>&gt;)scriptMessageHandler name:(<span class="built_in">NSString</span> *)name;</span><br><span class="line"><span class="comment">//移除一个方法的监听</span></span><br><span class="line">- (<span class="keyword">void</span>)removeScriptMessageHandlerForName:(<span class="built_in">NSString</span> *)name;</span><br></pre></td></tr></table></figure>
<p>同样与注入JavaScript对应，也可以将注入的代码移除，方法如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注入一个JavaScript抽象对象</span></span><br><span class="line">- (<span class="keyword">void</span>)addUserScript:(<span class="built_in">WKUserScript</span> *)userScript;</span><br><span class="line"><span class="comment">//移除所有注入</span></span><br><span class="line">- (<span class="keyword">void</span>)removeAllUserScripts;</span><br></pre></td></tr></table></figure>
<pre><code>在上面，经常会见到WKNavagationAction这个类，这个类中封装的是一些页面活动信息，如下：
</code></pre><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">WKNavigationAction</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="comment">//原页面</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>) <span class="built_in">WKFrameInfo</span> *sourceFrame;</span><br><span class="line"><span class="comment">//目标页面</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>) <span class="built_in">WKFrameInfo</span> *targetFrame;</span><br><span class="line"><span class="comment">//请求URL</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>) <span class="built_in">NSURLRequest</span> *request;</span><br><span class="line"><span class="comment">//活动类型</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">typedef NS_ENUM(NSInteger, WKNavigationType) &#123;</span></span><br><span class="line"><span class="comment">    //链接激活</span></span><br><span class="line"><span class="comment">    WKNavigationTypeLinkActivated,</span></span><br><span class="line"><span class="comment">    //提交操作</span></span><br><span class="line"><span class="comment">    WKNavigationTypeFormSubmitted,</span></span><br><span class="line"><span class="comment">    //前进操作</span></span><br><span class="line"><span class="comment">    WKNavigationTypeBackForward,</span></span><br><span class="line"><span class="comment">    //刷新操作</span></span><br><span class="line"><span class="comment">    WKNavigationTypeReload,</span></span><br><span class="line"><span class="comment">    //重提交操作 例如前进 后退 刷新</span></span><br><span class="line"><span class="comment">    WKNavigationTypeFormResubmitted,</span></span><br><span class="line"><span class="comment">    //其他类型</span></span><br><span class="line"><span class="comment">    WKNavigationTypeOther = -1,</span></span><br><span class="line"><span class="comment">&#125; NS_ENUM_AVAILABLE(10_10, 8_0);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">WKNavigationType</span> navigationType;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>专注技术，热爱生活，交流技术，也做朋友。</p>
<p>——珲少 QQ群：203317592</p>
</blockquote>

    </div>

    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © 微信：15137348047
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/2016/06/26/228Swift3.0带来的变化汇总系列三——函数和闭包写法上的微调/" class="pre-post btn btn-default" title='Swift3.0带来的变化汇总系列三——函数和闭包写法上的微调'>
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">Swift3.0带来的变化汇总系列三——函数和闭包写法上的微调</span>
        </a>
    
    
        <a href="/2016/06/18/226Swift3.0带来的变化汇总系列二——集合类型中的变化/" class="next-post btn btn-default" title='Swift3.0带来的变化汇总系列二——集合类型中的变化'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">Swift3.0带来的变化汇总系列二——集合类型中的变化</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
<div id="lv-container" data-id="city" data-uid="MTAyMC8zNzY0Ny8xNDE3OA==">
  <script type="text/javascript">
     (function(d, s) {
         var j, e = d.getElementsByTagName(s)[0];
         if (typeof LivereTower === 'function') { return; }
         j = d.createElement(s);
         j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
         j.async = true;
         e.parentNode.insertBefore(j, e);
     })(document, 'script');
  </script>
</div>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#iOS中WebKit框架应用与解析"><span class="toc-text">iOS中WebKit框架应用与解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一、引言"><span class="toc-text">一、引言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#二、WebKit框架概览"><span class="toc-text">二、WebKit框架概览</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#三、使用WKWebViewConfiguration对WebView进行配置"><span class="toc-text">三、使用WKWebViewConfiguration对WebView进行配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#四、WKWebView中的属性和方法解析"><span class="toc-text">四、WKWebView中的属性和方法解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#五、关于native与JavaScript交互"><span class="toc-text">五、关于native与JavaScript交互</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-JavaScript调用native方法"><span class="toc-text">1.JavaScript调用native方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-native调用JavaScript方法"><span class="toc-text">2.native调用JavaScript方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-将JavaScript代码注入"><span class="toc-text">3.将JavaScript代码注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-通过WKUIDelegate来交互"><span class="toc-text">4.通过WKUIDelegate来交互</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#六、WKNavagationDelegate中方法解析"><span class="toc-text">六、WKNavagationDelegate中方法解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#七、WKUIDelegate协议中方法解析"><span class="toc-text">七、WKUIDelegate协议中方法解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#八、扩展"><span class="toc-text">八、扩展</span></a></li></ol></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12"> 
                <span>Copyright &copy; 2018
                </span> | 
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> | 
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



<script src="/js/app.js?rev=@@hash"></script>


</body>
</html>
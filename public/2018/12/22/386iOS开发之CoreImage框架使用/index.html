<script src="https://eqcn.ajz.miesnfu.com/wp-content/plugins/wp-3d-pony/live2dw/lib/L2Dwidget.min.js"></script> 
<script>
　　let models = [
    "https://unpkg.com/live2d-widget-model-chitose@1.0.5/assets/chitose.model.json",
    "https://unpkg.com/live2d-widget-model-shizuku@1.0.5/assets/shizuku.model.json",
    "https://unpkg.com/live2d-widget-model-koharu@1.0.5/assets/koharu.model.json",
    "https://unpkg.com/live2d-widget-model-haruto@1.0.5/assets/haruto.model.json",
    "https://unpkg.com/live2d-widget-model-miku@1.0.5/assets/miku.model.json",
    "https://unpkg.com/live2d-widget-model-z16@1.0.5/assets/z16.model.json"
];
let m = models[Math.round(Math.random()*5)];
　　L2Dwidget.init({ 
　　"model": {jsonPath:m,"scale": 1 }, 
　　"display": { "position": "left", "width": 200, "height": 300,"hOffset": 0, "vOffset": -20 }, 
　　"mobile": { "show": true, "scale": 0.5 }, 
　　"react": { "opacityDefault": 0.7, "opacityOnHover": 0.2 } });
</script> 
<!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="珲少的技术博客">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <link rel="dns-prefetch" href="http://huishao.cc">
    <!--SEO-->

<meta name="description" content="珲少的技术博客">



<meta name="keywords" content="珲少">



<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">
    <!--Title-->


<title>iOS开发之CoreImage框架使用 | 珲少的技术博客</title>


    <link rel="alternate" href="/atom.xml" title="珲少的技术博客" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    





    
</head>

</html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  style="background-image:url(http://7xpw2b.com1.z0.glb.clouddn.com/hexo-sinppet/img/banner.png)"  >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='珲少'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
        	<!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
                <h2> 学如逆水行舟 </h2>
            
    	</div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://huishao.cc">珲少的技术博客</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>主页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/archives/"><i class="fa "></i>归档</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="iOS开发之CoreImage框架使用">
            
	            iOS开发之CoreImage框架使用
            
        </h1>
        <div class="post-meta">
    
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a href="/categories/iOS逻辑初窥">
            iOS逻辑初窥
        </a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
                
            
        </span>
    </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2018/12/22</span>
        </span>
    
</div>

            
            
    </div>
    
    <div class="post-body post-content">
        <h2 id="iOS开发之CoreImage框架使用"><a href="#iOS开发之CoreImage框架使用" class="headerlink" title="iOS开发之CoreImage框架使用"></a>iOS开发之CoreImage框架使用</h2><pre><code>CoreImage框架是一个专门用来对图片进行处理的框架，其中提供了许多高级功能，可以帮助开发者完成UIKit或者CoreGraphics框架无法完成的任务，并且使用CoreImage框架可以十分轻松的实现滤镜以及图像识别等流行技术。本篇博客主要介绍和总结CoreImage框架的使用，并提供范例代码。
</code></pre><h3 id="一、图像过滤器"><a href="#一、图像过滤器" class="headerlink" title="一、图像过滤器"></a>一、图像过滤器</h3><h4 id="1-几组内置的过滤器"><a href="#1-几组内置的过滤器" class="headerlink" title="1.几组内置的过滤器"></a>1.几组内置的过滤器</h4><pre><code>CIFilter是CoreImage中提供的图像过滤器，也可以将其理解为滤镜。许多美颜应用，图像处理应用等都是为原图添加了滤镜效果。本节我们着重看下与这个类相关的应用。首先，CoreImaghe默认提供了非常多的滤镜效果，但是并没有详细的文档介绍，有关滤镜效果可以分为下面几个类别：
</code></pre><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过改变图像的几何形状来创建3D效果，类似隆起 过滤器组</span></span><br><span class="line"><span class="built_in">NSString</span> * <span class="keyword">const</span> kCICategoryDistortionEffect;</span><br><span class="line"><span class="comment">//旋转扭曲相关过滤器组</span></span><br><span class="line"><span class="built_in">NSString</span> * <span class="keyword">const</span> kCICategoryGeometryAdjustment;</span><br><span class="line"><span class="comment">//混合过滤器组 对两个图像进行混合操作</span></span><br><span class="line"><span class="built_in">NSString</span> * <span class="keyword">const</span> kCICategoryCompositeOperation;</span><br><span class="line"><span class="comment">//一种色调过滤器组 类似报纸风格</span></span><br><span class="line"><span class="built_in">NSString</span> * <span class="keyword">const</span> kCICategoryHalftoneEffect;</span><br><span class="line"><span class="comment">//颜色过滤器组 调整对比度 亮度等</span></span><br><span class="line"><span class="built_in">NSString</span> * <span class="keyword">const</span> kCICategoryColorEffect;</span><br><span class="line"><span class="comment">//多个图像源的过滤器</span></span><br><span class="line"><span class="built_in">NSString</span> * <span class="keyword">const</span> kCICategoryTransition;</span><br><span class="line"><span class="comment">//平铺图像过滤器</span></span><br><span class="line"><span class="built_in">NSString</span> * <span class="keyword">const</span> kCICategoryTileEffect;</span><br><span class="line"><span class="comment">//滤光类过滤器 通常作为其他过滤器的输入</span></span><br><span class="line"><span class="built_in">NSString</span> * <span class="keyword">const</span> kCICategoryGenerator;</span><br><span class="line"><span class="comment">//减弱图像数据的过滤器 通常用来进行图像分析</span></span><br><span class="line"><span class="built_in">NSString</span> * <span class="keyword">const</span> kCICategoryReduction;</span><br><span class="line"><span class="comment">//渐变过滤器 </span></span><br><span class="line"><span class="built_in">NSString</span> * <span class="keyword">const</span> kCICategoryGradient;</span><br><span class="line"><span class="comment">//画像过滤器</span></span><br><span class="line"><span class="built_in">NSString</span> * <span class="keyword">const</span> kCICategoryStylize;</span><br><span class="line"><span class="comment">//锐化过滤器</span></span><br><span class="line"><span class="built_in">NSString</span> * <span class="keyword">const</span> kCICategorySharpen;</span><br><span class="line"><span class="comment">//模糊过滤器</span></span><br><span class="line"><span class="built_in">NSString</span> * <span class="keyword">const</span> kCICategoryBlur;</span><br><span class="line"><span class="comment">//视频图片相关过滤器</span></span><br><span class="line"><span class="built_in">NSString</span> * <span class="keyword">const</span> kCICategoryVideo;</span><br><span class="line"><span class="comment">//静态图片相关过滤器</span></span><br><span class="line"><span class="built_in">NSString</span> * <span class="keyword">const</span> kCICategoryStillImage;</span><br><span class="line"><span class="comment">//交叉图像过滤器</span></span><br><span class="line"><span class="built_in">NSString</span> * <span class="keyword">const</span> kCICategoryInterlaced;</span><br><span class="line"><span class="comment">//非矩形图像上的过滤器</span></span><br><span class="line"><span class="built_in">NSString</span> * <span class="keyword">const</span> kCICategoryNonSquarePixels;</span><br><span class="line"><span class="comment">//高动态图像的过滤器</span></span><br><span class="line"><span class="built_in">NSString</span> * <span class="keyword">const</span> kCICategoryHighDynamicRange;</span><br><span class="line"><span class="comment">//CoreImage内置的过滤器</span></span><br><span class="line"><span class="built_in">NSString</span> * <span class="keyword">const</span> kCICategoryBuiltIn;</span><br><span class="line"><span class="comment">//复合的过滤器</span></span><br><span class="line"><span class="built_in">NSString</span> * <span class="keyword">const</span> kCICategoryFilterGenerator;</span><br></pre></td></tr></table></figure>
<p>上面列出了非常多的类别，其实上面只是按照不同的场景将过滤器进行了分类，每个分类中都定义了许多内置的过滤器，使用下面的方法可以获取每个分类下提供的过滤器：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取某个分类的所有过滤器名</span></span><br><span class="line">+ (<span class="built_in">NSArray</span>&lt;<span class="built_in">NSString</span> *&gt; *)filterNamesInCategory:(<span class="keyword">nullable</span> <span class="built_in">NSString</span> *)category;</span><br><span class="line"><span class="comment">//获取一组分类下的所有过滤器名</span></span><br><span class="line">+ (<span class="built_in">NSArray</span>&lt;<span class="built_in">NSString</span> *&gt; *)filterNamesInCategories:(<span class="keyword">nullable</span> <span class="built_in">NSArray</span>&lt;<span class="built_in">NSString</span> *&gt; *)categories;</span><br></pre></td></tr></table></figure>
<h4 id="2-过滤器的一个简单示例"><a href="#2-过滤器的一个简单示例" class="headerlink" title="2.过滤器的一个简单示例"></a>2.过滤器的一个简单示例</h4><p>下面示例代码演示过滤器的简单应用：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIImage</span> * img = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"1.png"</span>];</span><br><span class="line"><span class="built_in">CIImage</span> * image = [[<span class="built_in">CIImage</span> alloc]initWithImage:img];</span><br><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIBoxBlur"</span> keysAndValues:kCIInputImageKey,image, <span class="literal">nil</span>];</span><br><span class="line">[filter setDefaults];</span><br><span class="line"><span class="built_in">CIContext</span> * context = [[<span class="built_in">CIContext</span> alloc]initWithOptions:<span class="literal">nil</span>];</span><br><span class="line"><span class="built_in">CIImage</span> * output = [filter outputImage];</span><br><span class="line"><span class="built_in">CGImageRef</span> ref = [context createCGImage:output fromRect:[output extent]];</span><br><span class="line"><span class="built_in">UIImage</span> * newImage = [<span class="built_in">UIImage</span> imageWithCGImage:ref];</span><br><span class="line"><span class="built_in">CGImageRelease</span>(ref);</span><br><span class="line"><span class="built_in">UIImageView</span> * imageView = [[<span class="built_in">UIImageView</span> alloc]initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">170</span>, <span class="number">30</span>, <span class="number">150</span>, <span class="number">400</span>)];</span><br><span class="line">imageView.image = newImage;</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:imageView]; </span><br><span class="line"><span class="built_in">UIImageView</span> * imageView2 = [[<span class="built_in">UIImageView</span> alloc]initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">30</span>, <span class="number">150</span>, <span class="number">400</span>)];</span><br><span class="line">imageView2.image = img;</span><br><span class="line">[<span class="keyword">self</span>.view addSubview:imageView2];</span><br></pre></td></tr></table></figure>
<p>效果如下图：</p>
<p><img src="https://oscimg.oschina.net/oscnet/24a8db1b3c214669877769cdabb603b027a.jpg" alt></p>
<p>上面演示了简单的模糊过滤效果。</p>
<h4 id="3-对CIFilter类进行解析"><a href="#3-对CIFilter类进行解析" class="headerlink" title="3.对CIFilter类进行解析"></a>3.对CIFilter类进行解析</h4><p>CIFilter类的解析如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//过滤后输出的图像</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>, <span class="keyword">nullable</span>) <span class="built_in">CIImage</span> *outputImage;</span><br><span class="line"><span class="comment">//过滤器名称</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="comment">//是否开启CoreAnimation动画效果</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">getter</span>=isEnabled) <span class="built_in">BOOL</span> enabled;</span><br><span class="line"><span class="comment">//返回当前过滤器所有支持的输入键</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">NSArray</span>&lt;<span class="built_in">NSString</span> *&gt; *inputKeys;</span><br><span class="line"><span class="comment">//返回当前过滤器所有支持的输出键</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">NSArray</span>&lt;<span class="built_in">NSString</span> *&gt; *outputKeys;</span><br><span class="line"><span class="comment">//将过滤器的所有输入值设置为默认值</span></span><br><span class="line">- (<span class="keyword">void</span>)setDefaults;</span><br><span class="line"><span class="comment">//返回当前过滤器的属性字段</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">需要注意这个字段对于学习此过滤器非常有用</span></span><br><span class="line"><span class="comment">其中会声明此过滤器的输入和输出 即如果使用</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *,<span class="keyword">id</span>&gt; *attributes;</span><br><span class="line"><span class="comment">//用来进行过滤器的自定义 后面会介绍</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">CIImage</span> *)apply:(<span class="built_in">CIKernel</span> *)k</span><br><span class="line">                  arguments:(<span class="keyword">nullable</span> <span class="built_in">NSArray</span> *)args</span><br><span class="line">                    options:(<span class="keyword">nullable</span> <span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *,<span class="keyword">id</span>&gt; *)dict;</span><br><span class="line"><span class="comment">//同上</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">CIImage</span> *)apply:(<span class="built_in">CIKernel</span> *)k, ...;</span><br><span class="line"><span class="comment">//根据过滤器的名称创建过滤器</span></span><br><span class="line">+ (<span class="keyword">nullable</span> <span class="built_in">CIFilter</span> *) filterWithName:(<span class="built_in">NSString</span> *) name;</span><br><span class="line"><span class="comment">//创建过滤器 同时进行配置</span></span><br><span class="line">+ (<span class="keyword">nullable</span> <span class="built_in">CIFilter</span> *)filterWithName:(<span class="built_in">NSString</span> *)name</span><br><span class="line">                        keysAndValues:key0, ...;</span><br><span class="line">+ (<span class="keyword">nullable</span> <span class="built_in">CIFilter</span> *)filterWithName:(<span class="built_in">NSString</span> *)name</span><br><span class="line">                  withInputParameters:(<span class="keyword">nullable</span> <span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *,<span class="keyword">id</span>&gt; *)params;</span><br><span class="line"><span class="comment">//注册过滤器</span></span><br><span class="line">+ (<span class="keyword">void</span>)registerFilterName:(<span class="built_in">NSString</span> *)name</span><br><span class="line">               constructor:(<span class="keyword">id</span>&lt;<span class="built_in">CIFilterConstructor</span>&gt;)anObject</span><br><span class="line">           classAttributes:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *,<span class="keyword">id</span>&gt; *)attributes;</span><br><span class="line"><span class="comment">//将一组过滤器进行编码</span></span><br><span class="line">+ (<span class="keyword">nullable</span> <span class="built_in">NSData</span>*)serializedXMPFromFilters:(<span class="built_in">NSArray</span>&lt;<span class="built_in">CIFilter</span> *&gt; *)filters</span><br><span class="line">                            inputImageExtent:(<span class="built_in">CGRect</span>)extent;</span><br><span class="line"><span class="comment">//进行反编码</span></span><br><span class="line">+ (<span class="built_in">NSArray</span>&lt;<span class="built_in">CIFilter</span> *&gt; *)filterArrayFromSerializedXMP:(<span class="built_in">NSData</span> *)xmpData</span><br><span class="line">                                     inputImageExtent:(<span class="built_in">CGRect</span>)extent</span><br><span class="line">                                                error:(<span class="built_in">NSError</span> **)outError;</span><br></pre></td></tr></table></figure>
<h4 id="4-常用过滤器详解"><a href="#4-常用过滤器详解" class="headerlink" title="4.常用过滤器详解"></a>4.常用过滤器详解</h4><ul>
<li>区域凸起过滤器</li>
</ul>
<p>这个过滤器的作用是在图片的某个区域创建一块凸起。示例代码如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">kCIInputCenterKey键用来设置滤镜中心</span></span><br><span class="line"><span class="comment">kCIInputScaleKey 设置为0则没有影响 1则会凸起效果 -1则会凹入效果</span></span><br><span class="line"><span class="comment">kCIInputRadiusKey 设置滤镜的影响范围</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIBumpDistortion"</span> keysAndValues:kCIInputImageKey,image,kCIInputCenterKey,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">100</span> Y:<span class="number">200</span>],kCIInputScaleKey,@<span class="number">-1</span>,kCIInputRadiusKey,@<span class="number">150</span>, <span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/430f348114806e1695db9eab491edaa6c39.jpg" alt></p>
<ul>
<li>线性凹凸过滤器</li>
</ul>
<p>这个过滤器创建类似波纹效果，示例如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">与上一个过滤器相比 可以设置</span></span><br><span class="line"><span class="comment">kCIInputAngleKey 角度 0-2π</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIBumpDistortionLinear"</span> keysAndValues:kCIInputImageKey,image,kCIInputCenterKey,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">100</span> Y:<span class="number">200</span>],kCIInputScaleKey,@<span class="number">-1</span>,kCIInputRadiusKey,@<span class="number">150</span>,kCIInputAngleKey,@(M_PI_2), <span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/11c0b1faa1460b7fa23f7bd38671c94f68f.jpg" alt></p>
<ul>
<li>圆形飞溅过滤器</li>
</ul>
<p>这个过滤器的作用是选取图像的某个区域，对其四周进行飞溅拉伸，例如：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CICircleSplashDistortion"</span> keysAndValues:kCIInputImageKey,image,kCIInputCenterKey,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">100</span> Y:<span class="number">200</span>],kCIInputRadiusKey,@<span class="number">50</span>, <span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/723a5f106f3076d972c413426b7bd46d58a.jpg" alt></p>
<ul>
<li>圆形缠绕过滤器</li>
</ul>
<p>这个过滤器选取某个区域，进行缠绕效果，例如：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CICircularWrap"</span> keysAndValues:kCIInputImageKey,image,kCIInputCenterKey,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">100</span> Y:<span class="number">200</span>],kCIInputRadiusKey,@<span class="number">20</span>, kCIInputAngleKey,@<span class="number">3</span>,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/6469711af268c7b0cc0332822eb581ef328.jpg" alt></p>
<ul>
<li>灰度混合过滤器</li>
</ul>
<p>这个过滤器将提供混合图像的灰度值应用于目标图像，例如：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">inputDisplacementImage设置要混合的灰度图片</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIDroste"</span> keysAndValues:kCIInputImageKey,image,kCIInputScaleKey,@<span class="number">200</span>,<span class="string">@"inputDisplacementImage"</span>,image2,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/15e862dc1e9dd634ece51d8927aa9034904.jpg" alt></p>
<ul>
<li>递归绘制图像区域</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIDroste"</span> keysAndValues:kCIInputImageKey,image,<span class="string">@"inputInsetPoint0"</span>,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">100</span> Y:<span class="number">100</span>],<span class="string">@"inputInsetPoint1"</span>,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">200</span> Y:<span class="number">200</span>],<span class="string">@"inputPeriodicity"</span>,@<span class="number">1</span>,<span class="string">@"inputRotation"</span>,@<span class="number">0</span>,<span class="string">@"inputStrands"</span>,@<span class="number">1</span>,<span class="string">@"inputZoom"</span>,@<span class="number">1</span>,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/0e7d06ce9442acb6a8054fc6a9824f51109.jpg" alt></p>
<ul>
<li>玻璃纹理过滤器</li>
</ul>
<p>这个过滤器用提供图片作为目标图片的纹理，进行混合，例如：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">inputTexture设置纹理图像</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIGlassDistortion"</span> keysAndValues:kCIInputImageKey,image,kCIInputCenterKey,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">100</span> Y:<span class="number">200</span>],kCIInputScaleKey,@<span class="number">100</span>,<span class="string">@"inputTexture"</span>,image2,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/52640114163381a7a52674f5f56c852ac5e.jpg" alt></p>
<ul>
<li>菱形透镜过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">inputPoint0设置第一个圆的圆心</span></span><br><span class="line"><span class="comment">inputPoint1设置第二个圆的圆心</span></span><br><span class="line"><span class="comment">inputRadius设置半径</span></span><br><span class="line"><span class="comment">inputRefraction设置折射率 0-5之间</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIGlassLozenge"</span> keysAndValues:kCIInputImageKey,image,<span class="string">@"inputPoint0"</span>,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">100</span> Y:<span class="number">200</span>],<span class="string">@"inputPoint1"</span>,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">200</span> Y:<span class="number">200</span>],<span class="string">@"inputRadius"</span>,@<span class="number">100</span>,<span class="string">@"inputRefraction"</span>,@<span class="number">2</span>,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/035b1ce74a68064dcafc10ac0fe54f70822.jpg" alt></p>
<ul>
<li>圆孔形变过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIHoleDistortion"</span> keysAndValues:kCIInputImageKey,image,<span class="string">@"inputRadius"</span>,@<span class="number">50</span>,kCIInputCenterKey,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">100</span> Y:<span class="number">200</span>],<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/e06fad2bc55bdae87c2fe83faef6f47e477.jpg" alt></p>
<ul>
<li>九宫格拉伸过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CINinePartStretched"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputBreakpoint0"</span>,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">50</span> Y:<span class="number">50</span>],<span class="string">@"inputBreakpoint1"</span>,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">100</span> Y:<span class="number">100</span>],<span class="string">@"inputGrowAmount"</span>,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">50</span> Y:<span class="number">50</span>],<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/33f7ef97e689a9edb72d8f2c4407ef01c8d.jpg" alt></p>
<ul>
<li>九宫格复制过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CINinePartTiled"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputBreakpoint0"</span>,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">50</span> Y:<span class="number">50</span>],<span class="string">@"inputBreakpoint1"</span>,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">100</span> Y:<span class="number">100</span>],<span class="string">@"inputGrowAmount"</span>,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">50</span> Y:<span class="number">50</span>],<span class="string">@"inputFlipYTiles"</span>,@<span class="number">1</span>,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/663837a7cf141a3575571b8a7a12cf258ad.jpg" alt></p>
<ul>
<li>紧缩过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIPinchDistortion"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputCenter"</span>,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">150</span> Y:<span class="number">150</span>],<span class="string">@"inputRadius"</span>,@<span class="number">500</span>,<span class="string">@"inputScale"</span>,@<span class="number">1</span>,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/cd6ce1d87b78902a52c45eed6c660299c12.jpg" alt></p>
<ul>
<li>拉伸裁剪过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">inputSize 设置拉伸裁剪尺寸</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIStretchCrop"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputCenterStretchAmount"</span>,@<span class="number">1</span>,<span class="string">@"inputCropAmount"</span>,@<span class="number">0.5</span>,<span class="string">@"inputSize"</span>,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">300</span> Y:<span class="number">150</span>],<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/2f656fd5b7e832f50632fbaeeb4f3529f98.jpg" alt></p>
<ul>
<li>环状透镜过滤器</li>
</ul>
<p>这个过滤器创建一个环状透镜，对图像进行扭曲。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">inputCenter设置环中心</span></span><br><span class="line"><span class="comment">inputRadius 设置半径</span></span><br><span class="line"><span class="comment">inputRefraction 设置折射率</span></span><br><span class="line"><span class="comment">inputWidth 设置环宽度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CITorusLensDistortion"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputCenter"</span>,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">150</span> Y:<span class="number">150</span>],<span class="string">@"inputRadius"</span>,@<span class="number">150</span>,<span class="string">@"inputRefraction"</span>,@<span class="number">1.6</span>,<span class="string">@"inputWidth"</span>,@<span class="number">40</span>,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/3feab550ad80ff64dbece2dca4631628aad.jpg" alt></p>
<ul>
<li>旋转过滤器 </li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CITwirlDistortion"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputAngle"</span>,@<span class="number">3.14</span>,<span class="string">@"inputCenter"</span>,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">150</span> Y:<span class="number">150</span>],<span class="string">@"inputRadius"</span>,@<span class="number">150</span>,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/30dccc1198526d164c14530aca78136d6c8.jpg" alt></p>
<ul>
<li>涡流过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//inputAngle 设置涡流角度</span></span><br><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIVortexDistortion"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputAngle"</span>,@(M_PI*<span class="number">10</span>),<span class="string">@"inputCenter"</span>,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">150</span> Y:<span class="number">150</span>],<span class="string">@"inputRadius"</span>,@<span class="number">150</span>,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/10efe45dd980fd18ea549b51e76244e7c4e.jpg" alt></p>
<ul>
<li>形变过滤器 </li>
</ul>
<p>这个过滤器对图像进行简单的形变处理，如缩放，旋转，平移等。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGAffineTransform</span> tr =  <span class="built_in">CGAffineTransformMakeRotation</span>(M_PI_2);</span><br><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIAffineTransform"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputTransform"</span>,[<span class="built_in">NSValue</span> valueWithCGAffineTransform:tr],<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/b4491f96dd5c880f263ffccc2f7a3ab8f3c.jpg" alt></p>
<ul>
<li>矩形裁剪过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CICrop"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputRectangle"</span>,[[<span class="built_in">CIVector</span> alloc] initWithCGRect:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">150</span>, <span class="number">150</span>)],<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/f48c0ceea4840853c795bda25d745a22bcc.jpg" alt></p>
<ul>
<li>边缘采样过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIEdgePreserveUpsampleFilter"</span> keysAndValues:kCIInputImageKey,image,<span class="string">@"inputLumaSigma"</span>,@<span class="number">0.15</span>,<span class="string">@"inputSpatialSigma"</span>,@<span class="number">3</span>,<span class="string">@"inputSmallImage"</span>,image2,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/bbe9f1b404c8511dea4c9c95cdce4425878.jpg" alt></p>
<ul>
<li>矩形矫正过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIPerspectiveCorrection"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputBottomLeft"</span>,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">0</span> Y:<span class="number">0</span>],<span class="string">@"inputBottomRight"</span>,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">150</span> Y:<span class="number">0</span>],<span class="string">@"inputTopLeft"</span>,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">0</span> Y:<span class="number">150</span>],<span class="string">@"inputTopRight"</span>,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">150</span> Y:<span class="number">150</span>],<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p>效果如图：</p>
<p><img src="https://oscimg.oschina.net/oscnet/a2e7e71847b98fa79e48dcfdcc2781a4d04.jpg" alt></p>
<ul>
<li>旋转矫正过滤器 </li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIStraightenFilter"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputAngle"</span>,@<span class="number">3.14</span>,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/bab76e7ff5cb4041de2fb7d1abb456e088a.jpg" alt></p>
<ul>
<li>背景混合过滤器</li>
</ul>
<p>通过提供一个图像作为背景与目标图像进行混合。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIAdditionCompositing"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputBackgroundImage"</span>,image,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/5ba2059c7b7e350150632a9952cfc4ab4e7.jpg" alt></p>
<ul>
<li>色彩混合过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIColorBlendMode"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputBackgroundImage"</span>,image,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/990da84f712eb45272a0f7a716c100b6d56.jpg" alt></p>
<ul>
<li>暗混合过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIColorBurnBlendMode"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputBackgroundImage"</span>,image,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/a08c926020e9f29bed13530e76922fc607a.jpg" alt></p>
<ul>
<li>亮混合过滤器 </li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIColorDodgeBlendMode"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputBackgroundImage"</span>,image,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> <img src="https://oscimg.oschina.net/oscnet/d62aa2e9a12cbaa86fbe4823ad7564605e3.jpg" alt></p>
<ul>
<li><p>暗选择混合模式过滤器</p>
<p>这个过滤器将选择较暗的图像作为混合背景，例如：</p>
</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIDarkenBlendMode"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputBackgroundImage"</span>,image,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/8ddb81444e325a7cc184bd5be7b88f11e80.jpg" alt></p>
<ul>
<li>亮选择混合模式过滤器</li>
</ul>
<p>这个过滤器将选择较亮的图像作为混合背景，例如：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIDifferenceBlendMode"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputBackgroundImage"</span>,image,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/0fc3b4d03c9081955dfb734c6cbb228e317.jpg" alt></p>
<ul>
<li>分开混合模式过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIDivideBlendMode"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputBackgroundImage"</span>,image,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/479f8631b6736a34a34120bda57266f5571.jpg" alt></p>
<ul>
<li>排除混合模式过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIExclusionBlendMode"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputBackgroundImage"</span>,image,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/fd82734a2f8197acfcf86521f61d6b1e6c2.jpg" alt></p>
<ul>
<li>强光混合模式过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIHardLightBlendMode"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputBackgroundImage"</span>,image,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/58fbef955a3b45d144d2f2e0c1ecc88c2cb.jpg" alt></p>
<ul>
<li>色调混合模式过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIHueBlendMode"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputBackgroundImage"</span>,image,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/aad818d99fff9ddb7bcb5f67e6560e5d93c.jpg" alt></p>
<ul>
<li>减轻混合模式过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CILightenBlendMode"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputBackgroundImage"</span>,image,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/511fa605c2413382ec0cbaa886821115943.jpg" alt></p>
<ul>
<li>线性燃烧混合模式过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CILinearBurnBlendMode"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputBackgroundImage"</span>,image,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/9700b3f3526fde848397c9ca1e727420955.jpg" alt></p>
<ul>
<li>线性高亮混合过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CILinearDodgeBlendMode"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputBackgroundImage"</span>,image,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/6b6d5a7144e09a95a1ddc76eee5b1d1a98d.jpg" alt></p>
<ul>
<li>亮度混合过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CILuminosityBlendMode"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputBackgroundImage"</span>,image,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/f97a80d79799e15c793aaa51090e65989d5.jpg" alt></p>
<ul>
<li>最大值混合过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIMaximumCompositing"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputBackgroundImage"</span>,image,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/865ccf4a853e652d85286ccfee4d16579e0.jpg" alt></p>
<ul>
<li>最小值混合过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIMinimumCompositing"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputBackgroundImage"</span>,image,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/d6d671fa23af7a40e5f560c29a94beaa80e.jpg" alt></p>
<ul>
<li>多重混合过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIMultiplyBlendMode"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputBackgroundImage"</span>,image,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> 效果如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/6887bbf2da33242cf1cd4b60ff2ec130d63.jpg" alt></p>
<ul>
<li>多重合成过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIMultiplyCompositing"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputBackgroundImage"</span>,image,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> <img src="https://oscimg.oschina.net/oscnet/71f27618d99a4d2aeca0fb182c2d56419e2.jpg" alt></p>
<ul>
<li>重叠混合模式</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIOverlayBlendMode"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputBackgroundImage"</span>,image,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> <img src="https://oscimg.oschina.net/oscnet/aef3662c175fafd7d95b8955644799de6e7.jpg" alt></p>
<ul>
<li>亮混合模式</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIPinLightBlendMode"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputBackgroundImage"</span>,image,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> <img src="https://oscimg.oschina.net/oscnet/3c9b3ffaf3915cf28b80b0e8130a05ba3ff.jpg" alt></p>
<ul>
<li>饱和混合模式</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CISaturationBlendMode"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputBackgroundImage"</span>,image,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> <img src="https://oscimg.oschina.net/oscnet/14345282e936d9a08dc18accdc0aecec53b.jpg" alt></p>
<ul>
<li>屏幕混合模式</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIScreenBlendMode"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputBackgroundImage"</span>,image,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> <img src="https://oscimg.oschina.net/oscnet/c4dc4ea019ba061a1ccfd652ed53aa90c9b.jpg" alt></p>
<ul>
<li>源图像上层混合</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CISourceAtopCompositing"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputBackgroundImage"</span>,image,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> <img src="https://oscimg.oschina.net/oscnet/f08b0417a4fdefb1e9b070f9d3b0135c90c.jpg" alt></p>
<ul>
<li>圆屏过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">inputSharpness 设置圆圈锐度</span></span><br><span class="line"><span class="comment">inputWidth 设置间距</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CICircularScreen"</span> keysAndValues:kCIInputImageKey,image2,kCIInputCenterKey,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">150</span> Y:<span class="number">150</span>],<span class="string">@"inputSharpness"</span>,@<span class="number">0.7</span>,<span class="string">@"inputWidth"</span>,@<span class="number">6</span>,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p><img src="https://oscimg.oschina.net/oscnet/ccfe5a4f9c96b2eb0981f4012ef08b9b968.jpg" alt></p>
<ul>
<li>半色调过滤器 </li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CICMYKHalftone"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputAngle"</span>,@<span class="number">0</span>,kCIInputCenterKey,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">150</span> Y:<span class="number">150</span>],<span class="string">@"inputGCR"</span>,@<span class="number">1</span>,<span class="string">@"inputSharpness"</span>,@<span class="number">0.7</span>,<span class="string">@"inputUCR"</span>,@<span class="number">0.5</span>,<span class="string">@"inputWidth"</span>,@<span class="number">6</span>,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p><img src="https://oscimg.oschina.net/oscnet/8d9bc057e91eb41edcca47fce574840d965.jpg" alt></p>
<ul>
<li>点屏过滤器 </li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIDotScreen"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputAngle"</span>,@<span class="number">0</span>,kCIInputCenterKey,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">150</span> Y:<span class="number">150</span>],<span class="string">@"inputSharpness"</span>,@<span class="number">0.7</span>,<span class="string">@"inputWidth"</span>,@<span class="number">6</span>,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p><img src="https://oscimg.oschina.net/oscnet/baac52760fdd6329512ea25a54444f14ead.jpg" alt></p>
<ul>
<li>阴影屏过滤器 </li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIHatchedScreen"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputAngle"</span>,@<span class="number">0</span>,kCIInputCenterKey,[[<span class="built_in">CIVector</span> alloc] initWithX:<span class="number">150</span> Y:<span class="number">150</span>],<span class="string">@"inputSharpness"</span>,@<span class="number">0.7</span>,<span class="string">@"inputWidth"</span>,@<span class="number">6</span>,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> <img src="https://oscimg.oschina.net/oscnet/4635728f7fcd859306b919216c13b646507.jpg" alt></p>
<ul>
<li>线性sRGB过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CILinearToSRGBToneCurve"</span> keysAndValues:kCIInputImageKey,image2,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> <img src="https://oscimg.oschina.net/oscnet/f197e5e4486824b4a37ab3fb4c5b8c80594.jpg" alt></p>
<ul>
<li>色彩翻转过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIColorInvert"</span> keysAndValues:kCIInputImageKey,image2,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> <img src="https://oscimg.oschina.net/oscnet/ffb2c4665e8563e14378712d9246eda6a4b.jpg" alt></p>
<ul>
<li>色图过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIColorMap"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputGradientImage"</span>,image,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> <img src="https://oscimg.oschina.net/oscnet/9d898d8531b0b819b1e3e08ba33ca7fcd6d.jpg" alt></p>
<ul>
<li>单色过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">inputColor 设置输入颜色</span></span><br><span class="line"><span class="comment">inputIntensity 设置影响程度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIColorMonochrome"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputColor"</span>,[<span class="built_in">CIColor</span> colorWithRed:<span class="number">0.5</span> green:<span class="number">0.5</span> blue:<span class="number">0.5</span>],<span class="string">@"inputIntensity"</span>,@<span class="number">1</span>,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p><img src="https://oscimg.oschina.net/oscnet/fc83e286588421a12868a80408f69fb1edc.jpg" alt></p>
<ul>
<li>分色镜过滤器 </li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">inputLevels设置亮度级别</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIColorPosterize"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputLevels"</span>,@<span class="number">6</span>,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p><img src="https://oscimg.oschina.net/oscnet/08ea763020d5f17475365d83b512fb23630.jpg" alt></p>
<ul>
<li>反色过滤器 </li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIFalseColor"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputColor0"</span>,[<span class="built_in">CIColor</span> colorWithRed:<span class="number">0</span> green:<span class="number">0</span> blue:<span class="number">0</span>],<span class="string">@"inputColor1"</span>,[<span class="built_in">CIColor</span> colorWithRed:<span class="number">1</span> green:<span class="number">1</span> blue:<span class="number">0</span>],<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> <img src="https://oscimg.oschina.net/oscnet/850817a2d73d438bc2dca44a7236d74bb7e.jpg" alt></p>
<ul>
<li>光效褪色过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIPhotoEffectFade"</span> keysAndValues:kCIInputImageKey,image2,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> <img src="https://oscimg.oschina.net/oscnet/c25d2053059349e9a0a80e98295ad024948.jpg" alt></p>
<ul>
<li>光效瞬时过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIPhotoEffectInstant"</span> keysAndValues:kCIInputImageKey,image2,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p><img src="https://oscimg.oschina.net/oscnet/fe8a2f4b5a5c3b8d638641505bea297af86.jpg" alt></p>
<ul>
<li>光效单光过滤器 </li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIPhotoEffectMono"</span> keysAndValues:kCIInputImageKey,image2,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p><img src="https://oscimg.oschina.net/oscnet/4194d887876c06b6eb807a9bef375c0c819.jpg" alt></p>
<ul>
<li>黑色光效应过滤器 </li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIPhotoEffectNoir"</span> keysAndValues:kCIInputImageKey,image2,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p><img src="https://oscimg.oschina.net/oscnet/d7dfde1de08815d2f7752dae916128bd3e5.jpg" alt> </p>
<ul>
<li>光渐进过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIPhotoEffectProcess"</span> keysAndValues:kCIInputImageKey,image2,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> <img src="https://oscimg.oschina.net/oscnet/91181325364bceb0d195791abe37219d443.jpg" alt></p>
<ul>
<li>光转移过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIPhotoEffectTransfer"</span> keysAndValues:kCIInputImageKey,image2,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> <img src="https://oscimg.oschina.net/oscnet/025552bf6f9e6c752974621c707caf02969.jpg" alt></p>
<ul>
<li>棕褐色过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CISepiaTone"</span> keysAndValues:kCIInputImageKey,image2,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p><img src="https://oscimg.oschina.net/oscnet/dce03a2cb1b4486590bbe247ceab00176d3.jpg" alt></p>
<ul>
<li>热图过滤器 </li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIThermal"</span> keysAndValues:kCIInputImageKey,image2,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> <img src="https://oscimg.oschina.net/oscnet/1cea9c31cbf44b07c99fb78ca9c8754db28.jpg" alt></p>
<ul>
<li>X射线过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIXRay"</span> keysAndValues:kCIInputImageKey,image2,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> <img src="https://oscimg.oschina.net/oscnet/83d19c0b012fa8850a4342f99c9b61d8ba0.jpg" alt></p>
<ul>
<li>模糊过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//参数进行模糊效果的设置</span></span><br><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIBokehBlur"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputSoftness"</span>,@<span class="number">0.5</span>,<span class="string">@"inputRingSize"</span>,@<span class="number">0.1</span>,<span class="string">@"inputRingAmount"</span>,@<span class="number">0</span>,<span class="string">@"inputRadius"</span>,@<span class="number">10</span>,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p><img src="https://oscimg.oschina.net/oscnet/4b635c860ed84f339c3ec81443ae818d5f8.jpg" alt></p>
<ul>
<li>盒模糊过滤器 </li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIBoxBlur"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputRadius"</span>,@<span class="number">10</span>,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> <img src="https://oscimg.oschina.net/oscnet/222129fbe8cdc5f8fe608bddf7323b992e3.jpg" alt></p>
<ul>
<li>阀瓣模糊过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIDiscBlur"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputRadius"</span>,@<span class="number">25</span>,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> <img src="https://oscimg.oschina.net/oscnet/8a07c22385ba4bb9285a2e152436ad58e1b.jpg" alt></p>
<ul>
<li>高斯模糊过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIGaussianBlur"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputRadius"</span>,@<span class="number">10</span>,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> <img src="https://oscimg.oschina.net/oscnet/1ec99843fe70181a3bf4e29e8264d7b74bc.jpg" alt></p>
<ul>
<li>梯度模糊过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIMorphologyGradient"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputRadius"</span>,@<span class="number">5</span>,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> <img src="https://oscimg.oschina.net/oscnet/8e844ccec3c5c6d2c4e3f3cf2f250a9ab25.jpg" alt></p>
<ul>
<li>运动模糊过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIMotionBlur"</span> keysAndValues:kCIInputImageKey,image2,<span class="string">@"inputRadius"</span>,@<span class="number">5</span>,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> <img src="https://oscimg.oschina.net/oscnet/52d5736d529ee61992cd8c9b452ed661c07.jpg" alt></p>
<ul>
<li>缩放模糊过滤器</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CIFilter</span> * filter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIZoomBlur"</span> keysAndValues:kCIInputImageKey,image2,<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p> <img src="https://oscimg.oschina.net/oscnet/667e5456ffdd5bc7b8ed15e26ebdf006ba9.jpg" alt></p>
<h4 id="5-自定义过滤器"><a href="#5-自定义过滤器" class="headerlink" title="5.自定义过滤器"></a>5.自定义过滤器</h4><pre><code>上面演示了非常多的常用内置过滤器，我们也可以通过继承CIFilter来自定义过滤器。

自定义过滤器之前，首先需要了解CIKernel这个类，CIKernel是Core Image Kernel Language 的抽象对象。CIKL是CoreImage中专门用来编写像素处理函数的语言。
</code></pre><p>CIKernel相关类解析如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//基类 用于通用的过滤函数</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CIKernel</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="comment">//从字符串加载一组过滤函数</span></span><br><span class="line">+ (<span class="keyword">nullable</span> <span class="built_in">NSArray</span>&lt;<span class="built_in">CIKernel</span> *&gt; *)kernelsWithString:(<span class="built_in">NSString</span> *)string;</span><br><span class="line"><span class="comment">//从字符串加载一个过滤函数</span></span><br><span class="line">+ (<span class="keyword">nullable</span> <span class="keyword">instancetype</span>)kernelWithString:(<span class="built_in">NSString</span> *)string ;</span><br><span class="line"><span class="comment">//名称</span></span><br><span class="line"><span class="keyword">@property</span> (atomic, <span class="keyword">readonly</span>) <span class="built_in">NSString</span> *name ;</span><br><span class="line"><span class="comment">//进行图片生成</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">CIImage</span> *)applyWithExtent:(<span class="built_in">CGRect</span>)extent</span><br><span class="line">                          roiCallback:(<span class="built_in">CIKernelROICallback</span>)callback</span><br><span class="line">                            arguments:(<span class="keyword">nullable</span> <span class="built_in">NSArray</span>&lt;<span class="keyword">id</span>&gt; *)args;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="comment">//用于颜色修正的过滤函数</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CIColorKernel</span> : <span class="title">CIKernel</span></span></span><br><span class="line">+ (<span class="keyword">nullable</span> <span class="keyword">instancetype</span>)kernelWithString:(<span class="built_in">NSString</span> *)string;</span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">CIImage</span> *)applyWithExtent:(<span class="built_in">CGRect</span>)extent</span><br><span class="line">                            arguments:(<span class="keyword">nullable</span> <span class="built_in">NSArray</span>&lt;<span class="keyword">id</span>&gt; *)args;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="comment">//用于形状修正的过滤函数</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CIWarpKernel</span> : <span class="title">CIKernel</span></span></span><br><span class="line">+ (<span class="keyword">nullable</span> <span class="keyword">instancetype</span>)kernelWithString:(<span class="built_in">NSString</span> *)string;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="comment">//用于色彩混合的过滤函数</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CIBlendKernel</span> : <span class="title">CIColorKernel</span></span></span><br><span class="line">+ (<span class="keyword">nullable</span> <span class="keyword">instancetype</span>)kernelWithString:(<span class="built_in">NSString</span> *)string;</span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">CIImage</span> *)applyWithForeground:(<span class="built_in">CIImage</span>*)foreground</span><br><span class="line">                               background:(<span class="built_in">CIImage</span>*)background;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>下面是一个简单的翻转图像的自定义过滤器示意，首先新建一个新的cikernel文件，命名为a.cikernel，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kernel vec2 mirrorX ( float imageWidth )</span><br><span class="line">&#123;</span><br><span class="line">// 获取待处理点的位置</span><br><span class="line">vec2 currentVec = destCoord();</span><br><span class="line">// 返回最终显示位置</span><br><span class="line">return vec2 ( imageWidth - currentVec.x , currentVec.y );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>新建一个过滤器类，命名为MyFilter，如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;CoreImage/CoreImage.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyFilter</span> : <span class="title">CIFilter</span></span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>)<span class="built_in">CIImage</span> * inputImage;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"MyFilter.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyFilter</span>()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>)<span class="built_in">CIWarpKernel</span> * kernel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MyFilter</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)init &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">            <span class="comment">//从文件读取过滤函数</span></span><br><span class="line">            <span class="built_in">NSBundle</span> *bundle = [<span class="built_in">NSBundle</span> bundleForClass: [<span class="keyword">self</span> <span class="keyword">class</span>]];</span><br><span class="line">            <span class="built_in">NSURL</span> *kernelURL = [bundle URLForResource:<span class="string">@"a"</span> withExtension:<span class="string">@"cikernel"</span>];</span><br><span class="line">            <span class="built_in">NSError</span> *error;</span><br><span class="line">            <span class="built_in">NSString</span> *kernelCode = [<span class="built_in">NSString</span> stringWithContentsOfURL:kernelURL</span><br><span class="line">                                                            encoding:<span class="built_in">NSUTF8StringEncoding</span> error:&amp;error];</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">NSArray</span> *kernels = [<span class="built_in">CIKernel</span> kernelsWithString:kernelCode];</span><br><span class="line">            <span class="keyword">self</span>.kernel = [kernels objectAtIndex:<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">CIImage</span> *)outputImage</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CGFloat</span> inputWidth = <span class="keyword">self</span>.inputImage.extent.size.width;</span><br><span class="line">    <span class="built_in">CIImage</span> *result = [<span class="keyword">self</span>.kernel applyWithExtent:<span class="keyword">self</span>.inputImage.extent roiCallback:^<span class="built_in">CGRect</span>(<span class="keyword">int</span> index, <span class="built_in">CGRect</span> destRect) &#123;</span><br><span class="line">        <span class="keyword">return</span> destRect;</span><br><span class="line">    &#125; inputImage:<span class="keyword">self</span>.inputImage arguments:@[@(inputWidth)]];</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//设置说明字典</span></span><br><span class="line">-(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *,<span class="keyword">id</span>&gt; *)attributes&#123;</span><br><span class="line">    <span class="keyword">return</span> @&#123;</span><br><span class="line">             <span class="string">@"inputImage"</span> :  @&#123;</span><br><span class="line">                 <span class="string">@"CIAttributeClass"</span> : <span class="string">@"CIImage"</span>,</span><br><span class="line">                 <span class="string">@"CIAttributeDisplayName"</span> : <span class="string">@"Image--"</span>,</span><br><span class="line">                 <span class="string">@"CIAttributeType"</span> : <span class="string">@"CIAttributeTypeImage"</span></span><br><span class="line">                 &#125;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>如下进行使用即可：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MyFilter * filter = [[MyFilter alloc]init];</span><br><span class="line">filter.inputImage = image2;</span><br><span class="line"><span class="built_in">CIContext</span> * context = [[<span class="built_in">CIContext</span> alloc]initWithOptions:<span class="literal">nil</span>];</span><br><span class="line"><span class="built_in">CIImage</span> * output = [filter outputImage];</span><br><span class="line"><span class="built_in">CGImageRef</span> ref = [context createCGImage:output fromRect:output.extent];</span><br><span class="line"><span class="built_in">UIImage</span> * newImage = [<span class="built_in">UIImage</span> imageWithCGImage:ref];</span><br></pre></td></tr></table></figure>
<h3 id="二、使用CoreImage实现人脸识别"><a href="#二、使用CoreImage实现人脸识别" class="headerlink" title="二、使用CoreImage实现人脸识别"></a>二、使用CoreImage实现人脸识别</h3><pre><code>人脸识别是目前非常热门的一种图像处理技术，CoreImage内置了对人脸进行识别的相关功能接口，并且可以对人脸面部特征进行抓取，下面我们来实现一个简单的实时识别人脸特征的Demo。

首先创建一个视图作为图像扫描视图，如下：
</code></pre><p>.h文件</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//.h 文件</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">FaceView</span> : <span class="title">UIView</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p> .m文件</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  FaceView.m</span></span><br><span class="line"><span class="comment">//  CoreImageDemo</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by jaki on 2018/12/22.</span></span><br><span class="line"><span class="comment">//  Copyright © 2018年 jaki. All rights reserved.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">"FaceView.h"</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;AVFoundation/AVFoundation.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">"FaceHandle.h"</span></span></span><br><span class="line"><span class="comment">//定义线程</span></span><br><span class="line"><span class="meta">#define FACE_SCAN_QUEUE <span class="meta-string">"FACE_SCAN_QUEUE"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">FaceView</span>()&lt;<span class="title">AVCaptureVideoDataOutputSampleBufferDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>)<span class="built_in">AVCaptureSession</span> *captureSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>)<span class="built_in">AVCaptureDeviceInput</span> * captureInput;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>)<span class="built_in">AVCaptureVideoDataOutput</span> * captureOutput;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonnull</span>,<span class="keyword">strong</span>)<span class="built_in">AVCaptureVideoPreviewLayer</span> * videoLayer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>)<span class="built_in">dispatch_queue_t</span> queue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>)<span class="built_in">BOOL</span> hasHandle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>)<span class="built_in">UIView</span> * faceView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">FaceView</span></span></span><br><span class="line"><span class="meta">#pragma mark - Override</span></span><br><span class="line">-(<span class="keyword">instancetype</span>)init&#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        [<span class="keyword">self</span> install];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="keyword">instancetype</span>)initWithFrame:(<span class="built_in">CGRect</span>)frame&#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        [<span class="keyword">self</span> install];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line">-(<span class="keyword">void</span>)layoutSubviews&#123;</span><br><span class="line">    [<span class="keyword">super</span> layoutSubviews];</span><br><span class="line">    <span class="keyword">self</span>.videoLayer.frame = <span class="keyword">self</span>.bounds;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - InnerFunc</span></span><br><span class="line">-(<span class="keyword">void</span>)install&#123;</span><br><span class="line">    <span class="keyword">if</span> (![<span class="built_in">UIImagePickerController</span> isSourceTypeAvailable:<span class="built_in">UIImagePickerControllerSourceTypeCamera</span>]) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"不支持"</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">self</span>.queue = dispatch_queue_create(FACE_SCAN_QUEUE, <span class="literal">NULL</span>);</span><br><span class="line">    [<span class="keyword">self</span>.captureSession startRunning];</span><br><span class="line">    <span class="built_in">AVAuthorizationStatus</span> status = [<span class="built_in">AVCaptureDevice</span> authorizationStatusForMediaType:<span class="built_in">AVMediaTypeVideo</span>];</span><br><span class="line">    <span class="keyword">if</span> (status!=<span class="built_in">AVAuthorizationStatusAuthorized</span>) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"需要权限"</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">self</span>.videoLayer = [<span class="built_in">AVCaptureVideoPreviewLayer</span> layerWithSession:<span class="keyword">self</span>.captureSession];</span><br><span class="line">    <span class="keyword">self</span>.videoLayer.frame = <span class="built_in">CGRectZero</span>;</span><br><span class="line">    <span class="keyword">self</span>.videoLayer.videoGravity = <span class="built_in">AVLayerVideoGravityResizeAspectFill</span>;</span><br><span class="line">    [<span class="keyword">self</span>.layer addSublayer:<span class="keyword">self</span>.videoLayer];</span><br><span class="line">    [<span class="keyword">self</span> addSubview:<span class="keyword">self</span>.faceView];</span><br><span class="line">    <span class="keyword">self</span>.faceView.frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="keyword">self</span>.frame.size.width, <span class="keyword">self</span>.frame.size.height);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//将人脸特征点标记出来</span></span><br><span class="line">-(<span class="keyword">void</span>)renderReactWithInfo:(<span class="built_in">NSDictionary</span> *)info&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">UIView</span> * v <span class="keyword">in</span> <span class="keyword">self</span>.faceView.subviews) &#123;</span><br><span class="line">        [v removeFromSuperview];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">NSArray</span> * faceArray = info[FACE_HANDLE_INFO_FACE_ARRAY];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; faceArray.count; i++) &#123;</span><br><span class="line">        <span class="built_in">NSDictionary</span> * face = faceArray[i];</span><br><span class="line">        <span class="built_in">NSValue</span> * faceValue = face[FACE_HANDLE_INFO_FACE_FRAME];</span><br><span class="line">        <span class="keyword">if</span> (faceValue) &#123;</span><br><span class="line">            <span class="built_in">CGRect</span> faceR = [faceValue <span class="built_in">CGRectValue</span>];</span><br><span class="line">            <span class="built_in">UIView</span> * faceView = [[<span class="built_in">UIView</span> alloc]initWithFrame:faceR];</span><br><span class="line">            faceView.backgroundColor = [<span class="built_in">UIColor</span> clearColor];</span><br><span class="line">            faceView.layer.borderColor = [<span class="built_in">UIColor</span> redColor].CGColor;</span><br><span class="line">            faceView.layer.borderWidth = <span class="number">2</span>;</span><br><span class="line">            [<span class="keyword">self</span>.faceView addSubview:faceView];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">NSValue</span> * leftEye = face[FACE_HANDLE_INFO_FACE_LEFT_EYE_FRAME];</span><br><span class="line">        <span class="keyword">if</span> (leftEye) &#123;</span><br><span class="line">            <span class="built_in">CGRect</span> leftEyeR = [leftEye <span class="built_in">CGRectValue</span>];</span><br><span class="line">            <span class="built_in">UIView</span> * eye = [[<span class="built_in">UIView</span> alloc]initWithFrame:leftEyeR];</span><br><span class="line">            eye.backgroundColor = [<span class="built_in">UIColor</span> clearColor];</span><br><span class="line">            eye.layer.borderColor = [<span class="built_in">UIColor</span> greenColor].CGColor;</span><br><span class="line">            eye.layer.borderWidth = <span class="number">2</span>;</span><br><span class="line">            [<span class="keyword">self</span>.faceView addSubview:eye];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">NSValue</span> * rightEye = face[FACE_HANDLE_INFO_FACE_RIGHT_EYE_FRAME];</span><br><span class="line">        <span class="keyword">if</span> (rightEye) &#123;</span><br><span class="line">            <span class="built_in">CGRect</span> rightEyeR = [rightEye <span class="built_in">CGRectValue</span>];</span><br><span class="line">            <span class="built_in">UIView</span> * eye = [[<span class="built_in">UIView</span> alloc]initWithFrame:rightEyeR];</span><br><span class="line">            eye.backgroundColor = [<span class="built_in">UIColor</span> clearColor];</span><br><span class="line">            eye.layer.borderColor = [<span class="built_in">UIColor</span> greenColor].CGColor;</span><br><span class="line">            eye.layer.borderWidth = <span class="number">2</span>;</span><br><span class="line">            [<span class="keyword">self</span>.faceView addSubview:eye];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">NSValue</span> * mouth = face[FACE_HANDLE_INFO_FACE_MOUTH_FRAME];</span><br><span class="line">        <span class="keyword">if</span> (mouth) &#123;</span><br><span class="line">            <span class="built_in">CGRect</span> mouthR = [mouth <span class="built_in">CGRectValue</span>];</span><br><span class="line">            <span class="built_in">UIView</span> * mouth = [[<span class="built_in">UIView</span> alloc]initWithFrame:mouthR];</span><br><span class="line">            mouth.backgroundColor = [<span class="built_in">UIColor</span> clearColor];</span><br><span class="line">            mouth.layer.borderColor = [<span class="built_in">UIColor</span> orangeColor].CGColor;</span><br><span class="line">            mouth.layer.borderWidth = <span class="number">2</span>;</span><br><span class="line">            [<span class="keyword">self</span>.faceView addSubview:mouth];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma AVDelegate</span></span><br><span class="line"><span class="comment">//进行画面的捕获</span></span><br><span class="line">-(<span class="keyword">void</span>)captureOutput:(<span class="built_in">AVCaptureOutput</span> *)output didOutputSampleBuffer:(<span class="built_in">CMSampleBufferRef</span>)sampleBuffer fromConnection:(<span class="built_in">AVCaptureConnection</span> *)connection&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.hasHandle) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">self</span>.hasHandle = <span class="literal">YES</span>;</span><br><span class="line">    CVImageBufferRef imageBuffer = <span class="built_in">CMSampleBufferGetImageBuffer</span>(sampleBuffer);</span><br><span class="line">    CVPixelBufferLockBaseAddress(imageBuffer,<span class="number">0</span>);</span><br><span class="line">    uint8_t *baseAddress = (uint8_t *)CVPixelBufferGetBaseAddress(imageBuffer);</span><br><span class="line">    size_t bytesPerRow = CVPixelBufferGetBytesPerRow(imageBuffer);</span><br><span class="line">    size_t width = CVPixelBufferGetWidth(imageBuffer);</span><br><span class="line">    size_t height = CVPixelBufferGetHeight(imageBuffer);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGColorSpaceRef</span> colorSpace = <span class="built_in">CGColorSpaceCreateDeviceRGB</span>();</span><br><span class="line">    <span class="built_in">CGContextRef</span> newContext = <span class="built_in">CGBitmapContextCreate</span>(baseAddress,width, height, <span class="number">8</span>, bytesPerRow, colorSpace,kCGBitmapByteOrder32Little | kCGImageAlphaPremultipliedFirst);</span><br><span class="line">    <span class="built_in">CGImageRef</span> newImage = <span class="built_in">CGBitmapContextCreateImage</span>(newContext);</span><br><span class="line">    <span class="built_in">CGContextRelease</span>(newContext);</span><br><span class="line">    <span class="built_in">CGColorSpaceRelease</span>(colorSpace);</span><br><span class="line">    <span class="built_in">UIImage</span> *image= [<span class="built_in">UIImage</span> imageWithCGImage:newImage scale:<span class="number">1.0</span> orientation:<span class="built_in">UIImageOrientationRight</span>];</span><br><span class="line">    <span class="built_in">CGImageRelease</span>(newImage);</span><br><span class="line">    <span class="comment">//image</span></span><br><span class="line">     <span class="comment">//进行人脸识别的核心工具类</span></span><br><span class="line">    [[FaceHandle sharedInstance] handleImage:image viewSize:<span class="keyword">self</span>.frame.size completed:^(<span class="built_in">BOOL</span> success, <span class="built_in">NSDictionary</span> *info) &#123;</span><br><span class="line">        <span class="keyword">self</span>.hasHandle  = <span class="literal">NO</span>;</span><br><span class="line">        [<span class="keyword">self</span> renderReactWithInfo:info];</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    CVPixelBufferUnlockBaseAddress(imageBuffer,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - setter and getter</span></span><br><span class="line"></span><br><span class="line">-(<span class="built_in">AVCaptureSession</span> *)captureSession&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_captureSession) &#123;</span><br><span class="line">        _captureSession = [[<span class="built_in">AVCaptureSession</span> alloc]init];</span><br><span class="line">        [_captureSession addInput:<span class="keyword">self</span>.captureInput];</span><br><span class="line">        [_captureSession addOutput:<span class="keyword">self</span>.captureOutput];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _captureSession;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="built_in">AVCaptureDeviceInput</span> *)captureInput&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_captureInput) &#123;</span><br><span class="line">        _captureInput = [<span class="built_in">AVCaptureDeviceInput</span> deviceInputWithDevice:[<span class="built_in">AVCaptureDevice</span> defaultDeviceWithMediaType:<span class="built_in">AVMediaTypeVideo</span>] error:<span class="literal">nil</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _captureInput;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="built_in">AVCaptureVideoDataOutput</span> *)captureOutput&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_captureOutput) &#123;</span><br><span class="line">        _captureOutput = [[<span class="built_in">AVCaptureVideoDataOutput</span> alloc]init];</span><br><span class="line">        _captureOutput.alwaysDiscardsLateVideoFrames = <span class="literal">YES</span>;</span><br><span class="line">        [_captureOutput setSampleBufferDelegate:<span class="keyword">self</span> queue:<span class="keyword">self</span>.queue];</span><br><span class="line">        _captureOutput.videoSettings = @&#123;(__bridge <span class="built_in">NSString</span> *)kCVPixelBufferPixelFormatTypeKey:@(kCVPixelFormatType_32BGRA)&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _captureOutput;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-(<span class="built_in">UIView</span> *)faceView&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_faceView) &#123;</span><br><span class="line">        _faceView = [[<span class="built_in">UIView</span> alloc]init];</span><br><span class="line">        _faceView.backgroundColor = [<span class="built_in">UIColor</span> clearColor];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _faceView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>在真机上运行工程，通过摄像头可以将实时的画面捕获到屏幕上，下面实现核心的人脸识别代码：</p>
<p>创建继承于NSObject的FaceHandle类，如下：</p>
<p>.h文件</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="built_in">NSString</span> * FACE_HANDLE_INFO_FACE_ARRAY;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="built_in">NSString</span> * FACE_HANDLE_INFO_FACE_FRAME;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="built_in">NSString</span> * FACE_HANDLE_INFO_FACE_LEFT_EYE_FRAME;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="built_in">NSString</span> * FACE_HANDLE_INFO_FACE_RIGHT_EYE_FRAME;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="built_in">NSString</span> * FACE_HANDLE_INFO_FACE_MOUTH_FRAME;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="built_in">NSString</span> * FACE_HANDLE_INFO_ERROR;</span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">FaceHandle</span> : <span class="title">NSObject</span></span></span><br><span class="line">+(<span class="keyword">instancetype</span>)sharedInstance;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-(<span class="keyword">void</span>)handleImage:(<span class="built_in">UIImage</span> *)image viewSize:(<span class="built_in">CGSize</span> )viewSize completed:(<span class="keyword">void</span>(^)(<span class="built_in">BOOL</span>  success,<span class="built_in">NSDictionary</span> * info))completion;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>.m文件</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"FaceHandle.h"</span></span></span><br><span class="line"><span class="meta">#define FACE_HANDLE_DISPATCH_QUEUE <span class="meta-string">"FACE_HANDLE_DISPATCH_QUEUE"</span></span></span><br><span class="line"><span class="keyword">const</span> <span class="built_in">NSString</span> * FACE_HANDLE_INFO_FACE_FRAME = <span class="string">@"FACE_HANDLE_INFO_FACE_FRAME"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="built_in">NSString</span> * FACE_HANDLE_INFO_FACE_LEFT_EYE_FRAME = <span class="string">@"FACE_HANDLE_INFO_FACE_LEFT_EYE_FRAME"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="built_in">NSString</span> * FACE_HANDLE_INFO_FACE_RIGHT_EYE_FRAME = <span class="string">@"FACE_HANDLE_INFO_FACE_RIGHT_EYE_FRAME"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="built_in">NSString</span> * FACE_HANDLE_INFO_FACE_MOUTH_FRAME = <span class="string">@"FACE_HANDLE_INFO_FACE_MOUTH_FRAME"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="built_in">NSString</span> * FACE_HANDLE_INFO_ERROR = <span class="string">@"FACE_HANDLE_INFO_ERROR"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="built_in">NSString</span> * FACE_HANDLE_INFO_FACE_ARRAY = <span class="string">@"FACE_HANDLE_INFO_FACE_ARRAY"</span>;</span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">FaceHandle</span>()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>)<span class="built_in">dispatch_queue_t</span> workingQueue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">FaceHandle</span></span></span><br><span class="line"></span><br><span class="line">+(<span class="keyword">instancetype</span>)sharedInstance&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line">    <span class="keyword">static</span> FaceHandle * sharedInstance = <span class="literal">nil</span>;</span><br><span class="line">    <span class="keyword">if</span> (!sharedInstance) &#123;</span><br><span class="line">        <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line">            sharedInstance = [[FaceHandle alloc] init];</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sharedInstance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - Override</span></span><br><span class="line">-(<span class="keyword">instancetype</span>)init&#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.workingQueue = dispatch_queue_create(FACE_HANDLE_DISPATCH_QUEUE, <span class="literal">NULL</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - InnerFunc</span></span><br><span class="line">-(<span class="keyword">void</span>)handleImage:(<span class="built_in">UIImage</span> *)image viewSize:(<span class="built_in">CGSize</span> )viewSize completed:(<span class="keyword">void</span> (^)(<span class="built_in">BOOL</span> , <span class="built_in">NSDictionary</span> *))completion&#123;</span><br><span class="line">    <span class="keyword">if</span> (!image) &#123;</span><br><span class="line">        <span class="keyword">if</span> (completion) &#123;</span><br><span class="line">            completion(<span class="literal">NO</span>,@&#123;FACE_HANDLE_INFO_ERROR:<span class="string">@"图片捕获出错"</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dispatch_async</span>(<span class="keyword">self</span>.workingQueue, ^&#123;</span><br><span class="line">        <span class="built_in">UIImage</span> * newImage = [<span class="keyword">self</span> strectImage:image withSize:viewSize];</span><br><span class="line">        <span class="keyword">if</span> (newImage) &#123;</span><br><span class="line">            <span class="built_in">NSArray</span> * faceArray = [<span class="keyword">self</span> analyseFaceImage:newImage];</span><br><span class="line">            <span class="keyword">if</span> (completion) &#123;</span><br><span class="line">                <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                    completion(<span class="literal">YES</span>,@&#123;FACE_HANDLE_INFO_FACE_ARRAY:faceArray&#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (completion) &#123;</span><br><span class="line">                <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                    completion(<span class="literal">NO</span>,@&#123;FACE_HANDLE_INFO_ERROR:<span class="string">@"图片识别出错"</span>&#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//图片放大处理</span></span><br><span class="line">-(<span class="built_in">UIImage</span> *)strectImage:(<span class="built_in">UIImage</span> *)img withSize:(<span class="built_in">CGSize</span>)size&#123;</span><br><span class="line">    <span class="built_in">UIGraphicsBeginImageContext</span>(size);</span><br><span class="line">    <span class="built_in">CGRect</span> thumbnailRect = <span class="built_in">CGRectZero</span>;</span><br><span class="line">    thumbnailRect.origin = <span class="built_in">CGPointMake</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    thumbnailRect.size.width  = size.width;</span><br><span class="line">    thumbnailRect.size.height = size.height;</span><br><span class="line">    [img drawInRect:thumbnailRect];</span><br><span class="line">    <span class="built_in">UIImage</span> * newImage = <span class="built_in">UIGraphicsGetImageFromCurrentImageContext</span>();</span><br><span class="line">    <span class="built_in">UIGraphicsEndImageContext</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (newImage) &#123;</span><br><span class="line">        <span class="keyword">return</span>  newImage;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="built_in">NSArray</span> *)analyseFaceImage:(<span class="built_in">UIImage</span> *)image&#123;</span><br><span class="line">    <span class="built_in">NSMutableArray</span> * dataArray = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">    <span class="built_in">CIImage</span> * cImage = [<span class="built_in">CIImage</span> imageWithCGImage:image.CGImage];</span><br><span class="line">    <span class="built_in">NSDictionary</span>* opts = [<span class="built_in">NSDictionary</span> dictionaryWithObject:</span><br><span class="line">                          <span class="built_in">CIDetectorAccuracyHigh</span> forKey:<span class="built_in">CIDetectorAccuracy</span>];</span><br><span class="line">    <span class="comment">//进行分析</span></span><br><span class="line">    <span class="built_in">CIDetector</span>* detector = [<span class="built_in">CIDetector</span> detectorOfType:<span class="built_in">CIDetectorTypeFace</span></span><br><span class="line">                                              context:<span class="literal">nil</span> options:opts];</span><br><span class="line">    <span class="comment">//获取特征数组</span></span><br><span class="line">    <span class="built_in">NSArray</span>* features = [detector featuresInImage:cImage];</span><br><span class="line">    <span class="built_in">CGSize</span> inputImageSize = [cImage extent].size;</span><br><span class="line">    <span class="built_in">CGAffineTransform</span>  transform = <span class="built_in">CGAffineTransformIdentity</span>;</span><br><span class="line">    transform = <span class="built_in">CGAffineTransformScale</span>(transform, <span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line">    transform = <span class="built_in">CGAffineTransformTranslate</span>(transform, <span class="number">0</span>, -inputImageSize.height);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">CIFaceFeature</span> *faceFeature <span class="keyword">in</span> features)&#123;</span><br><span class="line">        <span class="built_in">NSMutableDictionary</span> * faceDic = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">        <span class="built_in">CGRect</span> faceViewBounds = <span class="built_in">CGRectApplyAffineTransform</span>(faceFeature.bounds, transform);</span><br><span class="line">        [faceDic setValue:[<span class="built_in">NSValue</span> valueWithCGRect:faceViewBounds] forKey:(<span class="built_in">NSString</span> *)FACE_HANDLE_INFO_FACE_FRAME];</span><br><span class="line">        <span class="built_in">CGFloat</span> faceWidth = faceFeature.bounds.size.width;</span><br><span class="line">        <span class="keyword">if</span>(faceFeature.hasLeftEyePosition)&#123;</span><br><span class="line">            <span class="built_in">CGPoint</span> faceViewLeftPoint = <span class="built_in">CGPointApplyAffineTransform</span>(faceFeature.leftEyePosition, transform);</span><br><span class="line">            <span class="built_in">CGRect</span> leftEyeBounds = <span class="built_in">CGRectMake</span>(faceViewLeftPoint.x-faceWidth*<span class="number">0.1</span>, faceViewLeftPoint.y-faceWidth*<span class="number">0.1</span>, faceWidth*<span class="number">0.2</span>, faceWidth*<span class="number">0.2</span>);</span><br><span class="line">            [faceDic setValue:[<span class="built_in">NSValue</span> valueWithCGRect:leftEyeBounds] forKey:(<span class="built_in">NSString</span> *)FACE_HANDLE_INFO_FACE_LEFT_EYE_FRAME];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(faceFeature.hasRightEyePosition)&#123;</span><br><span class="line">            <span class="comment">//获取人右眼对应的point</span></span><br><span class="line">            <span class="built_in">CGPoint</span> faceViewRightPoint = <span class="built_in">CGPointApplyAffineTransform</span>(faceFeature.rightEyePosition, transform);</span><br><span class="line">            <span class="built_in">CGRect</span> rightEyeBounds = <span class="built_in">CGRectMake</span>(faceViewRightPoint.x-faceWidth*<span class="number">0.1</span>, faceViewRightPoint.y-faceWidth*<span class="number">0.1</span>, faceWidth*<span class="number">0.2</span>, faceWidth*<span class="number">0.2</span>);</span><br><span class="line">            [faceDic setValue:[<span class="built_in">NSValue</span> valueWithCGRect:rightEyeBounds] forKey:(<span class="built_in">NSString</span> *)FACE_HANDLE_INFO_FACE_RIGHT_EYE_FRAME];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(faceFeature.hasMouthPosition)&#123;</span><br><span class="line">            <span class="comment">//获取人嘴巴对应的point</span></span><br><span class="line">            <span class="built_in">CGPoint</span> faceViewMouthPoint = <span class="built_in">CGPointApplyAffineTransform</span>(faceFeature.mouthPosition, transform);</span><br><span class="line">            <span class="built_in">CGRect</span> mouthBounds = <span class="built_in">CGRectMake</span>(faceViewMouthPoint.x-faceWidth*<span class="number">0.2</span>, faceViewMouthPoint.y-faceWidth*<span class="number">0.2</span>, faceWidth*<span class="number">0.4</span>, faceWidth*<span class="number">0.4</span>);</span><br><span class="line">            [faceDic setValue:[<span class="built_in">NSValue</span> valueWithCGRect:mouthBounds] forKey:(<span class="built_in">NSString</span> *)FACE_HANDLE_INFO_FACE_MOUTH_FRAME];</span><br><span class="line">        &#125;</span><br><span class="line">        [dataArray addObject:faceDic];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [dataArray <span class="keyword">copy</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>打开百度，随便搜索一些人脸图片进行识别，可以看到识别率还是很高，如下图：</p>
<p><img src="https://oscimg.oschina.net/oscnet/888a36f9fe83db22a5aef849152a8ec7952.jpg" alt></p>
<h3 id="三、CIImage中提供了其他图像识别功能"><a href="#三、CIImage中提供了其他图像识别功能" class="headerlink" title="三、CIImage中提供了其他图像识别功能"></a>三、CIImage中提供了其他图像识别功能</h3><pre><code>CIDetector除了可以用来进行人脸识别外，还支持进行二维码、矩形、文字等检测。
</code></pre><p>矩形区域识别，用来检测图像中的矩形边界，核心代码如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="built_in">NSArray</span> *)analyseRectImage:(<span class="built_in">UIImage</span> *)image&#123;</span><br><span class="line">    <span class="built_in">NSMutableArray</span> * dataArray = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">    <span class="built_in">CIImage</span> * cImage = [<span class="built_in">CIImage</span> imageWithCGImage:image.CGImage];</span><br><span class="line">    <span class="built_in">NSDictionary</span>* opts = [<span class="built_in">NSDictionary</span> dictionaryWithObject:</span><br><span class="line">                          <span class="built_in">CIDetectorAccuracyHigh</span> forKey:<span class="built_in">CIDetectorAccuracy</span>];</span><br><span class="line">    <span class="built_in">CIDetector</span>* detector = [<span class="built_in">CIDetector</span> detectorOfType:<span class="built_in">CIDetectorTypeRectangle</span></span><br><span class="line">                                              context:<span class="literal">nil</span> options:opts];</span><br><span class="line">    <span class="built_in">NSArray</span>* features = [detector featuresInImage:cImage];</span><br><span class="line">    <span class="built_in">CGSize</span> inputImageSize = [cImage extent].size;</span><br><span class="line">    <span class="built_in">CGAffineTransform</span>  transform = <span class="built_in">CGAffineTransformIdentity</span>;</span><br><span class="line">    transform = <span class="built_in">CGAffineTransformScale</span>(transform, <span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line">    transform = <span class="built_in">CGAffineTransformTranslate</span>(transform, <span class="number">0</span>, -inputImageSize.height);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">CIRectangleFeature</span> *feature <span class="keyword">in</span> features)&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%lu"</span>,features.count);</span><br><span class="line">        <span class="built_in">NSMutableDictionary</span> * dic = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">        <span class="built_in">CGRect</span> viewBounds = <span class="built_in">CGRectApplyAffineTransform</span>(feature.bounds, transform);</span><br><span class="line">        [dic setValue:[<span class="built_in">NSValue</span> valueWithCGRect:viewBounds] forKey:<span class="string">@"rectBounds"</span>];</span><br><span class="line">        <span class="built_in">CGPoint</span> topLeft = <span class="built_in">CGPointApplyAffineTransform</span>(feature.topLeft, transform);</span><br><span class="line">        [dic setValue:[<span class="built_in">NSValue</span> valueWithCGPoint:topLeft] forKey:<span class="string">@"topLeft"</span>];</span><br><span class="line">        <span class="built_in">CGPoint</span> topRight = <span class="built_in">CGPointApplyAffineTransform</span>(feature.topRight, transform);</span><br><span class="line">        [dic setValue:[<span class="built_in">NSValue</span> valueWithCGPoint:topRight] forKey:<span class="string">@"topRight"</span>];</span><br><span class="line">        <span class="built_in">CGPoint</span> bottomLeft = <span class="built_in">CGPointApplyAffineTransform</span>(feature.bottomLeft, transform);</span><br><span class="line">        [dic setValue:[<span class="built_in">NSValue</span> valueWithCGPoint:bottomLeft] forKey:<span class="string">@"bottomLeft"</span>];</span><br><span class="line">        <span class="built_in">CGPoint</span> bottomRight = <span class="built_in">CGPointApplyAffineTransform</span>(feature.bottomRight, transform);</span><br><span class="line">        [dic setValue:[<span class="built_in">NSValue</span> valueWithCGPoint:bottomRight] forKey:<span class="string">@"bottomRight"</span>];</span><br><span class="line">        [dataArray addObject:dic];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [dataArray <span class="keyword">copy</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下图所示：</p>
<p><img src="https://oscimg.oschina.net/oscnet/335f852c44be9223f6cf37c87b21815de6a.jpg" alt></p>
<p>二维码扫描不仅可以分析出图片中的二维码位置，还可以解析出二维码数据，核心代码如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="built_in">NSArray</span> *)analyseQRImage:(<span class="built_in">UIImage</span> *)image&#123;</span><br><span class="line">    <span class="built_in">NSMutableArray</span> * dataArray = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">    <span class="built_in">CIImage</span> * cImage = [<span class="built_in">CIImage</span> imageWithCGImage:image.CGImage];</span><br><span class="line">    <span class="built_in">NSDictionary</span>* opts = [<span class="built_in">NSDictionary</span> dictionaryWithObject:</span><br><span class="line">                          <span class="built_in">CIDetectorAccuracyHigh</span> forKey:<span class="built_in">CIDetectorAccuracy</span>];</span><br><span class="line">    <span class="built_in">CIDetector</span>* detector = [<span class="built_in">CIDetector</span> detectorOfType:<span class="built_in">CIDetectorTypeQRCode</span></span><br><span class="line">                                              context:<span class="literal">nil</span> options:opts];</span><br><span class="line">    <span class="built_in">NSArray</span>* features = [detector featuresInImage:cImage];</span><br><span class="line">    <span class="built_in">CGSize</span> inputImageSize = [cImage extent].size;</span><br><span class="line">    <span class="built_in">CGAffineTransform</span>  transform = <span class="built_in">CGAffineTransformIdentity</span>;</span><br><span class="line">    transform = <span class="built_in">CGAffineTransformScale</span>(transform, <span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line">    transform = <span class="built_in">CGAffineTransformTranslate</span>(transform, <span class="number">0</span>, -inputImageSize.height);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">CIQRCodeFeature</span> *feature <span class="keyword">in</span> features)&#123;</span><br><span class="line">        <span class="built_in">NSMutableDictionary</span> * dic = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">        <span class="built_in">CGRect</span> viewBounds = <span class="built_in">CGRectApplyAffineTransform</span>(feature.bounds, transform);</span><br><span class="line">        [dic setValue:[<span class="built_in">NSValue</span> valueWithCGRect:viewBounds] forKey:<span class="string">@"rectBounds"</span>];</span><br><span class="line">        <span class="built_in">CGPoint</span> topLeft = <span class="built_in">CGPointApplyAffineTransform</span>(feature.topLeft, transform);</span><br><span class="line">        [dic setValue:[<span class="built_in">NSValue</span> valueWithCGPoint:topLeft] forKey:<span class="string">@"topLeft"</span>];</span><br><span class="line">        <span class="built_in">CGPoint</span> topRight = <span class="built_in">CGPointApplyAffineTransform</span>(feature.topRight, transform);</span><br><span class="line">        [dic setValue:[<span class="built_in">NSValue</span> valueWithCGPoint:topRight] forKey:<span class="string">@"topRight"</span>];</span><br><span class="line">        <span class="built_in">CGPoint</span> bottomLeft = <span class="built_in">CGPointApplyAffineTransform</span>(feature.bottomLeft, transform);</span><br><span class="line">        [dic setValue:[<span class="built_in">NSValue</span> valueWithCGPoint:bottomLeft] forKey:<span class="string">@"bottomLeft"</span>];</span><br><span class="line">        <span class="built_in">CGPoint</span> bottomRight = <span class="built_in">CGPointApplyAffineTransform</span>(feature.bottomRight, transform);</span><br><span class="line">        [dic setValue:[<span class="built_in">NSValue</span> valueWithCGPoint:bottomRight] forKey:<span class="string">@"bottomRight"</span>];</span><br><span class="line">        [dic setValue:feature.messageString forKey:<span class="string">@"content"</span>];</span><br><span class="line">        [dataArray addObject:dic];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [dataArray <span class="keyword">copy</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>CIImage框架中还支持对文本区域进行分析，核心代码如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="built_in">NSArray</span> *)analyseTextImage:(<span class="built_in">UIImage</span> *)image&#123;</span><br><span class="line">    <span class="built_in">NSMutableArray</span> * dataArray = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">    <span class="built_in">CIImage</span> * cImage = [<span class="built_in">CIImage</span> imageWithCGImage:image.CGImage];</span><br><span class="line">    <span class="built_in">NSDictionary</span>* opts = [<span class="built_in">NSDictionary</span> dictionaryWithObject:</span><br><span class="line">                          <span class="built_in">CIDetectorAccuracyHigh</span> forKey:<span class="built_in">CIDetectorAccuracy</span>];</span><br><span class="line">    <span class="built_in">CIDetector</span>* detector = [<span class="built_in">CIDetector</span> detectorOfType:<span class="built_in">CIDetectorTypeText</span></span><br><span class="line">                                              context:<span class="literal">nil</span> options:<span class="literal">nil</span>];</span><br><span class="line">    <span class="built_in">NSArray</span>* features = [detector featuresInImage:cImage options:@&#123;<span class="built_in">CIDetectorReturnSubFeatures</span>:@YES&#125;];</span><br><span class="line">    <span class="built_in">CGSize</span> inputImageSize = [cImage extent].size;</span><br><span class="line">    <span class="built_in">CGAffineTransform</span>  transform = <span class="built_in">CGAffineTransformIdentity</span>;</span><br><span class="line">    transform = <span class="built_in">CGAffineTransformScale</span>(transform, <span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line">    transform = <span class="built_in">CGAffineTransformTranslate</span>(transform, <span class="number">0</span>, -inputImageSize.height);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">CITextFeature</span> *feature <span class="keyword">in</span> features)&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,feature.subFeatures);</span><br><span class="line">        <span class="built_in">NSMutableDictionary</span> * dic = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">        <span class="built_in">CGRect</span> viewBounds = <span class="built_in">CGRectApplyAffineTransform</span>(feature.bounds, transform);</span><br><span class="line">        [dic setValue:[<span class="built_in">NSValue</span> valueWithCGRect:viewBounds] forKey:<span class="string">@"rectBounds"</span>];</span><br><span class="line">        <span class="built_in">CGPoint</span> topLeft = <span class="built_in">CGPointApplyAffineTransform</span>(feature.topLeft, transform);</span><br><span class="line">        [dic setValue:[<span class="built_in">NSValue</span> valueWithCGPoint:topLeft] forKey:<span class="string">@"topLeft"</span>];</span><br><span class="line">        <span class="built_in">CGPoint</span> topRight = <span class="built_in">CGPointApplyAffineTransform</span>(feature.topRight, transform);</span><br><span class="line">        [dic setValue:[<span class="built_in">NSValue</span> valueWithCGPoint:topRight] forKey:<span class="string">@"topRight"</span>];</span><br><span class="line">        <span class="built_in">CGPoint</span> bottomLeft = <span class="built_in">CGPointApplyAffineTransform</span>(feature.bottomLeft, transform);</span><br><span class="line">        [dic setValue:[<span class="built_in">NSValue</span> valueWithCGPoint:bottomLeft] forKey:<span class="string">@"bottomLeft"</span>];</span><br><span class="line">        <span class="built_in">CGPoint</span> bottomRight = <span class="built_in">CGPointApplyAffineTransform</span>(feature.bottomRight, transform);</span><br><span class="line">        [dic setValue:[<span class="built_in">NSValue</span> valueWithCGPoint:bottomRight] forKey:<span class="string">@"bottomRight"</span>];</span><br><span class="line">        </span><br><span class="line">        [dataArray addObject:dic];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [dataArray <span class="keyword">copy</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下图所示：</p>
<p><img src="https://oscimg.oschina.net/oscnet/aebc89407adb95c05bee296587332e41f87.jpg" alt></p>
<h3 id="四、CoreImage中的相关核心类"><a href="#四、CoreImage中的相关核心类" class="headerlink" title="四、CoreImage中的相关核心类"></a>四、CoreImage中的相关核心类</h3><h4 id="1-CIColor类"><a href="#1-CIColor类" class="headerlink" title="1.CIColor类"></a>1.CIColor类</h4><p>CIColor类是CoreImage中描述色彩的类。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过CGColor创建CIColor</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)colorWithCGColor:(<span class="built_in">CGColorRef</span>)c;</span><br><span class="line"><span class="comment">//构造方法</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)colorWithRed:(<span class="built_in">CGFloat</span>)r green:(<span class="built_in">CGFloat</span>)g blue:(<span class="built_in">CGFloat</span>)b alpha:(<span class="built_in">CGFloat</span>)a;</span><br><span class="line">+ (<span class="keyword">instancetype</span>)colorWithRed:(<span class="built_in">CGFloat</span>)r green:(<span class="built_in">CGFloat</span>)g blue:(<span class="built_in">CGFloat</span>)b;</span><br><span class="line">+ (<span class="keyword">nullable</span> <span class="keyword">instancetype</span>)colorWithRed:(<span class="built_in">CGFloat</span>)r green:(<span class="built_in">CGFloat</span>)g blue:(<span class="built_in">CGFloat</span>)b alpha:(<span class="built_in">CGFloat</span>)a colorSpace:(<span class="built_in">CGColorSpaceRef</span>)colorSpace;</span><br><span class="line">+ (<span class="keyword">nullable</span> <span class="keyword">instancetype</span>)colorWithRed:(<span class="built_in">CGFloat</span>)r green:(<span class="built_in">CGFloat</span>)g blue:(<span class="built_in">CGFloat</span>)b colorSpace:(<span class="built_in">CGColorSpaceRef</span>)colorSpace;</span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithCGColor:(<span class="built_in">CGColorRef</span>)c;</span><br><span class="line"><span class="comment">//通过字符串创建CIColor对象</span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)colorWithString:(<span class="built_in">NSString</span> *)representation;</span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithRed:(<span class="built_in">CGFloat</span>)r green:(<span class="built_in">CGFloat</span>)g blue:(<span class="built_in">CGFloat</span>)b alpha:(<span class="built_in">CGFloat</span>)a;</span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithRed:(<span class="built_in">CGFloat</span>)r green:(<span class="built_in">CGFloat</span>)g blue:(<span class="built_in">CGFloat</span>)b;</span><br><span class="line">- (<span class="keyword">nullable</span> <span class="keyword">instancetype</span>)initWithRed:(<span class="built_in">CGFloat</span>)r green:(<span class="built_in">CGFloat</span>)g blue:(<span class="built_in">CGFloat</span>)b alpha:(<span class="built_in">CGFloat</span>)a colorSpace:(<span class="built_in">CGColorSpaceRef</span>)colorSpace;</span><br><span class="line">- (<span class="keyword">nullable</span> <span class="keyword">instancetype</span>)initWithRed:(<span class="built_in">CGFloat</span>)r green:(<span class="built_in">CGFloat</span>)g blue:(<span class="built_in">CGFloat</span>)b colorSpace:(<span class="built_in">CGColorSpaceRef</span>)colorSpace;</span><br><span class="line"><span class="comment">//获取颜色分量个数</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) size_t numberOfComponents;</span><br><span class="line"><span class="comment">//颜色分量</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="keyword">const</span> <span class="built_in">CGFloat</span> *components;</span><br><span class="line"><span class="comment">//颜色透明度</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="built_in">CGFloat</span> alpha;</span><br><span class="line"><span class="comment">//色彩空间</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="built_in">CGColorSpaceRef</span> colorSpace;</span><br><span class="line"><span class="comment">//红绿蓝分量</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="built_in">CGFloat</span> red;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="built_in">CGFloat</span> green;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="built_in">CGFloat</span> blue;</span><br><span class="line"><span class="comment">//下面是定义的一些便捷的颜色变量</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">class</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">CIColor</span> *blackColor  ;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">class</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">CIColor</span> *whiteColor  ;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">class</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">CIColor</span> *grayColor   ;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">class</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">CIColor</span> *redColor    ;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">class</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">CIColor</span> *greenColor  ;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">class</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">CIColor</span> *blueColor   ;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">class</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">CIColor</span> *cyanColor   ;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">class</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">CIColor</span> *magentaColor ;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">class</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">CIColor</span> *yellowColor  ;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">class</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">CIColor</span> *clearColor</span><br></pre></td></tr></table></figure>
<h4 id="2-CIImage类"><a href="#2-CIImage类" class="headerlink" title="2.CIImage类"></a>2.CIImage类</h4><p>CIImage是CoreImage中最核心的类，它描述了图像对象。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建一个新的CIImage实例</span></span><br><span class="line">+ (<span class="built_in">CIImage</span> *)imageWithCGImage:(<span class="built_in">CGImageRef</span>)image;</span><br><span class="line"><span class="comment">//通过字典创建一个新的CIImage实例</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">字典中的键</span></span><br><span class="line"><span class="comment">kCIImageColorSpace  设置颜色空间 为CGColorSpaceRef对象</span></span><br><span class="line"><span class="comment">kCIImageNearestSampling 是否临近采样  布尔值</span></span><br><span class="line"><span class="comment">kCIImageProperties    设置图片属性字典</span></span><br><span class="line"><span class="comment">kCIImageApplyOrientationProperty 布尔值 是否根据方向进行转换</span></span><br><span class="line"><span class="comment">kCIImageTextureTarget  NSNumber值 设置OpebGL目标纹理常数</span></span><br><span class="line"><span class="comment">kCIImageTextureFormat NSNumber值 设置OpebGL format</span></span><br><span class="line"><span class="comment">kCIImageAuxiliaryDepth 布尔值 是否返回深度图像</span></span><br><span class="line"><span class="comment">kCIImageAuxiliaryDisparity  布尔值 是否返回辅助时差图像</span></span><br><span class="line"><span class="comment">kCIImageAuxiliaryPortraitEffectsMatte  布尔值 是否返回肖像模板</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">+ (<span class="built_in">CIImage</span> *)imageWithCGImage:(<span class="built_in">CGImageRef</span>)image</span><br><span class="line">                      options:(<span class="keyword">nullable</span> <span class="built_in">NSDictionary</span>&lt;<span class="built_in">CIImageOption</span>, <span class="keyword">id</span>&gt; *)options;</span><br><span class="line"><span class="comment">//通过CALayer进行CIImage的创建</span></span><br><span class="line">+ (<span class="built_in">CIImage</span> *)imageWithCGLayer:(<span class="built_in">CGLayerRef</span>)layer <span class="built_in">NS_DEPRECATED_MAC</span>(<span class="number">10</span>_4,<span class="number">10</span>_11);</span><br><span class="line">+ (<span class="built_in">CIImage</span> *)imageWithCGLayer:(<span class="built_in">CGLayerRef</span>)layer</span><br><span class="line">                      options:(<span class="keyword">nullable</span> <span class="built_in">NSDictionary</span>&lt;<span class="built_in">CIImageOption</span>, <span class="keyword">id</span>&gt; *)options;</span><br><span class="line"><span class="comment">//使用bitmap数据创建CIImage</span></span><br><span class="line">+ (<span class="built_in">CIImage</span> *)imageWithBitmapData:(<span class="built_in">NSData</span> *)data</span><br><span class="line">                     bytesPerRow:(size_t)bytesPerRow</span><br><span class="line">                            size:(<span class="built_in">CGSize</span>)size</span><br><span class="line">                          format:(<span class="built_in">CIFormat</span>)format</span><br><span class="line">                      colorSpace:(<span class="keyword">nullable</span> <span class="built_in">CGColorSpaceRef</span>)colorSpace;</span><br><span class="line"><span class="comment">//通过纹理创建CIImage</span></span><br><span class="line">+ (<span class="built_in">CIImage</span> *)imageWithTexture:(<span class="keyword">unsigned</span> <span class="keyword">int</span>)name</span><br><span class="line">                         size:(<span class="built_in">CGSize</span>)size</span><br><span class="line">                      flipped:(<span class="built_in">BOOL</span>)flipped</span><br><span class="line">                   colorSpace:(<span class="keyword">nullable</span> <span class="built_in">CGColorSpaceRef</span>)colorSpace;</span><br><span class="line">+ (<span class="built_in">CIImage</span> *)imageWithTexture:(<span class="keyword">unsigned</span> <span class="keyword">int</span>)name</span><br><span class="line">                         size:(<span class="built_in">CGSize</span>)size</span><br><span class="line">                      flipped:(<span class="built_in">BOOL</span>)flipped</span><br><span class="line">                      options:(<span class="keyword">nullable</span> <span class="built_in">NSDictionary</span>&lt;<span class="built_in">CIImageOption</span>, <span class="keyword">id</span>&gt; *)options;</span><br><span class="line">+ (<span class="keyword">nullable</span> <span class="built_in">CIImage</span> *)imageWithMTLTexture:(<span class="keyword">id</span>&lt;<span class="built_in">MTLTexture</span>&gt;)texture</span><br><span class="line">                                  options:(<span class="keyword">nullable</span> <span class="built_in">NSDictionary</span>&lt;<span class="built_in">CIImageOption</span>, <span class="keyword">id</span>&gt; *)options;</span><br><span class="line"><span class="comment">//通过url创建CIImage</span></span><br><span class="line">+ (<span class="keyword">nullable</span> <span class="built_in">CIImage</span> *)imageWithContentsOfURL:(<span class="built_in">NSURL</span> *)url;</span><br><span class="line">+ (<span class="keyword">nullable</span> <span class="built_in">CIImage</span> *)imageWithContentsOfURL:(<span class="built_in">NSURL</span> *)url</span><br><span class="line">                                     options:(<span class="keyword">nullable</span> <span class="built_in">NSDictionary</span>&lt;<span class="built_in">CIImageOption</span>, <span class="keyword">id</span>&gt; *)options;</span><br><span class="line"><span class="comment">//通过NSDate创建CIImage</span></span><br><span class="line">+ (<span class="keyword">nullable</span> <span class="built_in">CIImage</span> *)imageWithData:(<span class="built_in">NSData</span> *)data;</span><br><span class="line">+ (<span class="keyword">nullable</span> <span class="built_in">CIImage</span> *)imageWithData:(<span class="built_in">NSData</span> *)data</span><br><span class="line">                            options:(<span class="keyword">nullable</span> <span class="built_in">NSDictionary</span>&lt;<span class="built_in">CIImageOption</span>, <span class="keyword">id</span>&gt; *)options;</span><br><span class="line"><span class="comment">//通过CVImageBufferRef创建CIImage</span></span><br><span class="line">+ (<span class="built_in">CIImage</span> *)imageWithCVImageBuffer:(CVImageBufferRef)imageBuffer;</span><br><span class="line">+ (<span class="built_in">CIImage</span> *)imageWithCVImageBuffer:(CVImageBufferRef)imageBuffer</span><br><span class="line">                            options:(<span class="keyword">nullable</span> <span class="built_in">NSDictionary</span>&lt;<span class="built_in">CIImageOption</span>, <span class="keyword">id</span>&gt; *)options;</span><br><span class="line"><span class="comment">//通过CVPixelBufferRef创建CIImage</span></span><br><span class="line">+ (<span class="built_in">CIImage</span> *)imageWithCVPixelBuffer:(CVPixelBufferRef)pixelBuffer;</span><br><span class="line">+ (<span class="built_in">CIImage</span> *)imageWithCVPixelBuffer:(CVPixelBufferRef)pixelBuffer</span><br><span class="line">                            options:(<span class="keyword">nullable</span> <span class="built_in">NSDictionary</span>&lt;<span class="built_in">CIImageOption</span>, <span class="keyword">id</span>&gt; *)options;</span><br><span class="line"><span class="comment">//通过颜色创建CIImage</span></span><br><span class="line">+ (<span class="built_in">CIImage</span> *)imageWithColor:(<span class="built_in">CIColor</span> *)color;</span><br><span class="line"><span class="comment">//创建空CIImage</span></span><br><span class="line">+ (<span class="built_in">CIImage</span> *)emptyImage;</span><br><span class="line"><span class="comment">//初始化方法</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithCGImage:(<span class="built_in">CGImageRef</span>)image;</span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithCGImage:(<span class="built_in">CGImageRef</span>)image</span><br><span class="line">                        options:(<span class="keyword">nullable</span> <span class="built_in">NSDictionary</span>&lt;<span class="built_in">CIImageOption</span>, <span class="keyword">id</span>&gt; *)options;</span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithCGLayer:(<span class="built_in">CGLayerRef</span>)layer);</span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithCGLayer:(<span class="built_in">CGLayerRef</span>)layer;</span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithBitmapData:(<span class="built_in">NSData</span> *)data</span><br><span class="line">                       bytesPerRow:(size_t)bytesPerRow</span><br><span class="line">                              size:(<span class="built_in">CGSize</span>)size</span><br><span class="line">                            format:(<span class="built_in">CIFormat</span>)format</span><br><span class="line">                        colorSpace:(<span class="keyword">nullable</span> <span class="built_in">CGColorSpaceRef</span>)colorSpace;</span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithTexture:(<span class="keyword">unsigned</span> <span class="keyword">int</span>)name</span><br><span class="line">                           size:(<span class="built_in">CGSize</span>)size</span><br><span class="line">                        flipped:(<span class="built_in">BOOL</span>)flipped</span><br><span class="line">                     colorSpace:(<span class="keyword">nullable</span> <span class="built_in">CGColorSpaceRef</span>)colorSpace;</span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithTexture:(<span class="keyword">unsigned</span> <span class="keyword">int</span>)name</span><br><span class="line">                           size:(<span class="built_in">CGSize</span>)size</span><br><span class="line">                        flipped:(<span class="built_in">BOOL</span>)flipped</span><br><span class="line">                        options:(<span class="keyword">nullable</span> <span class="built_in">NSDictionary</span>&lt;<span class="built_in">CIImageOption</span>, <span class="keyword">id</span>&gt; *)options;</span><br><span class="line">- (<span class="keyword">nullable</span> <span class="keyword">instancetype</span>)initWithMTLTexture:(<span class="keyword">id</span>&lt;<span class="built_in">MTLTexture</span>&gt;)texture</span><br><span class="line">                                    options:(<span class="keyword">nullable</span> <span class="built_in">NSDictionary</span>&lt;<span class="built_in">CIImageOption</span>, <span class="keyword">id</span>&gt; *)options；</span><br><span class="line">- (<span class="keyword">nullable</span> <span class="keyword">instancetype</span>)initWithContentsOfURL:(<span class="built_in">NSURL</span> *)url;</span><br><span class="line">- (<span class="keyword">nullable</span> <span class="keyword">instancetype</span>)initWithContentsOfURL:(<span class="built_in">NSURL</span> *)url</span><br><span class="line">                                       options:(<span class="keyword">nullable</span> <span class="built_in">NSDictionary</span>&lt;<span class="built_in">CIImageOption</span>, <span class="keyword">id</span>&gt; *)options;</span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithCVImageBuffer:(CVImageBufferRef)imageBuffer;</span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithCVImageBuffer:(CVImageBufferRef)imageBuffer</span><br><span class="line">                              options:(<span class="keyword">nullable</span> <span class="built_in">NSDictionary</span>&lt;<span class="built_in">CIImageOption</span>, <span class="keyword">id</span>&gt; *)options;</span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithCVPixelBuffer:(CVPixelBufferRef)pixelBuffer;</span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithCVPixelBuffer:(CVPixelBufferRef)pixelBuffer</span><br><span class="line">                              options:(<span class="keyword">nullable</span> <span class="built_in">NSDictionary</span>&lt;<span class="built_in">CIImageOption</span>, <span class="keyword">id</span>&gt; *)options;</span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithColor:(<span class="built_in">CIColor</span> *)color;</span><br><span class="line"><span class="comment">//追加变换 返回结果CIImage对象</span></span><br><span class="line">- (<span class="built_in">CIImage</span> *)imageByApplyingTransform:(<span class="built_in">CGAffineTransform</span>)matrix;</span><br><span class="line">- (<span class="built_in">CIImage</span> *)imageByApplyingOrientation:(<span class="keyword">int</span>)orientation;</span><br><span class="line">- (<span class="built_in">CIImage</span> *)imageByApplyingCGOrientation:(<span class="built_in">CGImagePropertyOrientation</span>)orientation;</span><br><span class="line"><span class="comment">//根据方向获取变换</span></span><br><span class="line">- (<span class="built_in">CGAffineTransform</span>)imageTransformForOrientation:(<span class="keyword">int</span>)orientation;</span><br><span class="line">- (<span class="built_in">CGAffineTransform</span>)imageTransformForCGOrientation:(<span class="built_in">CGImagePropertyOrientation</span>)orientation;</span><br><span class="line"><span class="comment">//进行混合</span></span><br><span class="line">- (<span class="built_in">CIImage</span> *)imageByCompositingOverImage:(<span class="built_in">CIImage</span> *)dest;</span><br><span class="line"><span class="comment">//区域裁剪</span></span><br><span class="line">- (<span class="built_in">CIImage</span> *)imageByCroppingToRect:(<span class="built_in">CGRect</span>)rect;</span><br><span class="line"><span class="comment">//返回图像边缘</span></span><br><span class="line">- (<span class="built_in">CIImage</span> *)imageByClampingToExtent;</span><br><span class="line"><span class="comment">//设置边缘 返回新图像对象</span></span><br><span class="line">- (<span class="built_in">CIImage</span> *)imageByClampingToRect:(<span class="built_in">CGRect</span>)rect;</span><br><span class="line"><span class="comment">//用过滤器进行过滤</span></span><br><span class="line">- (<span class="built_in">CIImage</span> *)imageByApplyingFilter:(<span class="built_in">NSString</span> *)filterName</span><br><span class="line">               withInputParameters:(<span class="keyword">nullable</span> <span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *,<span class="keyword">id</span>&gt; *)params;</span><br><span class="line">- (<span class="built_in">CIImage</span> *)imageByApplyingFilter:(<span class="built_in">NSString</span> *)filterName;</span><br><span class="line"><span class="comment">//图像边缘</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="built_in">NS_NONATOMIC_IOSONLY</span>, <span class="keyword">readonly</span>) <span class="built_in">CGRect</span> extent;</span><br><span class="line"><span class="comment">//属性字典</span></span><br><span class="line"><span class="keyword">@property</span> (atomic, <span class="keyword">readonly</span>) <span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *,<span class="keyword">id</span>&gt; *properties;</span><br><span class="line"><span class="comment">//通过URL创建的图像的URL</span></span><br><span class="line"><span class="keyword">@property</span> (atomic, <span class="keyword">readonly</span>, <span class="keyword">nullable</span>) <span class="built_in">NSURL</span> *url;</span><br><span class="line"><span class="comment">//颜色空间</span></span><br><span class="line"><span class="keyword">@property</span> (atomic, <span class="keyword">readonly</span>, <span class="keyword">nullable</span>) <span class="built_in">CGColorSpaceRef</span> colorSpace;</span><br><span class="line"><span class="comment">//通过CGImage创建的CGImage对象</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">nullable</span>) <span class="built_in">CGImageRef</span> <span class="built_in">CGImage</span>;</span><br></pre></td></tr></table></figure>
<h4 id="3-CIContext类"><a href="#3-CIContext类" class="headerlink" title="3.CIContext类"></a>3.CIContext类</h4><pre><code>CIContext是CoreImage中的上下文对象，用来进行图片的渲染，已经转换为其他框架的图像对象。
</code></pre><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过CGContextRef上下文创建CIContext上下文</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">配置字典中可以进行配置的：</span></span><br><span class="line"><span class="comment">kCIContextOutputColorSpace   设置输出的颜色空间</span></span><br><span class="line"><span class="comment">kCIContextWorkingColorSpace  设置工作的颜色空间</span></span><br><span class="line"><span class="comment">kCIContextWorkingFormat      设置缓冲区数据格式</span></span><br><span class="line"><span class="comment">kCIContextHighQualityDownsample 布尔值</span></span><br><span class="line"><span class="comment">kCIContextOutputPremultiplied  设置输出是否带alpha通道</span></span><br><span class="line"><span class="comment">kCIContextCacheIntermediates  布尔值</span></span><br><span class="line"><span class="comment">kCIContextUseSoftwareRenderer 设置是否使用软件渲染</span></span><br><span class="line"><span class="comment">kCIContextPriorityRequestLow  是否低质量</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">+ (<span class="built_in">CIContext</span> *)contextWithCGContext:(<span class="built_in">CGContextRef</span>)cgctx</span><br><span class="line">                            options:(<span class="keyword">nullable</span> <span class="built_in">NSDictionary</span>&lt;<span class="built_in">CIContextOption</span>, <span class="keyword">id</span>&gt; *)options;</span><br><span class="line"><span class="comment">//创建上下文对象</span></span><br><span class="line">+ (<span class="built_in">CIContext</span> *)contextWithOptions:(<span class="keyword">nullable</span> <span class="built_in">NSDictionary</span>&lt;<span class="built_in">CIContextOption</span>, <span class="keyword">id</span>&gt; *)options;</span><br><span class="line">+ (<span class="built_in">CIContext</span> *)context;</span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithOptions:(<span class="keyword">nullable</span> <span class="built_in">NSDictionary</span>&lt;<span class="built_in">CIContextOption</span>, <span class="keyword">id</span>&gt; *)options;</span><br><span class="line"><span class="comment">//使用指定的处理器创建CIContext</span></span><br><span class="line">+ (<span class="built_in">CIContext</span> *)contextWithMTLDevice:(<span class="keyword">id</span>&lt;<span class="built_in">MTLDevice</span>&gt;)device;</span><br><span class="line">+ (<span class="built_in">CIContext</span> *)contextWithMTLDevice:(<span class="keyword">id</span>&lt;<span class="built_in">MTLDevice</span>&gt;)device</span><br><span class="line">                            options:(<span class="keyword">nullable</span> <span class="built_in">NSDictionary</span>&lt;<span class="built_in">CIContextOption</span>, <span class="keyword">id</span>&gt; *)options;</span><br><span class="line"><span class="comment">//工作的颜色空间</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">CGColorSpaceRef</span> workingColorSpace;</span><br><span class="line"><span class="comment">//缓冲区格式</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">CIFormat</span> workingFormat;</span><br><span class="line"><span class="comment">//进行CIImage图像的绘制</span></span><br><span class="line">- (<span class="keyword">void</span>)drawImage:(<span class="built_in">CIImage</span> *)image</span><br><span class="line">          atPoint:(<span class="built_in">CGPoint</span>)atPoint</span><br><span class="line">         fromRect:(<span class="built_in">CGRect</span>)fromRect;</span><br><span class="line">- (<span class="keyword">void</span>)drawImage:(<span class="built_in">CIImage</span> *)image</span><br><span class="line">           inRect:(<span class="built_in">CGRect</span>)inRect</span><br><span class="line">         fromRect:(<span class="built_in">CGRect</span>)fromRect;</span><br><span class="line"><span class="comment">//使用CIImage创建CGImageRef</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">CGImageRef</span>)createCGImage:(<span class="built_in">CIImage</span> *)image;</span><br><span class="line">                            fromRect:(<span class="built_in">CGRect</span>)fromRect;</span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">CGImageRef</span>)createCGImage:(<span class="built_in">CIImage</span> *)image</span><br><span class="line">                            fromRect:(<span class="built_in">CGRect</span>)fromRect</span><br><span class="line">                              format:(<span class="built_in">CIFormat</span>)format</span><br><span class="line">                          colorSpace:(<span class="keyword">nullable</span> <span class="built_in">CGColorSpaceRef</span>)colorSpace;</span><br><span class="line"><span class="comment">//创建CALayer</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">CGLayerRef</span>)createCGLayerWithSize:(<span class="built_in">CGSize</span>)size</span><br><span class="line">                                        info:(<span class="keyword">nullable</span> <span class="built_in">CFDictionaryRef</span>)info;</span><br><span class="line"><span class="comment">//将图片写入bitMap数据</span></span><br><span class="line">- (<span class="keyword">void</span>)render:(<span class="built_in">CIImage</span> *)image</span><br><span class="line">      toBitmap:(<span class="keyword">void</span> *)data</span><br><span class="line">      rowBytes:(ptrdiff_t)rowBytes</span><br><span class="line">        bounds:(<span class="built_in">CGRect</span>)bounds</span><br><span class="line">        format:(<span class="built_in">CIFormat</span>)format;</span><br><span class="line"><span class="comment">//将图片写入缓存</span></span><br><span class="line">- (<span class="keyword">void</span>)render:(<span class="built_in">CIImage</span> *)image </span><br><span class="line">toCVPixelBuffer:(CVPixelBufferRef)buffer</span><br><span class="line">    colorSpace:(<span class="keyword">nullable</span> <span class="built_in">CGColorSpaceRef</span>)colorSpace;</span><br><span class="line">- (<span class="keyword">void</span>)render:(<span class="built_in">CIImage</span> *)image</span><br><span class="line">toCVPixelBuffer:(CVPixelBufferRef)buffer</span><br><span class="line">        bounds:(<span class="built_in">CGRect</span>)bounds</span><br><span class="line">    colorSpace:(<span class="keyword">nullable</span> <span class="built_in">CGColorSpaceRef</span>)colorSpace；</span><br><span class="line"><span class="comment">//将图片写入纹理</span></span><br><span class="line">- (<span class="keyword">void</span>)render:(<span class="built_in">CIImage</span> *)image</span><br><span class="line">  toMTLTexture:(<span class="keyword">id</span>&lt;<span class="built_in">MTLTexture</span>&gt;)texture</span><br><span class="line"> commandBuffer:(<span class="keyword">nullable</span> <span class="keyword">id</span>&lt;<span class="built_in">MTLCommandBuffer</span>&gt;)commandBuffer</span><br><span class="line">        bounds:(<span class="built_in">CGRect</span>)bounds</span><br><span class="line">    colorSpace:(<span class="built_in">CGColorSpaceRef</span>)colorSpace;</span><br><span class="line"><span class="comment">//清除缓存</span></span><br><span class="line">- (<span class="keyword">void</span>)clearCaches;</span><br><span class="line"><span class="comment">//输入图像的最大尺寸</span></span><br><span class="line">- (<span class="built_in">CGSize</span>)inputImageMaximumSize;</span><br><span class="line"><span class="comment">//输出图像的最大尺寸</span></span><br><span class="line">- (<span class="built_in">CGSize</span>)outputImageMaximumSize;</span><br><span class="line"><span class="comment">//将CIImage写成TIFF数据</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">NSData</span>*) TIFFRepresentationOfImage:(<span class="built_in">CIImage</span>*)image</span><br><span class="line">                                        format:(<span class="built_in">CIFormat</span>)format</span><br><span class="line">                                    colorSpace:(<span class="built_in">CGColorSpaceRef</span>)colorSpace</span><br><span class="line">                                       options:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">CIImageRepresentationOption</span>, <span class="keyword">id</span>&gt;*)options;</span><br><span class="line"><span class="comment">//将CIImage写成JPEG数据</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">NSData</span>*) JPEGRepresentationOfImage:(<span class="built_in">CIImage</span>*)image</span><br><span class="line">                                    colorSpace:(<span class="built_in">CGColorSpaceRef</span>)colorSpace</span><br><span class="line">                                       options:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">CIImageRepresentationOption</span>, <span class="keyword">id</span>&gt;*)options;</span><br><span class="line"><span class="comment">//将CIImage写成HEIF数据</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">NSData</span>*) HEIFRepresentationOfImage:(<span class="built_in">CIImage</span>*)image</span><br><span class="line">                                        format:(<span class="built_in">CIFormat</span>)format</span><br><span class="line">                                    colorSpace:(<span class="built_in">CGColorSpaceRef</span>)colorSpace</span><br><span class="line">                                       options:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">CIImageRepresentationOption</span>, <span class="keyword">id</span>&gt;*)options;</span><br><span class="line"><span class="comment">//将CIImage写成PNG数据</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">NSData</span>*) PNGRepresentationOfImage:(<span class="built_in">CIImage</span>*)image</span><br><span class="line">                                       format:(<span class="built_in">CIFormat</span>)format</span><br><span class="line">                                   colorSpace:(<span class="built_in">CGColorSpaceRef</span>)colorSpace</span><br><span class="line">                                      options:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">CIImageRepresentationOption</span>, <span class="keyword">id</span>&gt;*)options;</span><br><span class="line"><span class="comment">//将CIImage写入TIFF文件</span></span><br><span class="line">- (<span class="built_in">BOOL</span>) writeTIFFRepresentationOfImage:(<span class="built_in">CIImage</span>*)image</span><br><span class="line">                                  toURL:(<span class="built_in">NSURL</span>*)url</span><br><span class="line">                                 format:(<span class="built_in">CIFormat</span>)format</span><br><span class="line">                             colorSpace:(<span class="built_in">CGColorSpaceRef</span>)colorSpace </span><br><span class="line">                                options:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">CIImageRepresentationOption</span>, <span class="keyword">id</span>&gt;*)options</span><br><span class="line">                                  error:(<span class="built_in">NSError</span> **)errorPtr;</span><br><span class="line"><span class="comment">//将CIImage写入PNG文件</span></span><br><span class="line">- (<span class="built_in">BOOL</span>) writePNGRepresentationOfImage:(<span class="built_in">CIImage</span>*)image</span><br><span class="line">                                 toURL:(<span class="built_in">NSURL</span>*)url</span><br><span class="line">                                format:(<span class="built_in">CIFormat</span>)format</span><br><span class="line">                            colorSpace:(<span class="built_in">CGColorSpaceRef</span>)colorSpace</span><br><span class="line">                               options:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">CIImageRepresentationOption</span>, <span class="keyword">id</span>&gt;*)options</span><br><span class="line">                                 error:(<span class="built_in">NSError</span> **)errorPtr;</span><br><span class="line"><span class="comment">//将CIImage写入JPEG文件</span></span><br><span class="line">- (<span class="built_in">BOOL</span>) writeJPEGRepresentationOfImage:(<span class="built_in">CIImage</span>*)image</span><br><span class="line">                                  toURL:(<span class="built_in">NSURL</span>*)url</span><br><span class="line">                             colorSpace:(<span class="built_in">CGColorSpaceRef</span>)colorSpace</span><br><span class="line">                                options:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">CIImageRepresentationOption</span>, <span class="keyword">id</span>&gt;*)options</span><br><span class="line">                                  error:(<span class="built_in">NSError</span> **)errorPtr;</span><br><span class="line"><span class="comment">//将CIImage写HEIF文件</span></span><br><span class="line">- (<span class="built_in">BOOL</span>) writeHEIFRepresentationOfImage:(<span class="built_in">CIImage</span>*)image</span><br><span class="line">                                  toURL:(<span class="built_in">NSURL</span>*)url</span><br><span class="line">                                 format:(<span class="built_in">CIFormat</span>)format</span><br><span class="line">                             colorSpace:(<span class="built_in">CGColorSpaceRef</span>)colorSpace</span><br><span class="line">                                options:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">CIImageRepresentationOption</span>, <span class="keyword">id</span>&gt;*)options</span><br><span class="line">                                  error:(<span class="built_in">NSError</span> **)errorPtr;</span><br></pre></td></tr></table></figure>
<h4 id="4-CIDetector类"><a href="#4-CIDetector类" class="headerlink" title="4.CIDetector类"></a>4.CIDetector类</h4><pre><code>前面有过CIDetector类的功能演示，这是CIImage框架中非常强大的一个类，使用它可以进行复杂的图片识别技术，解析如下：
</code></pre><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建CIDetector实例 </span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">type用来指定识别的类型</span></span><br><span class="line"><span class="comment">CIDetectorTypeFace  人脸识别模式</span></span><br><span class="line"><span class="comment">CIDetectorTypeRectangle 矩形检测模式</span></span><br><span class="line"><span class="comment">CIDetectorTypeText   文本区域检测模式</span></span><br><span class="line"><span class="comment">CIDetectorTypeQRCode 二维码扫描模式</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">option可以指定配置字典 可配置的键如下</span></span><br><span class="line"><span class="comment">CIDetectorAccuracy 设置检测精度 CIDetectorAccuracyLow 低 CIDetectorAccuracyHigh 高</span></span><br><span class="line"><span class="comment">CIDetectorTracking 设置是否跟踪特征</span></span><br><span class="line"><span class="comment">CIDetectorMinFeatureSize  设置特征最小尺寸 0-1之间 相对图片</span></span><br><span class="line"><span class="comment">CIDetectorMaxFeatureCount 设置最大特征数</span></span><br><span class="line"><span class="comment">CIDetectorImageOrientation 设置方向</span></span><br><span class="line"><span class="comment">CIDetectorEyeBlink  设置布尔值 是否提取面部表情 眨眼</span></span><br><span class="line"><span class="comment">CIDetectorSmile    设置布尔值 是否提取面部表情  微笑</span></span><br><span class="line"><span class="comment">CIDetectorFocalLength  设置焦距</span></span><br><span class="line"><span class="comment">CIDetectorAspectRatio 设置检测到矩形的宽高比</span></span><br><span class="line"><span class="comment">CIDetectorReturnSubFeatures 设置是否提取子特征</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">+ (<span class="keyword">nullable</span> <span class="built_in">CIDetector</span> *)detectorOfType:(<span class="built_in">NSString</span>*)type</span><br><span class="line">                                context:(<span class="keyword">nullable</span> <span class="built_in">CIContext</span> *)context</span><br><span class="line">                                options:(<span class="keyword">nullable</span> <span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *,<span class="keyword">id</span>&gt; *)options;</span><br><span class="line"><span class="comment">//进行图片分析 提取特征数组</span></span><br><span class="line">- (<span class="built_in">NSArray</span>&lt;<span class="built_in">CIFeature</span> *&gt; *)featuresInImage:(<span class="built_in">CIImage</span> *)image;</span><br><span class="line">- (<span class="built_in">NSArray</span>&lt;<span class="built_in">CIFeature</span> *&gt; *)featuresInImage:(<span class="built_in">CIImage</span> *)image</span><br><span class="line">                                  options:(<span class="keyword">nullable</span> <span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *,<span class="keyword">id</span>&gt; *)options;</span><br></pre></td></tr></table></figure>
<h4 id="5-CIFeature相关类"><a href="#5-CIFeature相关类" class="headerlink" title="5.CIFeature相关类"></a>5.CIFeature相关类</h4><p>CIFeature与其相关子类定义了特征数据模型。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CIFeature</span> : <span class="title">NSObject</span> </span>&#123;&#125;</span><br><span class="line"><span class="comment">//特征类型</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">CIFeatureTypeFace</span></span><br><span class="line"><span class="comment">CIFeatureTypeRectangle</span></span><br><span class="line"><span class="comment">CIFeatureTypeQRCode</span></span><br><span class="line"><span class="comment">CIFeatureTypeText</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">retain</span>) <span class="built_in">NSString</span> *type;</span><br><span class="line"><span class="comment">//特征在图片中的bounds</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">assign</span>) <span class="built_in">CGRect</span> bounds;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//人脸特征对象</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CIFaceFeature</span> : <span class="title">CIFeature</span></span></span><br><span class="line"><span class="comment">//位置尺寸</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">assign</span>) <span class="built_in">CGRect</span> bounds;</span><br><span class="line"><span class="comment">//左眼位置</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> hasLeftEyePosition;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">assign</span>) <span class="built_in">CGPoint</span> leftEyePosition;</span><br><span class="line"><span class="comment">//是否有左眼特征</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> hasRightEyePosition;</span><br><span class="line"><span class="comment">//右眼位置</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">assign</span>) <span class="built_in">CGPoint</span> rightEyePosition;</span><br><span class="line"><span class="comment">//是否有右眼特征</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> hasMouthPosition;</span><br><span class="line"><span class="comment">//口部特征</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">assign</span>) <span class="built_in">CGPoint</span> mouthPosition;</span><br><span class="line"><span class="comment">//是否有跟踪特征ID</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> hasTrackingID;</span><br><span class="line"><span class="comment">//跟踪特征ID</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">assign</span>) <span class="keyword">int</span> trackingID;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> hasTrackingFrameCount;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">assign</span>) <span class="keyword">int</span> trackingFrameCount;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> hasFaceAngle;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">assign</span>) <span class="keyword">float</span> faceAngle;</span><br><span class="line"><span class="comment">//是否微笑</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> hasSmile;</span><br><span class="line"><span class="comment">//左眼是否闭眼</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> leftEyeClosed;</span><br><span class="line"><span class="comment">//右眼是否闭眼</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> rightEyeClosed;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//矩形特征对象</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CIRectangleFeature</span> : <span class="title">CIFeature</span></span></span><br><span class="line"><span class="comment">//位置尺寸</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="built_in">CGRect</span> bounds;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="built_in">CGPoint</span> topLeft;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="built_in">CGPoint</span> topRight;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="built_in">CGPoint</span> bottomLeft;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="built_in">CGPoint</span> bottomRight;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//二维码特征对象</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CIQRCodeFeature</span> : <span class="title">CIFeature</span></span></span><br><span class="line"><span class="comment">//位置尺寸信息</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="built_in">CGRect</span> bounds;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="built_in">CGPoint</span> topLeft;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="built_in">CGPoint</span> topRight;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="built_in">CGPoint</span> bottomLeft;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="built_in">CGPoint</span> bottomRight;</span><br><span class="line"><span class="comment">//二维码内容</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">readonly</span>) <span class="built_in">NSString</span>* messageString;</span><br><span class="line"><span class="comment">//二维码描述数据</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">readonly</span>) <span class="built_in">CIQRCodeDescriptor</span> *symbolDescriptor <span class="built_in">NS_AVAILABLE</span>(<span class="number">10</span>_13, <span class="number">11</span>_0);</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//文本特征对象</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CITextFeature</span> : <span class="title">CIFeature</span></span></span><br><span class="line"><span class="comment">//位置信息</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="built_in">CGRect</span> bounds;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="built_in">CGPoint</span> topLeft;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="built_in">CGPoint</span> topRight;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="built_in">CGPoint</span> bottomLeft;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>) <span class="built_in">CGPoint</span> bottomRight;</span><br><span class="line"><span class="comment">//子特征</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">readonly</span>) <span class="built_in">NSArray</span> *subFeatures;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>热爱技术，热爱生活，写代码，交朋友 珲少  QQ：316045346</p>
</blockquote>

    </div>

    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © 微信：15137348047
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/2018/12/26/387iOS开发之CoreLocation框架使用/" class="pre-post btn btn-default" title='iOS开发之CoreLocation框架使用'>
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">iOS开发之CoreLocation框架使用</span>
        </a>
    
    
        <a href="/2018/10/24/385iOS开发之CFNetwork框架使用/" class="next-post btn btn-default" title='iOS开发之CFNetwork框架使用'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">iOS开发之CFNetwork框架使用</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
<div id="lv-container" data-id="city" data-uid="MTAyMC8zNzY0Ny8xNDE3OA==">
  <script type="text/javascript">
     (function(d, s) {
         var j, e = d.getElementsByTagName(s)[0];
         if (typeof LivereTower === 'function') { return; }
         j = d.createElement(s);
         j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
         j.async = true;
         e.parentNode.insertBefore(j, e);
     })(document, 'script');
  </script>
</div>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#iOS开发之CoreImage框架使用"><span class="toc-text">iOS开发之CoreImage框架使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一、图像过滤器"><span class="toc-text">一、图像过滤器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-几组内置的过滤器"><span class="toc-text">1.几组内置的过滤器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-过滤器的一个简单示例"><span class="toc-text">2.过滤器的一个简单示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-对CIFilter类进行解析"><span class="toc-text">3.对CIFilter类进行解析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-常用过滤器详解"><span class="toc-text">4.常用过滤器详解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-自定义过滤器"><span class="toc-text">5.自定义过滤器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#二、使用CoreImage实现人脸识别"><span class="toc-text">二、使用CoreImage实现人脸识别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#三、CIImage中提供了其他图像识别功能"><span class="toc-text">三、CIImage中提供了其他图像识别功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#四、CoreImage中的相关核心类"><span class="toc-text">四、CoreImage中的相关核心类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-CIColor类"><span class="toc-text">1.CIColor类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-CIImage类"><span class="toc-text">2.CIImage类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-CIContext类"><span class="toc-text">3.CIContext类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-CIDetector类"><span class="toc-text">4.CIDetector类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-CIFeature相关类"><span class="toc-text">5.CIFeature相关类</span></a></li></ol></li></ol></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12"> 
                <span>Copyright &copy; 2018
                </span> | 
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> | 
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



<script src="/js/app.js?rev=@@hash"></script>


</body>
</html>
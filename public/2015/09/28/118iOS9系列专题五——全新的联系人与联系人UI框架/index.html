<script src="https://eqcn.ajz.miesnfu.com/wp-content/plugins/wp-3d-pony/live2dw/lib/L2Dwidget.min.js"></script> 
<script>
　　let models = [
    "https://unpkg.com/live2d-widget-model-chitose@1.0.5/assets/chitose.model.json",
    "https://unpkg.com/live2d-widget-model-shizuku@1.0.5/assets/shizuku.model.json",
    "https://unpkg.com/live2d-widget-model-koharu@1.0.5/assets/koharu.model.json",
    "https://unpkg.com/live2d-widget-model-haruto@1.0.5/assets/haruto.model.json",
    "https://unpkg.com/live2d-widget-model-miku@1.0.5/assets/miku.model.json",
    "https://unpkg.com/live2d-widget-model-z16@1.0.5/assets/z16.model.json"
];
let m = models[Math.round(Math.random()*5)];
　　L2Dwidget.init({ 
　　"model": {jsonPath:m,"scale": 1 }, 
　　"display": { "position": "left", "width": 200, "height": 300,"hOffset": 0, "vOffset": -20 }, 
　　"mobile": { "show": true, "scale": 0.5 }, 
　　"react": { "opacityDefault": 0.7, "opacityOnHover": 0.2 } });
</script> 
<!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="珲少的技术博客">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <link rel="dns-prefetch" href="http://huishao.cc">
    <!--SEO-->

<meta name="description" content="珲少的技术博客">



<meta name="keywords" content="珲少">



<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">
    <!--Title-->


<title>iOS9系列专题五——全新的联系人与联系人UI框架 | 珲少的技术博客</title>


    <link rel="alternate" href="/atom.xml" title="珲少的技术博客" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    





    
</head>

</html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  style="background-image:url(http://7xpw2b.com1.z0.glb.clouddn.com/hexo-sinppet/img/banner.png)"  >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='珲少'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
        	<!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
                <h2> 学如逆水行舟 </h2>
            
    	</div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://huishao.cc">珲少的技术博客</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>主页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/archives/"><i class="fa "></i>归档</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="iOS9系列专题五——全新的联系人与联系人UI框架">
            
	            iOS9系列专题五——全新的联系人与联系人UI框架
            
        </h1>
        <div class="post-meta">
    
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a href="/categories/iOS9专题">
            iOS9专题
        </a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
                
            
        </span>
    </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2015/09/28</span>
        </span>
    
</div>

            
            
    </div>
    
    <div class="post-body post-content">
        <h2 id="iOS9全新的联系人相关框架——Contacts-Framework"><a href="#iOS9全新的联系人相关框架——Contacts-Framework" class="headerlink" title="iOS9全新的联系人相关框架——Contacts Framework"></a>iOS9全新的联系人相关框架——Contacts Framework</h2><h3 id="一、引言"><a href="#一、引言" class="headerlink" title="一、引言"></a>一、引言</h3><pre><code>在以前iOS开发中，涉及联系人相关的编程，代码都非常繁琐，并且框架的设计也不是Objective-C风格的，这使开发者用起来非常的难受。在iOS9中，apple终于解决了这个问题，全新的Contacts Framework将完全替代AddressBookFramework，AddressBookFramework也将成为历史被弃用。至于AddressBookFramework的相关api如何繁琐，在以前的博客中有记录，地址如下：
</code></pre><p>联系人信息相关编程：<a href="http://my.oschina.net/u/2340880/blog/407347" target="_blank" rel="noopener">http://my.oschina.net/u/2340880/blog/407347</a>。</p>
<p>联系人UI界面相关编程：<a href="http://my.oschina.net/u/2340880/blog/407973" target="_blank" rel="noopener">http://my.oschina.net/u/2340880/blog/407973</a>。</p>
<pre><code>这一新的框架是iOS9新特性中十分受欢迎的一个。apple的Objective—C体系也更加完善与强大。
</code></pre><h3 id="二、让我们来添加一个联系人"><a href="#二、让我们来添加一个联系人" class="headerlink" title="二、让我们来添加一个联系人"></a>二、让我们来添加一个联系人</h3><pre><code>新的框架的整体思路是通过配置与请求来管理联系人，这样做有一个非常大的好处，逻辑简单，代码层次清晰。如下，通过添加一个联系人来向大家做演示：
</code></pre><h4 id="1、联系人对象：CNContact"><a href="#1、联系人对象：CNContact" class="headerlink" title="1、联系人对象：CNContact"></a>1、联系人对象：CNContact</h4><p>这个对象是用来配置联系人信息的，有可变的CNMutaleContact和CNContact，区别用来读取和创建联系人。CNContact对象中有许多属性，对应联系人的一些信息。</p>
<p>首先，创建CNMutableContact对象：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"> CNMutableContact * contact = [[CNMutableContact alloc]init];</span><br></pre></td></tr></table></figure>
<p>设置联系人头像：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">contact.imageData = UIImagePNGRepresentation([UIImage imageNamed:@&quot;Icon-114.png&quot;]);</span><br></pre></td></tr></table></figure>
<p>设置联系人姓名：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">    //设置名字</span><br><span class="line">    contact.givenName = @&quot;jaki&quot;;</span><br><span class="line">    //设置姓氏</span><br><span class="line">    contact.familyName = @&quot;zhang&quot;;</span><br></pre></td></tr></table></figure>
<p>设置联系人邮箱：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">     CNLabeledValue *homeEmail = [CNLabeledValue labeledValueWithLabel:CNLabelHome value:@&quot;316045346@qq.com&quot;];</span><br><span class="line">     CNLabeledValue *workEmail =[CNLabeledValue labeledValueWithLabel:CNLabelWork value:@&quot;316045346@qq.com&quot;];</span><br><span class="line">     contact.emailAddresses = @[homeEmail,workEmail];</span><br></pre></td></tr></table></figure>
<p>这里需要注意，emailAddresses属性是一个数组，数组中是才CNLabeledValue对象，CNLabeledValue对象主要用于创建一些联系人属性的键值对应，通过这些对应，系统会帮我们进行数据的格式化，例如CNLabelHome，就会将号码格式成家庭邮箱的格式，相应的其他键如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//家庭</span><br><span class="line">CONTACTS_EXTERN NSString * const CNLabelHome                             NS_AVAILABLE(10_11, 9_0);</span><br><span class="line">//工作</span><br><span class="line">CONTACTS_EXTERN NSString * const CNLabelWork                             NS_AVAILABLE(10_11, 9_0);</span><br><span class="line">//其他</span><br><span class="line">CONTACTS_EXTERN NSString * const CNLabelOther                            NS_AVAILABLE(10_11, 9_0);</span><br><span class="line"></span><br><span class="line">// 邮箱地址</span><br><span class="line">CONTACTS_EXTERN NSString * const CNLabelEmailiCloud                      NS_AVAILABLE(10_11, 9_0);</span><br><span class="line"></span><br><span class="line">// url地址</span><br><span class="line">CONTACTS_EXTERN NSString * const CNLabelURLAddressHomePage               NS_AVAILABLE(10_11, 9_0);</span><br><span class="line"></span><br><span class="line">// 日期</span><br><span class="line">CONTACTS_EXTERN NSString * const CNLabelDateAnniversary                  NS_AVAILABLE(10_11, 9_0);</span><br></pre></td></tr></table></figure>
<p>设置联系人电话：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">contact.phoneNumbers = @[[CNLabeledValue labeledValueWithLabel:CNLabelPhoneNumberiPhone value:[CNPhoneNumber phoneNumberWithStringValue:@&quot;12344312321&quot;]]];</span><br></pre></td></tr></table></figure>
<p>联系人电话的配置方式和邮箱类似，键值如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CONTACTS_EXTERN NSString * const CNLabelPhoneNumberiPhone                NS_AVAILABLE(10_11, 9_0);</span><br><span class="line">CONTACTS_EXTERN NSString * const CNLabelPhoneNumberMobile                NS_AVAILABLE(10_11, 9_0);</span><br><span class="line">CONTACTS_EXTERN NSString * const CNLabelPhoneNumberMain                  NS_AVAILABLE(10_11, 9_0);</span><br><span class="line">CONTACTS_EXTERN NSString * const CNLabelPhoneNumberHomeFax               NS_AVAILABLE(10_11, 9_0);</span><br><span class="line">CONTACTS_EXTERN NSString * const CNLabelPhoneNumberWorkFax               NS_AVAILABLE(10_11, 9_0);</span><br><span class="line">CONTACTS_EXTERN NSString * const CNLabelPhoneNumberOtherFax              NS_AVAILABLE(10_11, 9_0);</span><br><span class="line">CONTACTS_EXTERN NSString * const CNLabelPhoneNumberPager                 NS_AVAILABLE(10_11, 9_0);</span><br></pre></td></tr></table></figure>
<p>这里的CNPhoneNumber对象也是iOS9中的一个新的类，专门用来创建电话号码，之中方法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@interface CNPhoneNumber : NSObject &lt;NSCopying, NSSecureCoding&gt;</span><br><span class="line"></span><br><span class="line">//通过类方法创建</span><br><span class="line">+ (instancetype)phoneNumberWithStringValue:(NSString *)stringValue;</span><br><span class="line">//通过初始化方法创建</span><br><span class="line">- (instancetype)initWithStringValue:(NSString *)string;</span><br><span class="line"></span><br><span class="line">@property (readonly, copy, NS_NONATOMIC_IOSONLY) NSString *stringValue;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>设置联系人地址：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  CNMutablePostalAddress * homeAdress = [[CNMutablePostalAddress alloc]init];</span><br><span class="line">    homeAdress.street = @&quot;贝克街&quot;;</span><br><span class="line">    homeAdress.city = @&quot;伦敦&quot;;</span><br><span class="line">    homeAdress.state = @&quot;英国&quot;;</span><br><span class="line">    homeAdress.postalCode = @&quot;221B&quot;;</span><br><span class="line">    contact.postalAddresses = @[[CNLabeledValue labeledValueWithLabel:CNLabelHome value:homeAdress]];</span><br></pre></td></tr></table></figure>
<p>设置生日：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">NSDateComponents * birthday = [[NSDateComponents  alloc]init];</span><br><span class="line">    birthday.day=7;</span><br><span class="line">    birthday.month=5;</span><br><span class="line">    birthday.year=1992;</span><br><span class="line">    contact.birthday=birthday;</span><br></pre></td></tr></table></figure>
<h4 id="2、创建添加联系人请求：CNSaveRequest"><a href="#2、创建添加联系人请求：CNSaveRequest" class="headerlink" title="2、创建添加联系人请求：CNSaveRequest"></a>2、创建添加联系人请求：CNSaveRequest</h4><p>CNSaveRequest是用于存储联系人的请求类，通过这个类，我们可以创建批量添加、修改或者删除联系人的请求，例如添加上面我们创建的联系人对象：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   //初始化方法</span><br><span class="line">    CNSaveRequest * saveRequest = [[CNSaveRequest alloc]init];</span><br><span class="line">    //添加联系人</span><br><span class="line">    [saveRequest addContact:contact toContainerWithIdentifier:nil];</span><br></pre></td></tr></table></figure>
<p>这个类中还有许多方便我们操作的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">@interface CNSaveRequest : NSObject</span><br><span class="line">//添加一个联系人</span><br><span class="line">- (void)addContact:(CNMutableContact *)contact toContainerWithIdentifier:(nullable NSString *)identifier;</span><br><span class="line"></span><br><span class="line">//更新一个联系人</span><br><span class="line">- (void)updateContact:(CNMutableContact *)contact;</span><br><span class="line">//删除一个联系人</span><br><span class="line">- (void)deleteContact:(CNMutableContact *)contact;</span><br><span class="line">//添加一组联系人</span><br><span class="line">- (void)addGroup:(CNMutableGroup *)group toContainerWithIdentifier:(nullable NSString *)identifier;</span><br><span class="line">//更新一组联系人</span><br><span class="line">- (void)updateGroup:(CNMutableGroup *)group;</span><br><span class="line">//删除一组联系人</span><br><span class="line">- (void)deleteGroup:(CNMutableGroup *)group;</span><br><span class="line">//向组中添加子组</span><br><span class="line">- (void)addSubgroup:(CNGroup *)subgroup toGroup:(CNGroup *)group NS_AVAILABLE(10_11, NA);</span><br><span class="line">//在组中删除子组</span><br><span class="line">- (void)removeSubgroup:(CNGroup *)subgroup fromGroup:(CNGroup *)group NS_AVAILABLE(10_11, NA);</span><br><span class="line">//向组中添加成员</span><br><span class="line">- (void)addMember:(CNContact *)contact toGroup:(CNGroup *)group;</span><br><span class="line">//向组中移除成员</span><br><span class="line">- (void)removeMember:(CNContact *)contact fromGroup:(CNGroup *)group;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<h4 id="3、进行联系人的写入操作-CNContactStore"><a href="#3、进行联系人的写入操作-CNContactStore" class="headerlink" title="3、进行联系人的写入操作:CNContactStore"></a>3、进行联系人的写入操作:CNContactStore</h4><p>CNContactStore是一个用于存取联系人的上下文桥梁，现在，把我们创建的添加联系人的请求写入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">    CNContactStore * store = [[CNContactStore alloc]init];</span><br><span class="line">    [store executeSaveRequest:saveRequest error:nil];</span><br></pre></td></tr></table></figure>
<p>在模拟器上运行程序，打开联系人，效果如下：</p>
<p>联系人界面：</p>
<p><img src="http://static.oschina.net/uploads/space/2015/0928/145818_XI8e_2340880.png" alt></p>
<p>联系人详情：</p>
<p><img src="http://static.oschina.net/uploads/space/2015/0928/145821_wx4x_2340880.png" alt></p>
<h3 id="三、获取格式化的联系人信息"><a href="#三、获取格式化的联系人信息" class="headerlink" title="三、获取格式化的联系人信息"></a>三、获取格式化的联系人信息</h3><p>iOS9中，ContactFramework也为开发者提供了非常方便的格式化信息的方法，还拿我们上面创建的联系人对象举例：</p>
<h4 id="1、获取格式化的联系人姓名"><a href="#1、获取格式化的联系人姓名" class="headerlink" title="1、获取格式化的联系人姓名"></a>1、获取格式化的联系人姓名</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">    NSString * foematter =[CNContactFormatter stringFromContact:contact style:CNContactFormatterStyleFullName];</span><br><span class="line">    NSLog(@&quot;%@&quot;,foematter);</span><br></pre></td></tr></table></figure>
<p>这个运行后会打印出jaki zhang，其中style风格枚举如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">typedef NS_ENUM(NSInteger, CNContactFormatterStyle)</span><br><span class="line">&#123;</span><br><span class="line">    //获取全名</span><br><span class="line">    CNContactFormatterStyleFullName,</span><br><span class="line">   //获取拼音全名</span><br><span class="line">    CNContactFormatterStylePhoneticFullName,</span><br><span class="line">&#125; NS_ENUM_AVAILABLE(10_11, 9_0);</span><br></pre></td></tr></table></figure>
<h4 id="2、获取格式化的联系人地址"><a href="#2、获取格式化的联系人地址" class="headerlink" title="2、获取格式化的联系人地址"></a>2、获取格式化的联系人地址</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">    NSString * foematter =[CNPostalAddressFormatter stringFromPostalAddress:homeAdress style:CNPostalAddressFormatterStyleMailingAddress];</span><br><span class="line">    NSLog(@&quot;%@&quot;,foematter);</span><br></pre></td></tr></table></figure>
<p>打印如下：</p>
<p><img src="http://static.oschina.net/uploads/space/2015/0928/151520_bayu_2340880.png" alt></p>
<h3 id="四、提取联系人"><a href="#四、提取联系人" class="headerlink" title="四、提取联系人"></a>四、提取联系人</h3><pre><code>在开发中，提取联系人的使用率要远远高于创建联系人，ContactFramework提取联系人的方式，类似于数据库的检索方式，通过配置条件，提取出我们需要的数据，例如：
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    CNContactStore * stroe = [[CNContactStore alloc]init];</span><br><span class="line">    //检索条件，检索所有名字中有zhang的联系人</span><br><span class="line">    NSPredicate * predicate = [CNContact predicateForContactsMatchingName:@&quot;zhang&quot;];</span><br><span class="line">    //提取数据</span><br><span class="line">    NSArray * contacts = [stroe unifiedContactsMatchingPredicate:predicate keysToFetch:@[CNContactGivenNameKey] error:nil];</span><br></pre></td></tr></table></figure>
<p>keysToFetch是设置提取联系人的哪些数据，如上则只提取出检索联系人的名字。</p>
<p>同样，也可以通过请求的方式来对联系人进行遍历：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    CNContactStore * stroe = [[CNContactStore alloc]init];</span><br><span class="line">    CNContactFetchRequest * request = [[CNContactFetchRequest alloc]initWithKeysToFetch:@[CNContactPhoneticFamilyNameKey]];</span><br><span class="line">    [stroe enumerateContactsWithFetchRequest:request error:nil usingBlock:^(CNContact * _Nonnull contact, BOOL * _Nonnull stop) &#123;</span><br><span class="line">        NSLog(@&quot;%@&quot;,contact);</span><br><span class="line">    &#125;];</span><br></pre></td></tr></table></figure>
<h3 id="五、ContactFramework-UI相关"><a href="#五、ContactFramework-UI相关" class="headerlink" title="五、ContactFramework UI相关"></a>五、ContactFramework UI相关</h3><p>iOS9中，系统也为我们封装好了一套联系人的UI界面，用起来也十分方便，主要新增的controller有两个：</p>
<p>CNContactPickerViewController：展示联系人列表的controller</p>
<p>CNContactViewController：展示联系人详细信息的controller</p>
<p>示例如下：</p>
<p>弹出联系人列表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">    CNContactPickerViewController * con = [[CNContactPickerViewController alloc]init];</span><br><span class="line">    [self presentViewController:con animated:YES completion:nil];</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<p><img src="http://static.oschina.net/uploads/space/2015/0928/163302_RfwI_2340880.png" alt></p>
<p>联系人逻辑的相关处理主要在CNContactPickerDelegate中完成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//视图取消时 调用的方法</span><br><span class="line">- (void)contactPickerDidCancel:(CNContactPickerViewController *)picker;</span><br><span class="line">//选中与取消选中时调用的方法</span><br><span class="line">- (void)contactPicker:(CNContactPickerViewController *)picker didSelectContact:(CNContact *)contact;</span><br><span class="line">- (void)contactPicker:(CNContactPickerViewController *)picker didSelectContactProperty:(CNContactProperty *)contactProperty;</span><br><span class="line">- (void)contactPicker:(CNContactPickerViewController *)picker didSelectContacts:(NSArray&lt;CNContact*&gt; *)contacts;</span><br><span class="line">- (void)contactPicker:(CNContactPickerViewController *)picker didSelectContactProperties:(NSArray&lt;CNContactProperty*&gt; *)contactProperties;</span><br></pre></td></tr></table></figure>
<p>CNContactViewController则是用来显示具体联系人的详细信息的，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">    CNContactViewController * con = [CNContactViewController viewControllerForContact:contact];</span><br><span class="line">    [self presentViewController:con animated:YES completion:nil];</span><br></pre></td></tr></table></figure>
<p>相关代理回调函数如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//将要展示联系人信息与已经展示联系人信息的回调</span><br><span class="line">- (BOOL)contactViewController:(CNContactViewController *)viewController shouldPerformDefaultActionForContactProperty:(CNContactProperty *)property;</span><br><span class="line">- (void)contactViewController:(CNContactViewController *)viewController didCompleteWithContact:(nullable CNContact *)contact;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>专注技术，热爱生活，交流技术，也做朋友。</p>
<p>——珲少 QQ群：203317592</p>
</blockquote>

    </div>

    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © 微信：15137348047
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/2015/09/28/116iOS9系列专题四——APP传输安全/" class="pre-post btn btn-default" title='iOS9系列专题四——APP传输安全'>
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">iOS9系列专题四——APP传输安全</span>
        </a>
    
    
        <a href="/2015/09/28/117Xcode多版本的dmg文件下载方式/" class="next-post btn btn-default" title='Xcode多版本的dmg文件下载方式'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">Xcode多版本的dmg文件下载方式</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
<div id="lv-container" data-id="city" data-uid="MTAyMC8zNzY0Ny8xNDE3OA==">
  <script type="text/javascript">
     (function(d, s) {
         var j, e = d.getElementsByTagName(s)[0];
         if (typeof LivereTower === 'function') { return; }
         j = d.createElement(s);
         j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
         j.async = true;
         e.parentNode.insertBefore(j, e);
     })(document, 'script');
  </script>
</div>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#iOS9全新的联系人相关框架——Contacts-Framework"><span class="toc-text">iOS9全新的联系人相关框架——Contacts Framework</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一、引言"><span class="toc-text">一、引言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#二、让我们来添加一个联系人"><span class="toc-text">二、让我们来添加一个联系人</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1、联系人对象：CNContact"><span class="toc-text">1、联系人对象：CNContact</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2、创建添加联系人请求：CNSaveRequest"><span class="toc-text">2、创建添加联系人请求：CNSaveRequest</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3、进行联系人的写入操作-CNContactStore"><span class="toc-text">3、进行联系人的写入操作:CNContactStore</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#三、获取格式化的联系人信息"><span class="toc-text">三、获取格式化的联系人信息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1、获取格式化的联系人姓名"><span class="toc-text">1、获取格式化的联系人姓名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2、获取格式化的联系人地址"><span class="toc-text">2、获取格式化的联系人地址</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#四、提取联系人"><span class="toc-text">四、提取联系人</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#五、ContactFramework-UI相关"><span class="toc-text">五、ContactFramework UI相关</span></a></li></ol></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12"> 
                <span>Copyright &copy; 2018
                </span> | 
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> | 
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



<script src="/js/app.js?rev=@@hash"></script>


</body>
</html>
<script src="https://eqcn.ajz.miesnfu.com/wp-content/plugins/wp-3d-pony/live2dw/lib/L2Dwidget.min.js"></script> 
<script>
　　let models = [
    "https://unpkg.com/live2d-widget-model-chitose@1.0.5/assets/chitose.model.json",
    "https://unpkg.com/live2d-widget-model-shizuku@1.0.5/assets/shizuku.model.json",
    "https://unpkg.com/live2d-widget-model-koharu@1.0.5/assets/koharu.model.json",
    "https://unpkg.com/live2d-widget-model-haruto@1.0.5/assets/haruto.model.json",
    "https://unpkg.com/live2d-widget-model-miku@1.0.5/assets/miku.model.json",
    "https://unpkg.com/live2d-widget-model-z16@1.0.5/assets/z16.model.json"
];
let m = models[Math.round(Math.random()*5)];
　　L2Dwidget.init({ 
　　"model": {jsonPath:m,"scale": 1 }, 
　　"display": { "position": "left", "width": 200, "height": 300,"hOffset": 0, "vOffset": -20 }, 
　　"mobile": { "show": true, "scale": 0.5 }, 
　　"react": { "opacityDefault": 0.7, "opacityOnHover": 0.2 } });
</script> 
<!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="珲少的技术博客">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <link rel="dns-prefetch" href="http://huishao.cc">
    <meta name="referrer" content="no-referrer">
    <!--SEO-->

<meta name="description" content="珲少的技术博客">



<meta name="keywords" content="珲少">



<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">
    <!--Title-->


<title>UIInteraction：iOS中强大的视图交互能力 | 珲少的技术博客</title>


    <link rel="alternate" href="/atom.xml" title="珲少的技术博客" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    





    
</head>

</html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  style="background-image:url(http://7xpw2b.com1.z0.glb.clouddn.com/hexo-sinppet/img/banner.png)"  >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='珲少'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
        	<!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
                <h2> 学如逆水行舟 </h2>
            
    	</div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://huishao.cc">珲少的技术博客</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>主页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/archives/"><i class="fa "></i>归档</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="UIInteraction：iOS中强大的视图交互能力">
            
	            UIInteraction：iOS中强大的视图交互能力
            
        </h1>
        <div class="post-meta">
    
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a href="/categories/iOS之逻辑初窥">
            iOS之逻辑初窥
        </a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
                
            
        </span>
    </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2024/09/02</span>
        </span>
    
</div>

            
            
    </div>
    
    <div class="post-body post-content">
        <h1 id="UIInteraction：iOS中强大的视图交互能力"><a href="#UIInteraction：iOS中强大的视图交互能力" class="headerlink" title="UIInteraction：iOS中强大的视图交互能力"></a>UIInteraction：iOS中强大的视图交互能力</h1><p>UIInteraction是iOS开发框架中提供的一个协议，此协议可以为视图增加非常强大的交互能力，例如进行文字的识别和提取，图片的分析、物理按键的拍摄处理等等。本章将总结目前系统提供的遵守了UIInteraction协议的交互类，介绍这些系统交互的使用方法，希望可以对你有所启发，将这些能力应用到具体的业务场景中去。</p>
<h2 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h2><p>AVCaptureEventInteraction：相机拍照事件捕获交互（物理按键）。</p>
<p>ImageAnalysisInteraction：为图片添加识别文本，条形码和其他对象的交互。</p>
<p>UIContextMenuInteraction：显示与用户关注点内容相关的菜单交互，例如进行长按时弹出交互菜单。</p>
<p>UIEditMenuInteraction：编辑类菜单交互，主要用在文本输入类的组件上。</p>
<p>UIFindInteraction：进行文本查找与替换的交互。</p>
<p>UILargeContentViewerInteraction：大内容查看交互，例如将某个小组件进行方法查看。</p>
<p>UIFeedbackGenerator：用户交互反击的生成器类，用来统一的处理用户的交互返回（各种震动效果），后续详细介绍。</p>
<p>UIDragInteraction：对组件进行拖拽交互，是可以支持跨应用的。</p>
<p>UIDropInteraction：将组件拖拽放置的交互，是可以支持跨应用的。</p>
<p>UITextInteraction：对自定义的文本组件提供原生体验一致的手势交互，如文本选择。</p>
<p>UITextSelectionDisplayInteraction：选中文本展示的UI交互。</p>
<p>UISpringLoadedInteraction：拖拽时提供动态导航交互，简单说就是当拖转组件到一个元素时，可以动态的触发元素的点击跳转。</p>
<p>UIBandSelectionInteraction：跟踪指针位置选中项目的交互，在有鼠标或其他指针的场景中需要用到此种交互，本文不做探讨。</p>
<p>UIToolTipInteraction：指针悬停在组件上展示提示UI的交互，本文不做讨论。</p>
<p>UIPencilInteraction：Apple Pencil的交互，某些型号的笔可以进行挤压和双击交互，本文不做讨论。</p>
<p>UIIndirectScribbleInteraction：非常规的输入类视图的用户交互，主要是手写跟踪，本文不做讨论。</p>
<p>UIPointerInteraction：定义鼠标指针外观的交互，本文不做讨论。</p>
<p>UIScribbleInteraction：提供涂写交互能力，本文不做讨论。</p>
<p>GCEventInteraction：GameController交互，涉及到GameController框架，这里不做讨论。</p>
<p>BETextInteraction：浏览器文本视图相关交互，涉及到BrowserEngineKit框架，iOS17.4之后支持三方开发浏览器软件，这不再本篇文章的讨论范围</p>
<p>上面所列举出的类都是遵守了UIInteraction类，并提供了相关交互能力。本篇文章主要介绍其中与iPhone设备上应用体验相关的交互，对Vision设备，iPad和Mac等可以手写和处理指针的交互不做过多的讨论。下面我们会逐一对这些交互能力的使用进行介绍。</p>
<h2 id="AVCaptureEventInteraction相机拍照事件捕获交互"><a href="#AVCaptureEventInteraction相机拍照事件捕获交互" class="headerlink" title="AVCaptureEventInteraction相机拍照事件捕获交互"></a>AVCaptureEventInteraction相机拍照事件捕获交互</h2><p>在iPhone设备上，系统的相机有一个非常好用的功能，即可以通过按下任意的音量键来执行拍照动作，这也是自拍杆之所以无需点击虚拟拍照按钮就可以控制系统相机拍照的原因。AVCaptureEventInteraction提供了交互接口，可以让用户在自己的应用中实现这一功能。首先AVCaptureEventInteraction提供的本质上是物理按键的监听能力，因此必须要求在应用捕获摄像头的视频流时才能使用。</p>
<blockquote>
<p>非常重要：AVCaptureEventInteraction的相关API只能用在相机捕获实时影像的场景中，只有当摄像头正在使用时系统才会正常的发送硬件事件，在后台的应用以及没有使用摄像头的应用都无法接收到这个事件。</p>
</blockquote>
<p>示例代码：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"><span class="keyword">import</span> AVKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">AVCaptureVideoDataOutputSampleBufferDelegate</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// A capture event interaction to handle hardware button presses.</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> eventInteraction: <span class="type">AVCaptureEventInteraction</span>!</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> captureSession: <span class="type">AVCaptureSession</span>!</span><br><span class="line">    <span class="keyword">var</span> videoPreviewLayer: <span class="type">AVCaptureVideoPreviewLayer</span>!</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        view.backgroundColor = .white</span><br><span class="line">        <span class="comment">// Configure the app to take a photo on hardware button press.</span></span><br><span class="line">        configureHardwareInteraction()</span><br><span class="line">        <span class="comment">// 设置相机会话</span></span><br><span class="line">        captureSession = <span class="type">AVCaptureSession</span>()</span><br><span class="line">        captureSession.beginConfiguration()</span><br><span class="line">        captureSession.sessionPreset = .high</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> videoDevice = <span class="type">AVCaptureDevice</span>.<span class="keyword">default</span>(<span class="keyword">for</span>: .video) <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> videoInput = <span class="keyword">try</span>? <span class="type">AVCaptureDeviceInput</span>(device: videoDevice) <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> captureSession.canAddInput(videoInput) &#123;</span><br><span class="line">            captureSession.addInput(videoInput)</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">let</span> videoOutput = <span class="type">AVCaptureVideoDataOutput</span>()</span><br><span class="line">        videoOutput.setSampleBufferDelegate(<span class="keyword">self</span>, queue: <span class="type">DispatchQueue</span>(label: <span class="string">"videoQueue"</span>))</span><br><span class="line">        <span class="keyword">if</span> captureSession.canAddOutput(videoOutput) &#123;</span><br><span class="line">            captureSession.addOutput(videoOutput)</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        captureSession.commitConfiguration()</span><br><span class="line">        captureSession.startRunning()</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 创建视频预览层</span></span><br><span class="line">        videoPreviewLayer = <span class="type">AVCaptureVideoPreviewLayer</span>(session: captureSession)</span><br><span class="line">        videoPreviewLayer.frame = view.bounds</span><br><span class="line">        view.layer.addSublayer(videoPreviewLayer)</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLayoutSubviews</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLayoutSubviews()</span><br><span class="line">        videoPreviewLayer.frame = view.bounds</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">configureHardwareInteraction</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">// 处理硬件事件触发逻辑的逻辑</span></span><br><span class="line">        <span class="comment">// 可以读取当前的视频流进行拍摄</span></span><br><span class="line">        eventInteraction = <span class="type">AVCaptureEventInteraction</span> &#123; event <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"事件阶段状态 - "</span>, event.phase)</span><br><span class="line">        &#125; secondary: &#123; event <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"事件阶段状态 - "</span>, event.phase)</span><br><span class="line">        &#125;</span><br><span class="line">        eventInteraction.isEnabled = <span class="literal">true</span></span><br><span class="line">        view.addInteraction(eventInteraction)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> AVCaptureEventInteraction类的定义本身非常简单：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">17.2</span>, *)</span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">AVCaptureEventInteraction</span> : <span class="title">NSObject</span>, <span class="title">UIInteraction</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 初始化方法，注册一个事件回调</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(handler: @escaping (<span class="type">AVCaptureEvent</span>) -&gt; <span class="type">Void</span>)</span><br><span class="line">    <span class="comment">// 初始化方法，注册一个事件回调，回调中的两个参数分别对应音量上和下两个按钮的点击</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(primary primaryHandler: @escaping (<span class="type">AVCaptureEvent</span>) -&gt; <span class="type">Void</span>, secondary secondaryHandler: @escaping (<span class="type">AVCaptureEvent</span>) -&gt; <span class="type">Void</span>)</span><br><span class="line">    <span class="comment">// 设置此交互行为是否生效</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> isEnabled: <span class="type">Bool</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其回调中的AVCaptureEvent会标识事件的状态：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">17.2</span>, *)</span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">AVCaptureEvent</span> : <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 事件的状态</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> phase: <span class="type">AVCaptureEventPhase</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@available</span>(iOS <span class="number">17.2</span>, *)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">AVCaptureEventPhase</span> : <span class="title">UInt</span>, @<span class="title">unchecked</span> <span class="title">Sendable</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 点击开始</span></span><br><span class="line">    <span class="keyword">case</span> began = <span class="number">0</span></span><br><span class="line">    <span class="comment">// 点击结束</span></span><br><span class="line">    <span class="keyword">case</span> ended = <span class="number">1</span></span><br><span class="line">    <span class="comment">// 事件取消</span></span><br><span class="line">    <span class="keyword">case</span> cancelled = <span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需要注意，所有的AVCaptureEventInteraction接口都在iOS17.2之后可用。</p>
<h2 id="ImageAnalysisInteraction图片识别交互"><a href="#ImageAnalysisInteraction图片识别交互" class="headerlink" title="ImageAnalysisInteraction图片识别交互"></a>ImageAnalysisInteraction图片识别交互</h2><p>图片中往往包含了许多标准化的信息，如文本信息，二维码信息等。在使用iOS系统的图库软件时，用户可以直接长按图片来提取图片中的信息，如进行文本的复制，二维码的识别等。ImageAnalysisInteraction类即可提供这种交互能力。</p>
<p>ImageAnalysisInteraction交互有很多应用场景，可以复制图片中的文本，可以快捷拨打电话、翻译、识别链接和二维码等。ImageAnalysisInteraction是基于VersionKit框架实现的，VersionKit是Apple提供的一套与视觉处理相关功能的框架。</p>
<p>需要注意，ImageAnalysisInteraction本身只是提供了一套识别后的用户交互，具体的分析任务是由ImageAnalyzer类实现的。ImageAnalyzer只能在 A12及以上的芯片设备上使用，因此在使用此功能前，需要先做下可用性判断。</p>
<p>ImageAnalysisInteraction的交互官网示例图如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-70723799539872d29f6cf73c33367d017a0.png" alt></p>
<p>当ImageAnalyzer对图片分析完成后，可以将结果传递给ImageAnalysisInteraction，此时UIImageView的组件的右下角会显示一个扫描样式的图标，单击此图标即可查看分析的结果，图片中会将识别出的元素区域进行高亮，并支持用户操作。</p>
<p>示例代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> VisionKit</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">ImageAnalysisInteractionDelegate</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> interaction = <span class="type">ImageAnalysisInteraction</span>()</span><br><span class="line">    <span class="keyword">let</span> imageDataAnalyzer = <span class="type">ImageAnalyzer</span>()</span><br><span class="line">    <span class="keyword">let</span> imageView = <span class="type">UIImageView</span>(image: <span class="type">UIImage</span>(named: <span class="string">"img"</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        imageView.contentMode = .scaleAspectFit</span><br><span class="line">        view.addSubview(imageView)</span><br><span class="line">        imageView.frame = view.bounds</span><br><span class="line">        <span class="keyword">if</span> <span class="type">ImageAnalyzer</span>.isSupported &#123;</span><br><span class="line">            imageView.addInteraction(interaction)</span><br><span class="line">            interaction.delegate = <span class="keyword">self</span></span><br><span class="line">            <span class="comment">// 设置预期接收的交互</span></span><br><span class="line">            interaction.preferredInteractionTypes = [.automatic]</span><br><span class="line">            <span class="type">Task</span> &#123;</span><br><span class="line">                <span class="comment">// 配置 configuration 对象</span></span><br><span class="line">                <span class="keyword">let</span> configuration = <span class="type">ImageAnalyzer</span>.<span class="type">Configuration</span>([.text, .machineReadableCode])</span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    <span class="comment">// 开始执行分析</span></span><br><span class="line">                    <span class="keyword">let</span> analysis = <span class="keyword">try</span> await imageDataAnalyzer.analyze(imageView.image!, configuration: configuration)</span><br><span class="line">                    <span class="comment">// 分析信息结果接收</span></span><br><span class="line">                    interaction.analysis = analysis</span><br><span class="line">                &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">                 <span class="comment">// 处理异常</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>找一测试图片进行识别，效果如下图所示：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-e88a623f3ae3fc9192c6934dafb91271751.png" alt></p>
<p>下面，我们再来详细解析下ImageAnalysisInteraction接口的功能，ImageAnalyzer的识别能力本身，这里就不再赘述，</p>
<p>ImageAnalysisInteraction交互可以直接添加在UIImageView上，如果我们不使用UIImageView组件来展示图片，也可以手动设置图片渲染的区域，ImageAnalysisInteraction会将交互内容映射到对应组件的正确位置上。</p>
<p>ImageAnalysisInteraction类中的核心属性和方法如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">16.0</span>, macCatalyst <span class="number">17.0</span>, *)</span><br><span class="line">@<span class="type">MainActor</span> <span class="meta">@objc</span> <span class="keyword">final</span> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageAnalysisInteraction</span> : <span class="title">NSObject</span>, <span class="title">UIInteraction</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 设置代理</span></span><br><span class="line">    @<span class="type">MainActor</span> <span class="keyword">weak</span> <span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">var</span> delegate: (any <span class="type">ImageAnalysisInteractionDelegate</span>)?</span><br><span class="line">    <span class="comment">// 图片分析的结果，分析完成后对此属性进行赋值</span></span><br><span class="line">    @<span class="type">MainActor</span> <span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">var</span> analysis: <span class="type">ImageAnalysis</span>?</span><br><span class="line">    <span class="comment">// 设置期望支持的交互的类型</span></span><br><span class="line">    @<span class="type">MainActor</span> <span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">var</span> preferredInteractionTypes: <span class="type">ImageAnalysisInteraction</span>.<span class="type">InteractionTypes</span></span><br><span class="line">    <span class="comment">// 目前所激活的交互类型</span></span><br><span class="line">    @<span class="type">MainActor</span> <span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">var</span> activeInteractionTypes: <span class="type">ImageAnalysisInteraction</span>.<span class="type">InteractionTypes</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 可选择的元素是否高亮，内部会自己管理此属性的值</span></span><br><span class="line">    @<span class="type">MainActor</span> <span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">var</span> selectableItemsHighlighted: <span class="type">Bool</span></span><br><span class="line">    <span class="comment">// 是否有激活被选中的文本</span></span><br><span class="line">    @<span class="type">MainActor</span> <span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">var</span> hasActiveTextSelection: <span class="type">Bool</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 清空所有选中的文本</span></span><br><span class="line">    @<span class="type">MainActor</span> <span class="keyword">final</span> <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">resetTextSelection</span><span class="params">()</span></span></span><br><span class="line">    <span class="comment">// 图片中的文本</span></span><br><span class="line">    @<span class="type">MainActor</span> <span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">var</span> text: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 被选中的文本</span></span><br><span class="line">    @<span class="type">MainActor</span> <span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">var</span> selectedText: <span class="type">String</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 选中的文本的attribute属性</span></span><br><span class="line">    @<span class="type">MainActor</span> <span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">var</span> selectedAttributedText: <span class="type">AttributedString</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 选中的文本的范围</span></span><br><span class="line">    @<span class="type">MainActor</span> <span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">var</span> selectedRanges: [<span class="type">Range</span>&lt;<span class="type">String</span>.<span class="type">Index</span>&gt;]</span><br><span class="line">    <span class="comment">// 当不使用UIImageView来展示图片时，图片的渲染区域如果有修改，需要调用此方法通知交互层来对应的更新</span></span><br><span class="line">    @<span class="type">MainActor</span> <span class="keyword">final</span> <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">setContentsRectNeedsUpdate</span><span class="params">()</span></span></span><br><span class="line">    <span class="comment">// 单位空间内的描述交互区域的矩形</span></span><br><span class="line">    @<span class="type">MainActor</span> <span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">var</span> contentsRect: <span class="type">CGRect</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 视图的某个位置是否有可交互元素</span></span><br><span class="line">    @<span class="type">MainActor</span> <span class="keyword">final</span> <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">hasInteractiveItem</span><span class="params">(at point: CGPoint)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">    <span class="comment">// 视图的某个位置是否有文本</span></span><br><span class="line">    @<span class="type">MainActor</span> <span class="keyword">final</span> <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">hasText</span><span class="params">(at point: CGPoint)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">    <span class="comment">// 视图的某个位置是否有检测到数据</span></span><br><span class="line">    @<span class="type">MainActor</span> <span class="keyword">final</span> <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">hasDataDetector</span><span class="params">(at point: CGPoint)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">    <span class="comment">// 实时文本按钮是否可见，右下角的按钮</span></span><br><span class="line">    @<span class="type">MainActor</span> <span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">var</span> liveTextButtonVisible: <span class="type">Bool</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 识别出的所有主题的集合</span></span><br><span class="line">    @<span class="type">MainActor</span> <span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">var</span> subjects: <span class="type">Set</span>&lt;<span class="type">ImageAnalysisInteraction</span>.<span class="type">Subject</span>&gt; &#123; <span class="keyword">get</span> async &#125;</span><br><span class="line">    <span class="comment">// 高亮的主题集合</span></span><br><span class="line">    @<span class="type">MainActor</span> <span class="keyword">final</span> <span class="keyword">public</span> <span class="keyword">var</span> highlightedSubjects: <span class="type">Set</span>&lt;<span class="type">ImageAnalysisInteraction</span>.<span class="type">Subject</span>&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过InteractionTypes可以设置预期支持的交互类型以及可以获取到最终识别出的交互类型，此类型定义如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">InteractionTypes</span> : <span class="title">OptionSet</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 自动，支持任意类型</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> automatic: <span class="type">ImageAnalysisInteraction</span>.<span class="type">InteractionTypes</span></span><br><span class="line">    <span class="comment">// 文本类的所有类型</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> automaticTextOnly: <span class="type">ImageAnalysisInteraction</span>.<span class="type">InteractionTypes</span></span><br><span class="line">    <span class="comment">// 文本选择类，包括选中，拷贝和翻译</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> textSelection: <span class="type">ImageAnalysisInteraction</span>.<span class="type">InteractionTypes</span></span><br><span class="line">    <span class="comment">// 数据类，包括链接，邮箱，地址</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> dataDetectors: <span class="type">ImageAnalysisInteraction</span>.<span class="type">InteractionTypes</span></span><br><span class="line">    <span class="comment">// 图片主题类，包括抠图等</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> imageSubject: <span class="type">ImageAnalysisInteraction</span>.<span class="type">InteractionTypes</span></span><br><span class="line">    <span class="comment">// 支持更多的图片选项，如图片的分类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> visualLookUp: <span class="type">ImageAnalysisInteraction</span>.<span class="type">InteractionTypes</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>开发者也可以参与到交互的流程中，通过ImageAnalysisInteractionDelegate协议可以更精细化的控制交互行为:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">16.0</span>, macCatalyst <span class="number">17.0</span>, *)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">ImageAnalysisInteractionDelegate</span> : <span class="title">AnyObject</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 返回一个布尔值，可以控制某个位置是否允许交互</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">interaction</span><span class="params">(<span class="number">_</span> interaction: ImageAnalysisInteraction, shouldBeginAt point: CGPoint, <span class="keyword">for</span> interactionType: ImageAnalysisInteraction.InteractionTypes)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">    <span class="comment">// 对于非UIImageView的组件，此代理可以返回一个渲染区域，用来告诉交互层要渲染的位置</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">contentsRect</span><span class="params">(<span class="keyword">for</span> interaction: ImageAnalysisInteraction)</span></span> -&gt; <span class="type">CGRect</span></span><br><span class="line">    <span class="comment">// 自定义设置用来渲染图片的视图</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">contentView</span><span class="params">(<span class="keyword">for</span> interaction: ImageAnalysisInteraction)</span></span> -&gt; <span class="type">UIView</span>?</span><br><span class="line">    <span class="comment">// 设置一个视图控制器用来承接可交互元素的弹出跳转，默认为Window的根视图</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">presentingViewController</span><span class="params">(<span class="keyword">for</span> interaction: ImageAnalysisInteraction)</span></span> -&gt; <span class="type">UIViewController</span>?</span><br><span class="line">    <span class="comment">// 当实时文本的可见性变化时会回调</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">interaction</span><span class="params">(<span class="number">_</span> interaction: ImageAnalysisInteraction, liveTextButtonDidChangeToVisible visible: Bool)</span></span></span><br><span class="line">    <span class="comment">// 选中的高亮元素变化时回调</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">interaction</span><span class="params">(<span class="number">_</span> interaction: ImageAnalysisInteraction, highlightSelectedItemsDidChange highlightSelectedItems: Bool)</span></span></span><br><span class="line">    <span class="comment">// 选中的文本变化时回调</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">textSelectionDidChange</span><span class="params">(<span class="number">_</span> interaction: ImageAnalysisInteraction)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="UIContextMenuInteraction上下文菜单交互"><a href="#UIContextMenuInteraction上下文菜单交互" class="headerlink" title="UIContextMenuInteraction上下文菜单交互"></a>UIContextMenuInteraction上下文菜单交互</h2><p>当我们在系统的浏览器中对某个链接触发3D Touch或长按操作时，可以看到会在当前页面弹出一个浮层，浮层会对超链接进行预览展示，并提供一些操作菜单项。这其实就是UIContextMenuInteraction提供的交互能力。</p>
<p>UIContextMenuInteraction可以为某个可交互控件提供浮层预览和菜单能力。</p>
<p>先来看一个示例：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">UIContextMenuInteractionDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">contextMenuInteraction</span><span class="params">(<span class="number">_</span> interaction: UIContextMenuInteraction, configurationForMenuAtLocation location: CGPoint)</span></span> -&gt; <span class="type">UIContextMenuConfiguration</span>? &#123;</span><br><span class="line">        <span class="keyword">return</span> .<span class="keyword">init</span>(identifier: <span class="literal">nil</span>) &#123;</span><br><span class="line">            <span class="comment">// 设置预览控制器，返回空则不展示额外的预览</span></span><br><span class="line">            <span class="literal">nil</span></span><br><span class="line">        &#125; actionProvider: &#123; elements <span class="keyword">in</span></span><br><span class="line">            <span class="comment">// 设置菜单项</span></span><br><span class="line">            <span class="keyword">let</span> favoriteAction = <span class="type">UIAction</span>(title: <span class="string">"喜欢"</span>, image: <span class="type">UIImage</span>(systemName: <span class="string">"heart.fill"</span>), state: .off) &#123; (action) <span class="keyword">in</span></span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">let</span> shareAction = <span class="type">UIAction</span>(title: <span class="string">"分享"</span>, image: <span class="type">UIImage</span>(systemName: <span class="string">"square.and.arrow.up.fill"</span>), state: .off) &#123; (action) <span class="keyword">in</span></span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> deleteAction = <span class="type">UIAction</span>(title: <span class="string">"删除"</span>, image: <span class="type">UIImage</span>(systemName: <span class="string">"trash.fill"</span>),</span><br><span class="line">                                        attributes: [.destructive], state: .on) &#123; (action) <span class="keyword">in</span></span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">UIMenu</span>(title: <span class="string">"菜单"</span>, children: [favoriteAction, shareAction, deleteAction])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> imageView = <span class="type">UIImageView</span>(image: <span class="type">UIImage</span>(named: <span class="string">"img"</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        imageView.isUserInteractionEnabled = <span class="literal">true</span></span><br><span class="line">        imageView.contentMode = .scaleAspectFill</span><br><span class="line">        view.addSubview(imageView)</span><br><span class="line">        imageView.frame = <span class="type">CGRect</span>(x: view.frame.width / <span class="number">2</span> - <span class="number">150</span>, y: view.frame.height / <span class="number">2</span> - <span class="number">150</span>, width: <span class="number">300.0</span>, height: <span class="number">300.0</span>)</span><br><span class="line">        <span class="keyword">let</span> interaction = <span class="type">UIContextMenuInteraction</span>(delegate: <span class="keyword">self</span>)</span><br><span class="line">        <span class="comment">// 为图片控件添加UIContextMenuInteraction交互</span></span><br><span class="line">        imageView.addInteraction(interaction)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行代码效果如下图所示：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-71f5661070fe1d816cbef1762732bcac944.png" alt></p>
<p>在代码配置中，并没有设置预览控制器，因此其触发UIContextMenuInteraction交互时，会将原组件进行高亮，并将其他背景进行模糊。需要注意，UIContextMenuInteraction交互需要在iOS13及以上系统重使用。UIContextMenuInteraction本身比较简单，定义如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">13.0</span>, *)</span><br><span class="line">@<span class="type">MainActor</span> <span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">UIContextMenuInteraction</span> : <span class="title">NSObject</span>, <span class="title">UIInteraction</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 代理</span></span><br><span class="line">    <span class="keyword">weak</span> <span class="keyword">open</span> <span class="keyword">var</span> delegate: (any <span class="type">UIContextMenuInteractionDelegate</span>)? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 菜单当前是否正在展示</span></span><br><span class="line">    <span class="meta">@available</span>(iOS <span class="number">14.0</span>, *)</span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> menuAppearance: <span class="type">UIContextMenuInteraction</span>.appearance &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 初始化方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(delegate: any <span class="type">UIContextMenuInteractionDelegate</span>)</span><br><span class="line">    <span class="comment">// 这是一个抽象方法，子类可以重写，从而控制菜单弹出的位置</span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">location</span><span class="params">(<span class="keyword">in</span> view: UIView?)</span></span> -&gt; <span class="type">CGPoint</span></span><br><span class="line">    <span class="comment">// 这是一个抽象方法，更新菜单可见性时会调用</span></span><br><span class="line">    <span class="meta">@available</span>(iOS <span class="number">14.0</span>, *)</span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">updateVisibleMenu</span><span class="params">(<span class="number">_</span> block: <span class="params">(UIMenu)</span></span></span> -&gt; <span class="type">UIMenu</span>)</span><br><span class="line">    <span class="comment">// 将当前已经显示的菜单隐藏掉</span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">dismissMenu</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>具体弹出的预览视图和菜单项，需要在代理方法中进行设置，UIContextMenuInteractionDelegate中定义的方法如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">13.0</span>, *)</span><br><span class="line">@<span class="type">MainActor</span> <span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">UIContextMenuInteractionDelegate</span> : <span class="title">NSObjectProtocol</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 配置菜单和预览项，UIContextMenuConfiguration后面介绍</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">contextMenuInteraction</span><span class="params">(<span class="number">_</span> interaction: UIContextMenuInteraction, configurationForMenuAtLocation location: CGPoint)</span></span> -&gt; <span class="type">UIContextMenuConfiguration</span>?</span><br><span class="line">    <span class="meta">@available</span>(iOS <span class="number">16.0</span>, *)</span><br><span class="line">    <span class="comment">// 上下文交互开始时回调</span></span><br><span class="line">    <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">contextMenuInteraction</span><span class="params">(<span class="number">_</span> interaction: UIContextMenuInteraction, configuration: UIContextMenuConfiguration, highlightPreviewForItemWithIdentifier identifier: any NSCopying)</span></span> -&gt; <span class="type">UITargetedPreview</span>?</span><br><span class="line">    <span class="comment">// 上下文交互消失时回调</span></span><br><span class="line">    <span class="meta">@available</span>(iOS <span class="number">16.0</span>, *)</span><br><span class="line">    <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">contextMenuInteraction</span><span class="params">(<span class="number">_</span> interaction: UIContextMenuInteraction, configuration: UIContextMenuConfiguration, dismissalPreviewForItemWithIdentifier identifier: any NSCopying)</span></span> -&gt; <span class="type">UITargetedPreview</span>?</span><br><span class="line">    <span class="comment">// 预览操作开始时回调</span></span><br><span class="line">    <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">contextMenuInteraction</span><span class="params">(<span class="number">_</span> interaction: UIContextMenuInteraction, willPerformPreviewActionForMenuWith configuration: UIContextMenuConfiguration, animator: any UIContextMenuInteractionCommitAnimating)</span></span></span><br><span class="line">    <span class="comment">// 菜单开始显示时回调</span></span><br><span class="line">    <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">contextMenuInteraction</span><span class="params">(<span class="number">_</span> interaction: UIContextMenuInteraction, willDisplayMenuFor configuration: UIContextMenuConfiguration, animator: <span class="params">(any UIContextMenuInteractionAnimating)</span></span></span>?)</span><br><span class="line">    <span class="comment">// 交互结束时回调</span></span><br><span class="line">    <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">contextMenuInteraction</span><span class="params">(<span class="number">_</span> interaction: UIContextMenuInteraction, willEndFor configuration: UIContextMenuConfiguration, animator: <span class="params">(any UIContextMenuInteractionAnimating)</span></span></span>?)</span><br><span class="line">    <span class="comment">// 配置菜单高亮时使用的预览视图</span></span><br><span class="line">    <span class="meta">@available</span>(iOS, introduced: <span class="number">13.0</span>, deprecated: <span class="number">16.0</span>)</span><br><span class="line">    <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">contextMenuInteraction</span><span class="params">(<span class="number">_</span> interaction: UIContextMenuInteraction, previewForHighlightingMenuWithConfiguration configuration: UIContextMenuConfiguration)</span></span> -&gt; <span class="type">UITargetedPreview</span>?</span><br><span class="line">    <span class="comment">// 配置菜单隐藏时使用的预览视图</span></span><br><span class="line">    <span class="meta">@available</span>(iOS, introduced: <span class="number">13.0</span>, deprecated: <span class="number">16.0</span>)</span><br><span class="line">    <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">contextMenuInteraction</span><span class="params">(<span class="number">_</span> interaction: UIContextMenuInteraction, previewForDismissingMenuWithConfiguration configuration: UIContextMenuConfiguration)</span></span> -&gt; <span class="type">UITargetedPreview</span>?</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中UIContextMenuConfiguration类用来做具体的交互配置，如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">13.0</span>, *)</span><br><span class="line">@<span class="type">MainActor</span> <span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">UIContextMenuConfiguration</span> : <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 唯一标识</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> identifier: any <span class="type">NSCopying</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 一组标识符，标识每个副项</span></span><br><span class="line">    <span class="meta">@available</span>(iOS <span class="number">16.0</span>, *)</span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> secondaryItemIdentifiers: <span class="type">Set</span>&lt;<span class="type">AnyHashable</span>&gt;</span><br><span class="line">    <span class="comment">// 徽章数</span></span><br><span class="line">    <span class="meta">@available</span>(iOS <span class="number">16.0</span>, *)</span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> badgeCount: <span class="type">Int</span></span><br><span class="line">    <span class="comment">// 排序</span></span><br><span class="line">    <span class="meta">@available</span>(iOS <span class="number">16.0</span>, *)</span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> preferredMenuElementOrder: <span class="type">UIContextMenuConfiguration</span>.<span class="type">ElementOrder</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@available</span>(iOS <span class="number">13.0</span>, tvOS <span class="number">17.0</span>, *)</span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIContextMenuConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 初始化方法，配置预览视图与一组菜单项</span></span><br><span class="line">    @<span class="type">MainActor</span> <span class="keyword">public</span> <span class="keyword">convenience</span> <span class="keyword">init</span>(identifier: (any <span class="type">NSCopying</span>)? = <span class="literal">nil</span>, previewProvider: <span class="type">UIContextMenuContentPreviewProvider</span>? = <span class="literal">nil</span>, actionProvider: <span class="type">UIContextMenuActionProvider</span>? = <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="UIEditMenuInteraction编辑类菜单交互"><a href="#UIEditMenuInteraction编辑类菜单交互" class="headerlink" title="UIEditMenuInteraction编辑类菜单交互"></a>UIEditMenuInteraction编辑类菜单交互</h2><p>UIEditMenuInteraction是对UIMenuController的一种代替，UIEditMenuInteraction的整体设计架构更加合理，使用也更加直观简单。默认UITextView与UITextField已经集成了UIEditMenuInteraction交互。UIEditMenuInteraction交互用来提供诸如剪切、拷贝、粘贴等编辑选项。</p>
<p>示例如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">UIEditMenuInteractionDelegate</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">editMenuInteraction</span><span class="params">(<span class="number">_</span> interaction: UIEditMenuInteraction, menuFor configuration: UIEditMenuConfiguration, suggestedActions: [UIMenuElement])</span></span> -&gt; <span class="type">UIMenu</span>? &#123;</span><br><span class="line">        <span class="comment">// 进行菜单项的配置</span></span><br><span class="line">        <span class="keyword">let</span> favorite = <span class="type">UIAction</span>(title: <span class="string">"Favorite"</span>) &#123; <span class="number">_</span> <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"favorite"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> share = <span class="type">UIAction</span>(title: <span class="string">"Share"</span>) &#123; <span class="number">_</span> <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"share"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> delete = <span class="type">UIAction</span>(title: <span class="string">"Delete"</span>, attributes: [.destructive]) &#123; <span class="number">_</span> <span class="keyword">in</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"delete"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">UIMenu</span>(children: [favorite, share, delete])</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> imageView = <span class="type">UIImageView</span>(image: <span class="type">UIImage</span>(named: <span class="string">"img"</span>))</span><br><span class="line">    <span class="keyword">var</span> interaction: <span class="type">UIEditMenuInteraction</span>!</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        interaction = <span class="type">UIEditMenuInteraction</span>(delegate: <span class="keyword">self</span>)</span><br><span class="line">        imageView.isUserInteractionEnabled = <span class="literal">true</span></span><br><span class="line">        imageView.layer.masksToBounds = <span class="literal">true</span></span><br><span class="line">        imageView.contentMode = .scaleAspectFill</span><br><span class="line">        view.addSubview(imageView)</span><br><span class="line">        imageView.frame = <span class="type">CGRect</span>(x: view.frame.width / <span class="number">2</span> - <span class="number">150</span>, y: view.frame.height / <span class="number">2</span> - <span class="number">150</span>, width: <span class="number">300.0</span>, height: <span class="number">300.0</span>)</span><br><span class="line">        <span class="comment">// 为图片控件添加UIEditMenuInteraction交互</span></span><br><span class="line">        imageView.addInteraction(interaction)</span><br><span class="line">        <span class="keyword">let</span> longPress = <span class="type">UILongPressGestureRecognizer</span>(target: <span class="keyword">self</span>, action: #selector(didLongPress(<span class="number">_</span>:)))</span><br><span class="line">        imageView.addGestureRecognizer(longPress)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@objc</span> <span class="function"><span class="keyword">func</span> <span class="title">didLongPress</span><span class="params">(<span class="number">_</span> recognizer: UIGestureRecognizer)</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> location = recognizer.location(<span class="keyword">in</span>: imageView)</span><br><span class="line">        <span class="keyword">let</span> configuration = <span class="type">UIEditMenuConfiguration</span>(identifier: <span class="literal">nil</span>, sourcePoint: location)</span><br><span class="line">        <span class="comment">// 使用交互对象弹出菜单</span></span><br><span class="line">        interaction.presentEditMenu(with: configuration)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面代码中，对UIImageView视图添加了一个长按手势，手势触发时，弹出编辑菜单。效果如下图：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-eb33ad55714e3e6798125142a5ae30c5662.png" alt></p>
<p>UIEditMenuInteraction类解析如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">16.0</span>, *)</span><br><span class="line">@<span class="type">MainActor</span> <span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">UIEditMenuInteraction</span> : <span class="title">NSObject</span>, <span class="title">UIInteraction</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 初始化方法，设置代理</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(delegate: (any <span class="type">UIEditMenuInteractionDelegate</span>)?)</span><br><span class="line">    <span class="comment">// 弹出编辑菜单</span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">presentEditMenu</span><span class="params">(with configuration: UIEditMenuConfiguration)</span></span></span><br><span class="line">    <span class="comment">// 隐藏菜单</span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">dismissMenu</span><span class="params">()</span></span></span><br><span class="line">    <span class="comment">// 刷新可见的菜单</span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">reloadVisibleMenu</span><span class="params">()</span></span></span><br><span class="line">    <span class="comment">// 刷新可见菜单位置，可以带动画</span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">updateVisibleMenuPosition</span><span class="params">(animated: Bool)</span></span></span><br><span class="line">    <span class="comment">// 获取交互点的坐标</span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">location</span><span class="params">(<span class="keyword">in</span> view: UIView?)</span></span> -&gt; <span class="type">CGPoint</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>UIEditMenuInteractionDelegate代理对菜单的数据源进行提供，并有生命周期的相关回调：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">16.0</span>, *)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">UIEditMenuInteractionDelegate</span> : <span class="title">NSObjectProtocol</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 配置菜单</span></span><br><span class="line">    <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">editMenuInteraction</span><span class="params">(<span class="number">_</span> interaction: UIEditMenuInteraction, menuFor configuration: UIEditMenuConfiguration, suggestedActions: [UIMenuElement])</span></span> -&gt; <span class="type">UIMenu</span>?</span><br><span class="line">    <span class="comment">// 配置菜单展示的位置</span></span><br><span class="line">    <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">editMenuInteraction</span><span class="params">(<span class="number">_</span> interaction: UIEditMenuInteraction, targetRectFor configuration: UIEditMenuConfiguration)</span></span> -&gt; <span class="type">CGRect</span></span><br><span class="line">    <span class="comment">// 交互即将弹出菜单时的回调</span></span><br><span class="line">    <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">editMenuInteraction</span><span class="params">(<span class="number">_</span> interaction: UIEditMenuInteraction, willPresentMenuFor configuration: UIEditMenuConfiguration, animator: any UIEditMenuInteractionAnimating)</span></span></span><br><span class="line">    <span class="comment">// 交互即将隐藏菜单时的回调</span></span><br><span class="line">    <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">editMenuInteraction</span><span class="params">(<span class="number">_</span> interaction: UIEditMenuInteraction, willDismissMenuFor configuration: UIEditMenuConfiguration, animator: any UIEditMenuInteractionAnimating)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="UIFindInteraction文本查找替换交互"><a href="#UIFindInteraction文本查找替换交互" class="headerlink" title="UIFindInteraction文本查找替换交互"></a>UIFindInteraction文本查找替换交互</h2><p>UIFindInteraction顾名思义，用来进行查找相关的交互，其提供了一个系统的查找面板，可以在文本展示类控件中进行文本的查找或替换操作。默认系统的UITextView，WKWebView与PDFView都集成了此交互，只需要将其isFindInteractionEnabled属性设置为true即可。另外，对于完全自定义的文本渲染类组件，如果要实现此交互，则需要手动实现一个文本查找的协议，这里我们只看下如何使用系统提供的这些类来实现UIFindInteraction交互。</p>
<p>示例代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</span><br><span class="line">    <span class="built_in">lazy</span> <span class="keyword">var</span> textView: <span class="type">UITextView</span> = &#123;</span><br><span class="line">        <span class="keyword">let</span> textView = <span class="type">UITextView</span>(frame: <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">200</span>, width: view.bounds.width, height: <span class="number">600</span>))</span><br><span class="line">        textView.text = <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">        UIInteraction是iOS开发框架中提供的一个协议，此协议可以为视图增加非常强大的交互能力，例如进行文字的识别和提取，图片的分析、物理按键的拍摄处理等等。本章将总结目前系统提供的遵守了UIInteraction协议的交互类，介绍这些系统交互的使用方法，希望可以对你有所启发，将这些能力应用到具体的业务场景中去。</span></span><br><span class="line"><span class="string">        "</span><span class="string">""</span></span><br><span class="line">        textView.center = view.center</span><br><span class="line">        <span class="comment">// 打开UIFindInteraction</span></span><br><span class="line">        textView.isFindInteractionEnabled = <span class="literal">true</span></span><br><span class="line">        <span class="comment">// 添加长按手势</span></span><br><span class="line">        <span class="keyword">let</span> longPress = <span class="type">UILongPressGestureRecognizer</span>(target: <span class="keyword">self</span>, action: #selector(didLongPress))</span><br><span class="line">        textView.addGestureRecognizer(longPress)</span><br><span class="line">        <span class="keyword">return</span> textView</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        view.addSubview(textView)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// MARK: 长按手势响应事件</span></span><br><span class="line">    <span class="meta">@objc</span> <span class="function"><span class="keyword">func</span> <span class="title">didLongPress</span><span class="params">(<span class="number">_</span> recognizer: UIGestureRecognizer)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 弹出查找和替换面板 会弹出键盘</span></span><br><span class="line">        textView.findInteraction?.presentFindNavigator(showingReplace: <span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">touchesBegan</span><span class="params">(<span class="number">_</span> touches: Set&lt;UITouch&gt;, with event: UIEvent?)</span></span> &#123;</span><br><span class="line">        <span class="comment">// 退出面板</span></span><br><span class="line">        textView.findInteraction?.dismissFindNavigator()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行代码，在文本区域长按，效果如下图所示：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-d2e3457f23b3375d56b8c87391eacab9345.png" alt></p>
<p>如果进行文本替换，会直接对UITextView中的内容进行修改。UIFindInteraction相对复杂，其中常用属性方法列举如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">16.0</span>, *)</span><br><span class="line">@<span class="type">MainActor</span> <span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">UIFindInteraction</span> : <span class="title">NSObject</span>, <span class="title">UIInteraction</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 查找的交互UI是否可见</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> isFindNavigatorVisible: <span class="type">Bool</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 当前激活的UIFindSession，UIFindSession具体用来进行管理查找功能</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> activeFindSession: <span class="type">UIFindSession</span>? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="comment">// 要查找的文本</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> searchText: <span class="type">String</span>?</span><br><span class="line">    <span class="comment">// 替换为的文本</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> replacementText: <span class="type">String</span>?</span><br><span class="line">    <span class="comment">// 可选的菜单</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> optionsMenuProvider: (([<span class="type">UIMenuElement</span>]) -&gt; <span class="type">UIMenu</span>?)?</span><br><span class="line">    <span class="comment">// 代理与初始化方法</span></span><br><span class="line">    <span class="keyword">weak</span> <span class="keyword">open</span> <span class="keyword">var</span> delegate: (any <span class="type">UIFindInteractionDelegate</span>)? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(sessionDelegate: any <span class="type">UIFindInteractionDelegate</span>)</span><br><span class="line">    <span class="comment">// 弹出查找面板，可选是否支持替换</span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">presentFindNavigator</span><span class="params">(showingReplace: Bool)</span></span></span><br><span class="line">    <span class="comment">// 隐藏查找面板</span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">dismissFindNavigator</span><span class="params">()</span></span></span><br><span class="line">    <span class="comment">// 使用代码查找下一个结果</span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">findNext</span><span class="params">()</span></span></span><br><span class="line">    <span class="comment">// 使用代码查找上一个结果</span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">findPrevious</span><span class="params">()</span></span></span><br><span class="line">    <span class="comment">// 更新结果数量</span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">updateResultCount</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>UIFindInteractionDelegat定义如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">16.0</span>, *)</span><br><span class="line">@<span class="type">MainActor</span> <span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">UIFindInteractionDelegate</span> : <span class="title">NSObjectProtocol</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 提供UIFindSession对象，管理查找</span></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">findInteraction</span><span class="params">(<span class="number">_</span> interaction: UIFindInteraction, sessionFor view: UIView)</span></span> -&gt; <span class="type">UIFindSession</span>?</span><br><span class="line">    <span class="comment">// 交互开始时的回调</span></span><br><span class="line">    <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">findInteraction</span><span class="params">(<span class="number">_</span> interaction: UIFindInteraction, didBegin session: UIFindSession)</span></span></span><br><span class="line">    <span class="comment">// 交互结束时的回调</span></span><br><span class="line">    <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">findInteraction</span><span class="params">(<span class="number">_</span> interaction: UIFindInteraction, didEnd session: UIFindSession)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中UIFindSession一般无需我们单独实现，如果使用的文本组件非上述的三种，则需要手动实现UIFindSession功能。</p>
<h2 id="UILargeContentViewerInteraction大内容查看交互"><a href="#UILargeContentViewerInteraction大内容查看交互" class="headerlink" title="UILargeContentViewerInteraction大内容查看交互"></a>UILargeContentViewerInteraction大内容查看交互</h2><p>UILargeContentViewerInteraction会用在无障碍相关的功能中，iOS设备会为视觉障碍用户提供无障碍功能，在系统的设置中可以使用放大字体，如此设置后，即可对动态大小的字体进行放大，但是动态字体的放大功能并非会作用于所有的元素，在某些元素上动态字体功能是不生效的，例如导航栏上的文字、TabBar栏上的文字等，针对这种场景，我们可以对某些视图设置UILargeContentViewerInteraction交互，在开启动态放大字体功能时，设置了UILargeContentViewerInteraction的组件产生用户行为时，会显示一个大的内容面板，此面板上的图标和文案可以提示用户此按钮的功能。</p>
<p>示例如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span>, <span class="title">UILargeContentViewerInteractionDelegate</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="keyword">let</span> l = <span class="type">UIButton</span>(type: .system)</span><br><span class="line">        l.titleLabel?.font = .systemFont(ofSize: <span class="number">10</span>)</span><br><span class="line">        l.setTitle(<span class="string">"文字很小"</span>, <span class="keyword">for</span>: .normal)</span><br><span class="line">        l.setTitleColor(.red, <span class="keyword">for</span>: .normal)</span><br><span class="line">        l.frame = <span class="type">CGRect</span>(x: view.frame.width / <span class="number">2</span> - <span class="number">50.0</span>, y: <span class="number">600</span>, width: <span class="number">100</span>, height: <span class="number">30</span>)</span><br><span class="line">        view.addSubview(l)</span><br><span class="line">        <span class="comment">// 设置开启大内容交互，以及要显示的内容和图标</span></span><br><span class="line">        l.showsLargeContentViewer = <span class="literal">true</span></span><br><span class="line">        l.largeContentTitle = <span class="string">"放大"</span></span><br><span class="line">        l.largeContentImage = <span class="type">UIImage</span>(systemName: <span class="string">"star.fill"</span>)</span><br><span class="line">        <span class="comment">// 直接添加交互即可</span></span><br><span class="line">        l.addInteraction(<span class="type">UILargeContentViewerInteraction</span>(delegate: <span class="keyword">self</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>UILargeContentViewerInteraction的使用非常简单：</p>
<p>1. 对需要的组件开启showsLargeContentViewer属性</p>
<p>2. 对要展示的大内容标题和图片进行设置</p>
<p>3. 为对应组件添加UILargeContentViewerInteraction交互</p>
<p>showsLargeContentViewer属性实际上是UILargeContentViewerItem协议中约定的，协议如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">UIView</span> : <span class="title">UILargeContentViewerItem</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 是否要开启大内容展示功能</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> showsLargeContentViewer: <span class="type">Bool</span></span><br><span class="line">    <span class="comment">// 设置标题</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> largeContentTitle: <span class="type">String</span>?</span><br><span class="line">    <span class="comment">// 设置图片</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> largeContentImage: <span class="type">UIImage</span>?</span><br><span class="line">    <span class="comment">// 设置图片是否缩放</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> scalesLargeContentImage: <span class="type">Bool</span></span><br><span class="line">    <span class="comment">// 设置图片边距</span></span><br><span class="line">    <span class="keyword">open</span> <span class="keyword">var</span> largeContentImageInsets: <span class="type">UIEdgeInsets</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>UIView类默认实现了UILargeContentViewerItem协议，因此理论上所有UIView的子类都可以直接使用UILargeContentViewerInteraction交互。</p>
<p>要对UILargeContentViewerInteraction进行测试也很简单，我们可以在真机上开启无障碍来进行测试，也可以在模拟器上运行，在Debug时对环境进行覆盖，选择动态字体，如下图：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-6f4cf30b95cc2b68dd7294455a2dd3e6987.png" alt></p>
<p>此时，在模拟器中对示例的按钮进行按住不放，即可看到大内容面板的展示效果，如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-cc23a1770e063a3d482abdf5cce1bba1edb.png" alt></p>
<p>UILargeContentViewerInteractionDelegate协议中定义了大内容面板展示的相关生命周期，如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@available</span>(iOS <span class="number">13.0</span>, *)</span><br><span class="line">@<span class="type">MainActor</span> <span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">UILargeContentViewerInteractionDelegate</span> : <span class="title">NSObjectProtocol</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 大内容交互手势结束时回调</span></span><br><span class="line">    <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">largeContentViewerInteraction</span><span class="params">(<span class="number">_</span> interaction: UILargeContentViewerInteraction, didEndOn item: <span class="params">(any UILargeContentViewerItem)</span></span></span>?, at point: <span class="type">CGPoint</span>)</span><br><span class="line">    <span class="comment">// 出发交互时的位置回调，可以返回一个实现了UILargeContentViewerItem的对象</span></span><br><span class="line">    <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">largeContentViewerInteraction</span><span class="params">(<span class="number">_</span> interaction: UILargeContentViewerInteraction, itemAt point: CGPoint)</span></span> -&gt; (any <span class="type">UILargeContentViewerItem</span>)?</span><br><span class="line">    <span class="comment">// 设置要展示大内容面板的controller</span></span><br><span class="line">    <span class="keyword">optional</span> <span class="function"><span class="keyword">func</span> <span class="title">viewController</span><span class="params">(<span class="keyword">for</span> interaction: UILargeContentViewerInteraction)</span></span> -&gt; <span class="type">UIViewController</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="UIFeedbackGenerator用户触感反馈交互"><a href="#UIFeedbackGenerator用户触感反馈交互" class="headerlink" title="UIFeedbackGenerator用户触感反馈交互"></a>UIFeedbackGenerator用户触感反馈交互</h2><p>UIFeedbackGenerator是iOS系统提供的一套触感反馈，其预定义了一些震动模式，开发者可以在不同的场景触发不同的触感反馈，增强用户的使用体验。</p>
<p>需要注意，UIFeedbackGenerator是一个抽象类，我们不能对它直接进行实例化使用，也不可以自定义其子类。系统预置了几种震动模式的子类：</p>
<ol>
<li>UIImpactFeedbackGenerator</li>
</ol>
<p>撞击类反馈，例如用户界面发生碰撞、卡槽入位等场景可以使用。</p>
<ol start="2">
<li>UISelectionFeedbackGenerator</li>
</ol>
<p>选中反馈，例如选择器选项的更改。</p>
<ol start="3">
<li>UINotificationFeedbackGenerator</li>
</ol>
<p>通知反馈，收到通知产生反馈。</p>
<ol start="4">
<li>UICanvasFeedbackGenerator</li>
</ol>
<p>画布的反馈，如参考线和标尺的到位等。</p>
<p>这几种子类的解析如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">@<span class="type">MainActor</span> <span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">UIImpactFeedbackGenerator</span> : <span class="title">UIFeedbackGenerator</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 反馈类型 强度不同</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">FeedbackStyle</span> : <span class="title">Int</span>, @<span class="title">unchecked</span> <span class="title">Sendable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> light = <span class="number">0</span></span><br><span class="line">        <span class="keyword">case</span> medium = <span class="number">1</span></span><br><span class="line">        <span class="keyword">case</span> heavy = <span class="number">2</span></span><br><span class="line">        <span class="meta">@available</span>(iOS <span class="number">13.0</span>, *)</span><br><span class="line">        <span class="keyword">case</span> soft = <span class="number">3</span></span><br><span class="line">        <span class="meta">@available</span>(iOS <span class="number">13.0</span>, *)</span><br><span class="line">        <span class="keyword">case</span> rigid = <span class="number">4</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 初始化方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">convenience</span> <span class="keyword">init</span>(style: <span class="type">UIImpactFeedbackGenerator</span>.<span class="type">FeedbackStyle</span>, view: <span class="type">UIView</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(style: <span class="type">UIImpactFeedbackGenerator</span>.<span class="type">FeedbackStyle</span>)</span><br><span class="line">    <span class="comment">// 触发反馈</span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">impactOccurred</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">impactOccurred</span><span class="params">(at location: CGPoint)</span></span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">impactOccurred</span><span class="params">(intensity: CGFloat)</span></span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">impactOccurred</span><span class="params">(intensity: CGFloat, at location: CGPoint)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@<span class="type">MainActor</span> <span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">UISelectionFeedbackGenerator</span> : <span class="title">UIFeedbackGenerator</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 触发反馈</span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">selectionChanged</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">selectionChanged</span><span class="params">(at location: CGPoint)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="type">MainActor</span> <span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">UINotificationFeedbackGenerator</span> : <span class="title">UIFeedbackGenerator</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">FeedbackType</span> : <span class="title">Int</span>, @<span class="title">unchecked</span> <span class="title">Sendable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> success = <span class="number">0</span></span><br><span class="line">        <span class="keyword">case</span> warning = <span class="number">1</span></span><br><span class="line">        <span class="keyword">case</span> error = <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 触发反馈</span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">notificationOccurred</span><span class="params">(<span class="number">_</span> notificationType: UINotificationFeedbackGenerator.FeedbackType)</span></span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">notificationOccurred</span><span class="params">(<span class="number">_</span> notificationType: UINotificationFeedbackGenerator.FeedbackType, at location: CGPoint)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="type">MainActor</span> <span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">UICanvasFeedbackGenerator</span> : <span class="title">UIFeedbackGenerator</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 触发反馈</span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">alignmentOccurred</span><span class="params">(at location: CGPoint)</span></span></span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">func</span> <span class="title">pathCompleted</span><span class="params">(at location: CGPoint)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="UIDragInteraction与UIDropInteraction拖拽交互"><a href="#UIDragInteraction与UIDropInteraction拖拽交互" class="headerlink" title="UIDragInteraction与UIDropInteraction拖拽交互"></a>UIDragInteraction与UIDropInteraction拖拽交互</h2><p>这两个交互分别处理组件的拖拽与放置，其可以在不同的应用程序间实现拖拽传输数据，非常方便。关于这两个交互的用法，在之前的文章中有详细介绍，可以参阅：</p>
<p><a href="https://my.oschina.net/u/2340880/blog/1554045" target="_blank" rel="noopener">https://my.oschina.net/u/2340880/blog/1554045</a></p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>UITextInteraction与UITextSelectionDisplayInteraction的功能都是对文本编辑类组件添加交互，UITextInteraction可以让自定义的文本输入控件实现类似系统UITextView类似的手势体验。自定义文本编辑组件需要对UITextInput协议进行实现，本身比较复杂，这里不在讨论。另外，与Apple Pencil、带鼠标指针等相关外设的交互功能，也不再继续讨论，有机会后面再聊。最后，感谢你花时间阅读本文，希望能带给你预期的收获。</p>

    </div>

    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © 微信：15137348047
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/2024/09/30/488.Server-Sent Events(SSE)协议原理与实践/" class="pre-post btn btn-default" title='Server-Sent Events(SSE)协议原理与实践'>
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">Server-Sent Events(SSE)协议原理与实践</span>
        </a>
    
    
        <a href="/2024/06/28/486.谈谈iOS中的原生物理引擎——UIDynamic的应用/" class="next-post btn btn-default" title='谈谈iOS中的原生物理引擎——UIDynamic的应用'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">谈谈iOS中的原生物理引擎——UIDynamic的应用</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
<div id="lv-container" data-id="city" data-uid="MTAyMC8zNzY0Ny8xNDE3OA==">
  <script type="text/javascript">
     (function(d, s) {
         var j, e = d.getElementsByTagName(s)[0];
         if (typeof LivereTower === 'function') { return; }
         j = d.createElement(s);
         j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
         j.async = true;
         e.parentNode.insertBefore(j, e);
     })(document, 'script');
  </script>
</div>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#UIInteraction：iOS中强大的视图交互能力"><span class="toc-text">UIInteraction：iOS中强大的视图交互能力</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#概览"><span class="toc-text">概览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AVCaptureEventInteraction相机拍照事件捕获交互"><span class="toc-text">AVCaptureEventInteraction相机拍照事件捕获交互</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ImageAnalysisInteraction图片识别交互"><span class="toc-text">ImageAnalysisInteraction图片识别交互</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UIContextMenuInteraction上下文菜单交互"><span class="toc-text">UIContextMenuInteraction上下文菜单交互</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UIEditMenuInteraction编辑类菜单交互"><span class="toc-text">UIEditMenuInteraction编辑类菜单交互</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UIFindInteraction文本查找替换交互"><span class="toc-text">UIFindInteraction文本查找替换交互</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UILargeContentViewerInteraction大内容查看交互"><span class="toc-text">UILargeContentViewerInteraction大内容查看交互</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UIFeedbackGenerator用户触感反馈交互"><span class="toc-text">UIFeedbackGenerator用户触感反馈交互</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UIDragInteraction与UIDropInteraction拖拽交互"><span class="toc-text">UIDragInteraction与UIDropInteraction拖拽交互</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#其他"><span class="toc-text">其他</span></a></li></ol></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12"> 
                <span>Copyright &copy; 2018
                </span> | 
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> | 
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



<script src="/js/app.js?rev=@@hash"></script>


</body>
</html>
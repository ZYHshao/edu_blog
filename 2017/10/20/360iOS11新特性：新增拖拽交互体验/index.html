<script src="https://eqcn.ajz.miesnfu.com/wp-content/plugins/wp-3d-pony/live2dw/lib/L2Dwidget.min.js"></script> 
<script>
　　let models = [
    "https://unpkg.com/live2d-widget-model-chitose@1.0.5/assets/chitose.model.json",
    "https://unpkg.com/live2d-widget-model-shizuku@1.0.5/assets/shizuku.model.json",
    "https://unpkg.com/live2d-widget-model-koharu@1.0.5/assets/koharu.model.json",
    "https://unpkg.com/live2d-widget-model-haruto@1.0.5/assets/haruto.model.json",
    "https://unpkg.com/live2d-widget-model-miku@1.0.5/assets/miku.model.json",
    "https://unpkg.com/live2d-widget-model-z16@1.0.5/assets/z16.model.json"
];
let m = models[Math.round(Math.random()*5)];
　　L2Dwidget.init({ 
　　"model": {jsonPath:m,"scale": 1 }, 
　　"display": { "position": "left", "width": 200, "height": 300,"hOffset": 0, "vOffset": -20 }, 
　　"mobile": { "show": true, "scale": 0.5 }, 
　　"react": { "opacityDefault": 0.7, "opacityOnHover": 0.2 } });
</script> 
<!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="珲少的技术博客">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <link rel="dns-prefetch" href="http://huishao.cc">
    <meta name="referrer" content="no-referrer">
    <!--SEO-->

<meta name="description" content="珲少的技术博客">



<meta name="keywords" content="珲少">



<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">
    <!--Title-->


<title>iOS11新特性：新增拖拽交互体验 | 珲少的技术博客</title>


    <link rel="alternate" href="/atom.xml" title="珲少的技术博客" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    





    
</head>

</html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  style="background-image:url(http://7xpw2b.com1.z0.glb.clouddn.com/hexo-sinppet/img/banner.png)"  >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='珲少'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
        	<!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
                <h2> 学如逆水行舟 </h2>
            
    	</div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://huishao.cc">珲少的技术博客</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>主页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/archives/"><i class="fa "></i>归档</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="iOS11新特性：新增拖拽交互体验">
            
	            iOS11新特性：新增拖拽交互体验
            
        </h1>
        <div class="post-meta">
    
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a href="/categories/iOS之UI控件">
            iOS之UI控件
        </a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
                
            
        </span>
    </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2017/10/20</span>
        </span>
    
</div>

            
            
    </div>
    
    <div class="post-body post-content">
        <h2 id="iOS11新特性：新增拖拽交互体验"><a href="#iOS11新特性：新增拖拽交互体验" class="headerlink" title="iOS11新特性：新增拖拽交互体验"></a>iOS11新特性：新增拖拽交互体验</h2><h3 id="一、引言"><a href="#一、引言" class="headerlink" title="一、引言"></a>一、引言</h3><pre><code>在使用PC进行操作时，你一定遇到过这样的场景，可以将图片直接拖入聊天软件进行发送，可以将文档、音乐、视频文件等文件拖入相应应用程序直接进行使用。这种拖拽操作交互极大的方便了电脑的使用。在iOS11中，你可以在iPhone或iPad上构建这种交互体验！
</code></pre><blockquote>
<p>说在前面的话：</p>
<pre><code>拖拽操作在iPad上是支持跨应用程序的，你可以从一个应用中拖取项目，通过Home键回到主界面并且打开另一个应用程序，然后将被拖拽的项目传递给这个应用程序中。在iPhone上，拖拽操作只支持当前应用程序内，你可以将某个元素从一个界面拖拽到另一个，这种维度的操作可以给设计人员更大的灵活性。

拖拽操作被设计成系统管理，开发者不需要为App申请特殊的用户权限。    
</code></pre></blockquote>
<h3 id="二、拖拽源"><a href="#二、拖拽源" class="headerlink" title="二、拖拽源"></a>二、拖拽源</h3><pre><code>对于拖拽操作，至少要有两个组件，一个组件作为拖拽源用来提供数据，一个组件作为拖拽目的用来接收数据，当前，同一个组件既可以是拖拽源也可以是拖拽目的。首先我们先来看拖拽源，在UIKit框架中，iOS11默认实现了一些组件可以作为拖拽源， 例如UITextField、UITextView、UITableView和UICollectionView等。文本组件默认支持拖拽操作进行文本的传递，对于列表组件则默认支持元素的拖拽。例如，在UITextField选中的文案中进行拖拽，可以将文字拖拽出来，效果如下图：
</code></pre><p><img src="https://static.oschina.net/uploads/space/2017/1019/143932_VCMm_2340880.png" alt></p>
<pre><code>任意的UIView组件都可以作为拖拽源，让其成为拖拽源其实也十分简单，只需要3步：
</code></pre><p>1.创建一个UIDragInteraction行为对象。</p>
<p>2.设置UIDragInteraction对象的代理并实现相应方法。</p>
<p>3.将UIDragInteraction对象添加到指定View上。</p>
<p>最简单的可拖拽组件的创建示例代码如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.dragView];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建View</span></span><br><span class="line">-(<span class="built_in">UIView</span> *)dragView&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_dragView) &#123;</span><br><span class="line">        _dragView = [[<span class="built_in">UIView</span> alloc]initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">        _dragView.backgroundColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">        [_dragView addInteraction:<span class="keyword">self</span>.dragInteraction];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _dragView;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建拖拽行为对象</span></span><br><span class="line">-(<span class="built_in">UIDragInteraction</span> *)dragInteraction&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_dragInteraction) &#123;</span><br><span class="line">        _dragInteraction = [[<span class="built_in">UIDragInteraction</span> alloc]initWithDelegate:<span class="keyword">self</span>];</span><br><span class="line">        <span class="comment">//要设置可用  注意！！！</span></span><br><span class="line">        [_dragInteraction setEnabled:<span class="literal">YES</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _dragInteraction;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//实现提供数据的代理方法</span></span><br><span class="line">- (<span class="built_in">NSArray</span>&lt;<span class="built_in">UIDragItem</span> *&gt; *)dragInteraction:(<span class="built_in">UIDragInteraction</span> *)interaction itemsForBeginningSession:(<span class="keyword">id</span>&lt;<span class="built_in">UIDragSession</span>&gt;)session&#123;</span><br><span class="line">    <span class="comment">//数据提供者</span></span><br><span class="line">    <span class="built_in">NSItemProvider</span> * provider = [[<span class="built_in">NSItemProvider</span> alloc]initWithObject:<span class="string">@"Hello World"</span>];</span><br><span class="line">    <span class="built_in">UIDragItem</span> * item = [[<span class="built_in">UIDragItem</span> alloc]initWithItemProvider:provider];</span><br><span class="line">    <span class="keyword">return</span> @[item];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的dragInteraction:代理方法用来提供要传递的数据，传递的数据必须遵守相应的承诺协议，后面会给大家介绍，这里只是简单返回了一个字符串数据Hello World，运行工程，你可以试验下，可以直接将我们自定义的视图拖拽进UITextField并在其中显示Hello World。</p>
<h3 id="三、关于UIDragInteraction类"><a href="#三、关于UIDragInteraction类" class="headerlink" title="三、关于UIDragInteraction类"></a>三、关于UIDragInteraction类</h3><pre><code>所有可以接收拖拽行为的组件都必须通过这个类实现，这个类中属性意义列举如下：
</code></pre><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//初始化方法</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithDelegate:(<span class="keyword">id</span>&lt;<span class="built_in">UIDragInteractionDelegate</span>&gt;)delegate;</span><br><span class="line"><span class="comment">//代理</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">nullable</span>, <span class="keyword">readonly</span>, <span class="keyword">weak</span>) <span class="keyword">id</span>&lt;<span class="built_in">UIDragInteractionDelegate</span>&gt; delegate;</span><br><span class="line"><span class="comment">//是否支持多种手势都接收响应</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">BOOL</span> allowsSimultaneousRecognitionDuringLift;</span><br><span class="line"><span class="comment">//设置是否有效</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">getter</span>=isEnabled) <span class="built_in">BOOL</span> enabled;</span><br><span class="line"><span class="comment">//获取默认是否有效 不同的设备这个值将有所区别</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">class</span>, <span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">getter</span>=isEnabledByDefault) <span class="built_in">BOOL</span> enabledByDefault;</span><br></pre></td></tr></table></figure>
<h3 id="四、UIDragInteractionDelegate协议"><a href="#四、UIDragInteractionDelegate协议" class="headerlink" title="四、UIDragInteractionDelegate协议"></a>四、UIDragInteractionDelegate协议</h3><pre><code>UIDragInteractionDelegate用来处理拖拽源的行为与数据。其中定义了一个必须实现的方法和许多可选实现的方法。解析如下：
</code></pre><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">这个方法是必须实现的用来返回拖拽源提供的数据</span></span><br><span class="line"><span class="comment">需要注意，这个函数需要返回一个数组，数组中可以有多个数据源</span></span><br><span class="line"><span class="comment">如果返回空数组，则拖拽行为不会开始</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="built_in">NSArray</span>&lt;<span class="built_in">UIDragItem</span> *&gt; *)dragInteraction:(<span class="built_in">UIDragInteraction</span> *)interaction itemsForBeginningSession:(<span class="keyword">id</span>&lt;<span class="built_in">UIDragSession</span>&gt;)session;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">这个方法用来自定义拖拽效果的预览视图 关于预览视图，后面会介绍</span></span><br><span class="line"><span class="comment">需要注意，系统默认会提供一个预览视图，不实现这个方法即是使用系统默认的</span></span><br><span class="line"><span class="comment">如果返回nil，则会去除预览动画</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">UITargetedDragPreview</span> *)dragInteraction:(<span class="built_in">UIDragInteraction</span> *)interaction previewForLiftingItem:(<span class="built_in">UIDragItem</span> *)item session:(<span class="keyword">id</span>&lt;<span class="built_in">UIDragSession</span>&gt;)session;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">拖拽动画即将开始时会调用此函数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)dragInteraction:(<span class="built_in">UIDragInteraction</span> *)interaction willAnimateLiftWithAnimator:(<span class="keyword">id</span>&lt;<span class="built_in">UIDragAnimating</span>&gt;)animator session:(<span class="keyword">id</span>&lt;<span class="built_in">UIDragSession</span>&gt;)session;</span><br><span class="line"><span class="comment">//拖拽行为会话即将开始时调用的方法</span></span><br><span class="line">- (<span class="keyword">void</span>)dragInteraction:(<span class="built_in">UIDragInteraction</span> *)interaction sessionWillBegin:(<span class="keyword">id</span>&lt;<span class="built_in">UIDragSession</span>&gt;)session;</span><br><span class="line"><span class="comment">//这个方法设置数据的防止是否允许数据的 移动操作，需要注意，这个只有在app内有效，跨app的操作会总是复制数据</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)dragInteraction:(<span class="built_in">UIDragInteraction</span> *)interaction sessionAllowsMoveOperation:(<span class="keyword">id</span>&lt;<span class="built_in">UIDragSession</span>&gt;)session;</span><br><span class="line"><span class="comment">//设置是否允许跨应用程序进行拖拽  ipad</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)dragInteraction:(<span class="built_in">UIDragInteraction</span> *)interaction sessionIsRestrictedToDraggingApplication:(<span class="keyword">id</span>&lt;<span class="built_in">UIDragSession</span>&gt;)session;</span><br><span class="line"><span class="comment">//设置预览视图是否显示原始大小</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)dragInteraction:(<span class="built_in">UIDragInteraction</span> *)interaction prefersFullSizePreviewsForSession:(<span class="keyword">id</span>&lt;<span class="built_in">UIDragSession</span>&gt;)session;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">当拖拽源被移动时调用，可以用如下方法获取其坐标</span></span><br><span class="line"><span class="comment">NSLog(@"%f,%f",[session locationInView:self.view].x,[session locationInView:self.view].y);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)dragInteraction:(<span class="built_in">UIDragInteraction</span> *)interaction sessionDidMove:(<span class="keyword">id</span>&lt;<span class="built_in">UIDragSession</span>&gt;)session;</span><br><span class="line"><span class="comment">//拖拽行为将要结束时调用</span></span><br><span class="line">- (<span class="keyword">void</span>)dragInteraction:(<span class="built_in">UIDragInteraction</span> *)interaction session:(<span class="keyword">id</span>&lt;<span class="built_in">UIDragSession</span>&gt;)session willEndWithOperation:(<span class="built_in">UIDropOperation</span>)operation;</span><br><span class="line"><span class="comment">//拖拽行为已经结束时调用</span></span><br><span class="line">- (<span class="keyword">void</span>)dragInteraction:(<span class="built_in">UIDragInteraction</span> *)interaction session:(<span class="keyword">id</span>&lt;<span class="built_in">UIDragSession</span>&gt;)session didEndWithOperation:(<span class="built_in">UIDropOperation</span>)operation;</span><br><span class="line"><span class="comment">//拖拽源进行了放置操作后调用</span></span><br><span class="line">- (<span class="keyword">void</span>)dragInteraction:(<span class="built_in">UIDragInteraction</span> *)interaction sessionDidTransferItems:(<span class="keyword">id</span>&lt;<span class="built_in">UIDragSession</span>&gt;)session;</span><br><span class="line"><span class="comment">//设置拖拽动作取消的视图动画 返回nil则消除动画</span></span><br><span class="line">-(<span class="keyword">nullable</span> <span class="built_in">UITargetedDragPreview</span> *)dragInteraction:(<span class="built_in">UIDragInteraction</span> *)interaction previewForCancellingItem:(<span class="built_in">UIDragItem</span> *)item withDefault:(<span class="built_in">UITargetedDragPreview</span> *)defaultPreview;</span><br><span class="line"><span class="comment">//拖拽动作即将取消时调用的方法</span></span><br><span class="line">- (<span class="keyword">void</span>)dragInteraction:(<span class="built_in">UIDragInteraction</span> *)interaction item:(<span class="built_in">UIDragItem</span> *)item willAnimateCancelWithAnimator:(<span class="keyword">id</span>&lt;<span class="built_in">UIDragAnimating</span>&gt;)animator;</span><br><span class="line"><span class="comment">//设置是否允许向拖拽中的项目添加数据</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">可以返回数据载体数组 当拖拽过程中 点击可拖拽的组件时会触发</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="built_in">NSArray</span>&lt;<span class="built_in">UIDragItem</span> *&gt; *)dragInteraction:(<span class="built_in">UIDragInteraction</span> *)interaction itemsForAddingToSession:(<span class="keyword">id</span>&lt;<span class="built_in">UIDragSession</span>&gt;)session withTouchAtPoint:(<span class="built_in">CGPoint</span>)point;</span><br><span class="line"><span class="comment">//设置允许进行拖拽中追加数据的拖拽行为会话</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="keyword">id</span>&lt;<span class="built_in">UIDragSession</span>&gt;)dragInteraction:(<span class="built_in">UIDragInteraction</span> *)interaction sessionForAddingItems:(<span class="built_in">NSArray</span>&lt;<span class="keyword">id</span>&lt;<span class="built_in">UIDragSession</span>&gt;&gt; *)sessions withTouchAtPoint:(<span class="built_in">CGPoint</span>)point;</span><br><span class="line"><span class="comment">//将要向拖拽组件中追加数据时调用</span></span><br><span class="line">- (<span class="keyword">void</span>)dragInteraction:(<span class="built_in">UIDragInteraction</span> *)interaction session:(<span class="keyword">id</span>&lt;<span class="built_in">UIDragSession</span>&gt;)session willAddItems:(<span class="built_in">NSArray</span>&lt;<span class="built_in">UIDragItem</span> *&gt; *)items forInteraction:(<span class="built_in">UIDragInteraction</span> *)addingInteraction;</span><br></pre></td></tr></table></figure>
<p>上面列举的协议方法中有关联到其他许多iOS11中新增的类，后面会一一介绍。其实，完成了以上内容的了解，你就已经可以完全随心所欲的定制拖拽源组件了。</p>
<h3 id="五、放置目的地"><a href="#五、放置目的地" class="headerlink" title="五、放置目的地"></a>五、放置目的地</h3><pre><code>拖拽源是数据的提供者，放置目的地就是数据的接收者。前面我们也实验过，将自定义的拖拽源拖拽进UITextField后，文本框中会自动填充我们提供的文本数据。同样，对于任何自定义的UIView视图，我们也可以让其成为放置目的地，需要完成如下3步：
</code></pre><p>1.创建一个UIDropInteraction行为对象。</p>
<p>2.设置UIDropInteraction对象的代理并实现协议方法。</p>
<p>3.将其添加到自定义的视图中。</p>
<pre><code>例如，我们将自定义的UILabel组件用来显示拖拽的文案：
</code></pre><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//添加视图</span></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">//有关拖拽源的代码 前面已经列举过 这里不再重复</span></span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.dragView];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.dropLabel];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-(<span class="built_in">UILabel</span> *)dropLabel&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_dropLabel) &#123;</span><br><span class="line">        _dropLabel = [[<span class="built_in">UILabel</span> alloc]initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">300</span>, <span class="number">300</span>, <span class="number">30</span>)];</span><br><span class="line">        _dropLabel.backgroundColor = [<span class="built_in">UIColor</span> greenColor];</span><br><span class="line">        _dropLabel.userInteractionEnabled = <span class="literal">YES</span>;</span><br><span class="line">        [_dropLabel addInteraction:<span class="keyword">self</span>.dropInteraction];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _dropLabel;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//放置目的地行为对象</span></span><br><span class="line">-(<span class="built_in">UIDropInteraction</span>*)dropInteraction&#123;</span><br><span class="line">    <span class="keyword">if</span> (!_dropInteraction) &#123;</span><br><span class="line">        _dropInteraction = [[<span class="built_in">UIDropInteraction</span> alloc]initWithDelegate:<span class="keyword">self</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _dropInteraction;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//这个方法返回是否响应此放置目的地的放置请求</span></span><br><span class="line">-(<span class="built_in">BOOL</span>)dropInteraction:(<span class="built_in">UIDropInteraction</span> *)interaction canHandleSession:(<span class="keyword">id</span>&lt;<span class="built_in">UIDropSession</span>&gt;)session&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//设置以何种方式响应拖放会话行为</span></span><br><span class="line">-(<span class="built_in">UIDropProposal</span> *)dropInteraction:(<span class="built_in">UIDropInteraction</span> *)interaction sessionDidUpdate:(<span class="keyword">id</span>&lt;<span class="built_in">UIDropSession</span>&gt;)session&#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="built_in">UIDropProposal</span> alloc]initWithDropOperation:<span class="built_in">UIDropOperationCopy</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//已经应用拖放行为后执行的操作</span></span><br><span class="line">-(<span class="keyword">void</span>)dropInteraction:(<span class="built_in">UIDropInteraction</span> *)interaction performDrop:(<span class="keyword">id</span>&lt;<span class="built_in">UIDropSession</span>&gt;)session&#123;</span><br><span class="line">  </span><br><span class="line">    [session loadObjectsOfClass:[<span class="built_in">NSString</span> <span class="keyword">class</span>] completion:^(<span class="built_in">NSArray</span>&lt;__kindof <span class="keyword">id</span>&lt;<span class="built_in">NSItemProviderReading</span>&gt;&gt; * _Nonnull objects) &#123;</span><br><span class="line">        <span class="keyword">self</span>.dropLabel.text = objects.firstObject;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码将我们自定义的拖拽源提供的Hello World拖放进了UILabel组件中。</p>
<h3 id="六、关于UIDropInteraction类"><a href="#六、关于UIDropInteraction类" class="headerlink" title="六、关于UIDropInteraction类"></a>六、关于UIDropInteraction类</h3><pre><code>与UIDragInteraction类类似，这个类的作用是让组件有相应放置操作的能力。其中属性如下：
</code></pre><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//初始化方法</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithDelegate:(<span class="keyword">id</span>&lt;<span class="built_in">UIDropInteractionDelegate</span>&gt;)delegate;</span><br><span class="line"><span class="comment">//代理对象</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">nullable</span>, <span class="keyword">readonly</span>, <span class="keyword">weak</span>) <span class="keyword">id</span>&lt;<span class="built_in">UIDropInteractionDelegate</span>&gt; delegate;</span><br><span class="line"><span class="comment">//是否允许多个交互行为</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> allowsSimultaneousDropSessions;</span><br></pre></td></tr></table></figure>
<h3 id="七、UIDropInteractionDelegate协议"><a href="#七、UIDropInteractionDelegate协议" class="headerlink" title="七、UIDropInteractionDelegate协议"></a>七、UIDropInteractionDelegate协议</h3><pre><code>UIDropInteractionDelegate协议中所定义的方法全部是可选实现的，其用来处理用户放置交互行为。
</code></pre><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//放置行为即将响应时触发的方法 返回值确定是否响应此次行为</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)dropInteraction:(<span class="built_in">UIDropInteraction</span> *)interaction canHandleSession:(<span class="keyword">id</span>&lt;<span class="built_in">UIDropSession</span>&gt;)session;</span><br><span class="line"><span class="comment">//当上面的协议方法返回YES时会接着调用这个函数</span></span><br><span class="line">- (<span class="keyword">void</span>)dropInteraction:(<span class="built_in">UIDropInteraction</span> *)interaction sessionDidEnter:(<span class="keyword">id</span>&lt;<span class="built_in">UIDropSession</span>&gt;)session;</span><br><span class="line"><span class="comment">//将要处理数据时回调的方法</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">当数据源数据添加时，这个方法也会被重新调用 </span></span><br><span class="line"><span class="comment">这个函数需要返回一个处理行为方式UIDropProposal对象，这个我们后面再说</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="built_in">UIDropProposal</span> *)dropInteraction:(<span class="built_in">UIDropInteraction</span> *)interaction sessionDidUpdate:(<span class="keyword">id</span>&lt;<span class="built_in">UIDropSession</span>&gt;)session;</span><br><span class="line"><span class="comment">//放置行为相应结束的时候会调用此方法</span></span><br><span class="line">- (<span class="keyword">void</span>)dropInteraction:(<span class="built_in">UIDropInteraction</span> *)interaction sessionDidExit:(<span class="keyword">id</span>&lt;<span class="built_in">UIDropSession</span>&gt;)session;</span><br><span class="line"><span class="comment">//这个方法当用户进行放置时会调用，可以从session中获取被传递的数据</span></span><br><span class="line">- (<span class="keyword">void</span>)dropInteraction:(<span class="built_in">UIDropInteraction</span> *)interaction performDrop:(<span class="keyword">id</span>&lt;<span class="built_in">UIDropSession</span>&gt;)session;</span><br><span class="line"><span class="comment">//放置动画完成后会调用这个方法</span></span><br><span class="line">- (<span class="keyword">void</span>)dropInteraction:(<span class="built_in">UIDropInteraction</span> *)interaction concludeDrop:(<span class="keyword">id</span>&lt;<span class="built_in">UIDropSession</span>&gt;)session;</span><br><span class="line"><span class="comment">//整个拖放行为结束后会调用</span></span><br><span class="line">- (<span class="keyword">void</span>)dropInteraction:(<span class="built_in">UIDropInteraction</span> *)interaction sessionDidEnd:(<span class="keyword">id</span>&lt;<span class="built_in">UIDropSession</span>&gt;)session;</span><br><span class="line"></span><br><span class="line"><span class="comment">//下面这些方法用来自定义放置动画</span></span><br><span class="line"><span class="comment">//设置放置预览动画</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">UITargetedDragPreview</span> *)dropInteraction:(<span class="built_in">UIDropInteraction</span> *)interaction previewForDroppingItem:(<span class="built_in">UIDragItem</span> *)item withDefault:(<span class="built_in">UITargetedDragPreview</span> *)defaultPreview;</span><br><span class="line"><span class="comment">//这个函数每当有一个拖拽数据项放入时都会调用一次 可以进行动画</span></span><br><span class="line">- (<span class="keyword">void</span>)dropInteraction:(<span class="built_in">UIDropInteraction</span> *)interaction item:(<span class="built_in">UIDragItem</span> *)item willAnimateDropWithAnimator:(<span class="keyword">id</span>&lt;<span class="built_in">UIDragAnimating</span>&gt;)animator;</span><br></pre></td></tr></table></figure>
<p>需要注意，UIDropProposal类用来进行处理回执，属性方法解析如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//初始化方法</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">typedef NS_ENUM(NSUInteger, UIDropOperation) &#123;</span></span><br><span class="line"><span class="comment">    //取消这次行为</span></span><br><span class="line"><span class="comment">    UIDropOperationCancel   = 0,</span></span><br><span class="line"><span class="comment">    //拒绝行为</span></span><br><span class="line"><span class="comment">    UIDropOperationForbidden = 1,</span></span><br><span class="line"><span class="comment">    //接收拷贝数据</span></span><br><span class="line"><span class="comment">    UIDropOperationCopy      = 2,</span></span><br><span class="line"><span class="comment">    //接收移动数据</span></span><br><span class="line"><span class="comment">    UIDropOperationMove      = 3,</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithDropOperation:(<span class="built_in">UIDropOperation</span>)operation;</span><br><span class="line"><span class="comment">//处理方式</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">UIDropOperation</span> operation;</span><br><span class="line"><span class="comment">//精准定位</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">getter</span>=isPrecise) <span class="built_in">BOOL</span> precise;</span><br><span class="line"><span class="comment">//设置是否展示完整的预览尺寸</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">BOOL</span> prefersFullSizePreview;</span><br></pre></td></tr></table></figure>
<h3 id="八、拖拽数据载体UIDragItem类"><a href="#八、拖拽数据载体UIDragItem类" class="headerlink" title="八、拖拽数据载体UIDragItem类"></a>八、拖拽数据载体UIDragItem类</h3><pre><code>UIDragItem类用来承载要传递的数据。其通过NSItemProvider类来进行构建，传递的数据类型是有严格规定的，必须遵守一定的协议，系统的NSString，NSAttributeString，NSURL，UIColor和UIImage是默认支持的，你可以直接传递这些数据。

UIDragItem中提供的属性方法：
</code></pre><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//初始化方法</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithItemProvider:(<span class="built_in">NSItemProvider</span> *)itemProvider;</span><br><span class="line"><span class="comment">//数据提供者实例</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) __kindof <span class="built_in">NSItemProvider</span> *itemProvider;</span><br><span class="line"><span class="comment">//用来传递一些额外的关联信息</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">nullable</span>) <span class="keyword">id</span> localObject;</span><br><span class="line"><span class="comment">//用来自定义每个item添加时的预览动画</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">nullable</span>) <span class="built_in">UIDragPreview</span> * _Nullable (^previewProvider)(<span class="keyword">void</span>);</span><br></pre></td></tr></table></figure>
<h3 id="九、UIDropSession与UIDragSession"><a href="#九、UIDropSession与UIDragSession" class="headerlink" title="九、UIDropSession与UIDragSession"></a>九、UIDropSession与UIDragSession</h3><pre><code>在与拖拽交互相关的接口中，这两个是面向协议编程的绝佳范例，首先在UIKit框架中只定义了这两个协议，而并没有相关的实现类，在拖拽行为的相关回调接口中，很多id类型的参数都遵守了这个协议，我们无需知道是哪个类实现的，直接进行使用即可：
</code></pre><p>UIDropSession：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//继承于UIDragDropSession(提供基础数据), NSProgressReporting(提供数据读取进度)</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">UIDropSession</span> &lt;<span class="title">UIDragDropSession</span>, <span class="title">NSProgressReporting</span>&gt;</span></span><br><span class="line"><span class="comment">//原始的dragSesstion会话  如果是跨应用的 则为nil</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">nullable</span>) <span class="keyword">id</span>&lt;<span class="built_in">UIDragSession</span>&gt; localDragSession;</span><br><span class="line"><span class="comment">//设置进度风格</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">typedef NS_ENUM(NSUInteger, UIDropSessionProgressIndicatorStyle) &#123;</span></span><br><span class="line"><span class="comment">    UIDropSessionProgressIndicatorStyleNone,       // 无</span></span><br><span class="line"><span class="comment">    UIDropSessionProgressIndicatorStyleDefault,    // 默认的</span></span><br><span class="line"><span class="comment">&#125; API_AVAILABLE(ios(11.0)) API_UNAVAILABLE(watchos, tvos);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">UIDropSessionProgressIndicatorStyle</span> progressIndicatorStyle;</span><br><span class="line"><span class="comment">//进行数据的加载</span></span><br><span class="line">- (<span class="built_in">NSProgress</span> *)loadObjectsOfClass:(Class&lt;<span class="built_in">NSItemProviderReading</span>&gt;)aClass completion:(<span class="keyword">void</span>(^)(<span class="built_in">NSArray</span>&lt;__kindof <span class="keyword">id</span>&lt;<span class="built_in">NSItemProviderReading</span>&gt;&gt; *objects))completion;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>UIDragSession：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">API_AVAILABLE(ios(<span class="number">11.0</span>)) API_UNAVAILABLE(watchos, tvos) <span class="class"><span class="keyword">@protocol</span> <span class="title">UIDragSession</span> &lt;<span class="title">UIDragDropSession</span>&gt;</span></span><br><span class="line"><span class="comment">//设置要传递的额外信息 只有在同个APP内可见</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">nullable</span>) <span class="keyword">id</span> localContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>UIDragDropSession：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//传递的数据数组</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">NSArray</span>&lt;<span class="built_in">UIDragItem</span> *&gt; *items;</span><br><span class="line"><span class="comment">//当前操作行为的坐标</span></span><br><span class="line">- (<span class="built_in">CGPoint</span>)locationInView:(<span class="built_in">UIView</span> *)view;</span><br><span class="line"><span class="comment">//此次行为是否允许移动操作</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">BOOL</span> allowsMoveOperation;</span><br><span class="line"><span class="comment">//是否支持应用程序层面的拖拽</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">getter</span>=isRestrictedToDraggingApplication) <span class="built_in">BOOL</span> restrictedToDraggingApplication;</span><br><span class="line"><span class="comment">//验证传递的数据是否支持某个数据类型协议</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)hasItemsConformingToTypeIdentifiers:(<span class="built_in">NSArray</span>&lt;<span class="built_in">NSString</span> *&gt; *)typeIdentifiers;</span><br><span class="line"><span class="comment">//验证传递的数据是否可以加载某个类</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)canLoadObjectsOfClass:(Class&lt;<span class="built_in">NSItemProviderReading</span>&gt;)aClass;</span><br></pre></td></tr></table></figure>
<h3 id="十、交互预览类UITargetedDragPreview"><a href="#十、交互预览类UITargetedDragPreview" class="headerlink" title="十、交互预览类UITargetedDragPreview"></a>十、交互预览类UITargetedDragPreview</h3><pre><code>UITargetedDragPreview专门用来处理拖放交互过程中的动画与预览视图。方法解析如下：
</code></pre><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建一个预览对象 </span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">view：要创建的预览视图 需要注意，这个视图必须在window上</span></span><br><span class="line"><span class="comment">param：配置参数</span></span><br><span class="line"><span class="comment">target：容器视图，用来展示预览，一般设置为view的父视图</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithView:(<span class="built_in">UIView</span> *)view parameters:(<span class="built_in">UIDragPreviewParameters</span> *)parameters target:(<span class="built_in">UIDragPreviewTarget</span> *)target;</span><br><span class="line"><span class="comment">//同上</span></span><br><span class="line">-(<span class="keyword">instancetype</span>)initWithView:(<span class="built_in">UIView</span> *)view parameters:(<span class="built_in">UIDragPreviewParameters</span> *)parameters;</span><br><span class="line"><span class="comment">//同上</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithView:(<span class="built_in">UIView</span> *)view;</span><br><span class="line"><span class="comment">//动画承载者</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">UIDragPreviewTarget</span>* target;</span><br><span class="line"><span class="comment">//动画视图</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">UIView</span> *view;</span><br><span class="line"><span class="comment">//配置参数</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>) <span class="built_in">UIDragPreviewParameters</span> *parameters;</span><br><span class="line"><span class="comment">//尺寸</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">CGSize</span> size;</span><br><span class="line"><span class="comment">//返回新的对象</span></span><br><span class="line">- (<span class="built_in">UITargetedDragPreview</span> *)retargetedPreviewWithTarget:(<span class="built_in">UIDragPreviewTarget</span> *)newTarget;</span><br></pre></td></tr></table></figure>
<p>UIDragPreviewTarget主要用来设置动画的起始视图与结束时回归的视图，其中属性方法如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">初始化方法</span></span><br><span class="line"><span class="comment">container：必须是在window上的view</span></span><br><span class="line"><span class="comment">center：动画起点与终点</span></span><br><span class="line"><span class="comment">transform:进行变换</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithContainer:(<span class="built_in">UIView</span> *)container center:(<span class="built_in">CGPoint</span>)center transform:(<span class="built_in">CGAffineTransform</span>)transform;</span><br><span class="line"><span class="comment">//同上</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithContainer:(<span class="built_in">UIView</span> *)container center:(<span class="built_in">CGPoint</span>)center;</span><br><span class="line"><span class="comment">//对应属性</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">UIView</span> *container;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">CGPoint</span> center;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">CGAffineTransform</span> transform;</span><br></pre></td></tr></table></figure>
<p>UIDragPreviewParameters用来进行拖拽动画的配置，解析如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//构造方法并设置路径矩形</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithTextLineRects:(<span class="built_in">NSArray</span>&lt;<span class="built_in">NSValue</span> <span class="comment">/* CGRect */</span> *&gt; *)textLineRects;</span><br><span class="line"><span class="comment">//显示的路径</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">nullable</span>) <span class="built_in">UIBezierPath</span> *visiblePath;</span><br><span class="line"><span class="comment">//背景色</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">null_resettable</span>) <span class="built_in">UIColor</span> *backgroundColor;</span><br></pre></td></tr></table></figure>
<p>我们可以使用任意自定义的视图来展现这个预览动画，如下图所示：</p>
<p><img src="https://static.oschina.net/uploads/space/2017/1020/163455_YC3z_2340880.png" alt></p>
<h3 id="十一、使用拖拽操作进行自定义数据的传递"><a href="#十一、使用拖拽操作进行自定义数据的传递" class="headerlink" title="十一、使用拖拽操作进行自定义数据的传递"></a>十一、使用拖拽操作进行自定义数据的传递</h3><pre><code>本篇文章到这里，其实基本的内容都已经说完了，虽然比较详细，也可能难免冗余，如果你耐着性子看到了这里，那么我首先钦佩你的毅力并且感谢你的耐心。其实，拖拽交互如果进行只能对系统的提供的数据类型进行操作则应用就局限太多。试想一下，如果我们可以通过拖拽商品来进行购买，拖拽联系人来进行发送，或者在游戏中，拖拽进行卡片的融合，装备的提炼等等这种交互操作是不是会很畅快。最后，我们就来看看如何让自定义的数据类型支持拖拽操作。

首先你需要关注两个协议，NSItemProviderWriting与NSItemProviderReading。Writing协议用来让数据支持提供给数据源，Reading协议让数据支持从数据源读出，用自定义的Person类为例：
</code></pre><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="comment">//遵守协议</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span>&lt;<span class="title">NSItemProviderWriting</span>,<span class="title">NSItemProviderReading</span>&gt;</span></span><br><span class="line"><span class="comment">//自定义内容</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>)<span class="built_in">NSString</span> * name;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>)<span class="built_in">NSUInteger</span> age;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//.m文件</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span><br><span class="line"><span class="comment">//数据归档</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">NSProgress</span> *)loadDataWithTypeIdentifier:(<span class="built_in">NSString</span> *)typeIdentifier</span><br><span class="line">                   forItemProviderCompletionHandler:(<span class="keyword">void</span> (^)(<span class="built_in">NSData</span> * _Nullable data, <span class="built_in">NSError</span> * _Nullable error))completionHandler&#123;</span><br><span class="line">    <span class="built_in">NSProgress</span> * pro = [<span class="built_in">NSProgress</span> new];</span><br><span class="line">    <span class="built_in">NSData</span> * data = [<span class="built_in">NSKeyedArchiver</span> archivedDataWithRootObject:<span class="keyword">self</span>];</span><br><span class="line">    completionHandler(data,<span class="literal">nil</span>);</span><br><span class="line">    <span class="keyword">return</span> pro;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+(<span class="built_in">NSItemProviderRepresentationVisibility</span>)itemProviderVisibilityForRepresentationWithTypeIdentifier:(<span class="built_in">NSString</span> *)typeIdentifier&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">NSItemProviderRepresentationVisibilityAll</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">NSItemProviderRepresentationVisibility</span>)itemProviderVisibilityForRepresentationWithTypeIdentifier:(<span class="built_in">NSString</span> *)typeIdentifier&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">NSItemProviderRepresentationVisibilityAll</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//提供一个标识符</span></span><br><span class="line">+(<span class="built_in">NSArray</span>&lt;<span class="built_in">NSString</span> *&gt; *)writableTypeIdentifiersForItemProvider&#123;</span><br><span class="line">    <span class="keyword">return</span> @[<span class="string">@"object"</span>];</span><br><span class="line">&#125;</span><br><span class="line">-(<span class="built_in">NSArray</span>&lt;<span class="built_in">NSString</span> *&gt; *)writableTypeIdentifiersForItemProvider&#123;</span><br><span class="line">    <span class="keyword">return</span> @[<span class="string">@"object"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithCoder:(<span class="built_in">NSCoder</span> *)coder</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.name = [coder decodeObjectForKey:<span class="string">@"name"</span>];</span><br><span class="line">        <span class="keyword">self</span>.age = [coder decodeIntegerForKey:<span class="string">@"age"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)encodeWithCoder:(<span class="built_in">NSCoder</span> *)aCoder&#123;</span><br><span class="line">    [aCoder encodeObject:<span class="keyword">self</span>.name forKey:<span class="string">@"name"</span>];</span><br><span class="line">    [aCoder encodeInteger:<span class="keyword">self</span>.age forKey:<span class="string">@"age"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//这两个是读协议</span></span><br><span class="line">+(<span class="built_in">NSArray</span>&lt;<span class="built_in">NSString</span> *&gt; *)readableTypeIdentifiersForItemProvider&#123;</span><br><span class="line">    <span class="keyword">return</span> @[<span class="string">@"object"</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//解归档返回</span></span><br><span class="line">+ (<span class="keyword">nullable</span> <span class="keyword">instancetype</span>)objectWithItemProviderData:(<span class="built_in">NSData</span> *)data</span><br><span class="line">                                     typeIdentifier:(<span class="built_in">NSString</span> *)typeIdentifier</span><br><span class="line">                                              error:(<span class="built_in">NSError</span> **)outError&#123;</span><br><span class="line">    Person * p = [<span class="built_in">NSKeyedUnarchiver</span> unarchiveObjectWithData:data];</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>需要注意，在拖放行为读取数据时的类型要对应，如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)dropInteraction:(<span class="built_in">UIDropInteraction</span> *)interaction performDrop:(<span class="keyword">id</span>&lt;<span class="built_in">UIDropSession</span>&gt;)session&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,session.items.lastObject.localObject);</span><br><span class="line">    [session loadObjectsOfClass:[Person <span class="keyword">class</span>] completion:^(<span class="built_in">NSArray</span>&lt;__kindof <span class="keyword">id</span>&lt;<span class="built_in">NSItemProviderReading</span>&gt;&gt; * _Nonnull objects) &#123;</span><br><span class="line">        <span class="keyword">self</span>.dropLabel.text = ((Person*)objects.firstObject).name;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>写了这么多，难免有疏漏与错误，欢迎指导交流</p>
</blockquote>

    </div>

    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © 微信：15137348047
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/2017/11/02/361Tkinter之Menu组件用法/" class="pre-post btn btn-default" title='Tkinter之Menu组件用法'>
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">Tkinter之Menu组件用法</span>
        </a>
    
    
        <a href="/2017/10/14/359Objective-C关于id引发的一些思考/" class="next-post btn btn-default" title='Objective-C关于id引发的一些思考'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">Objective-C关于id引发的一些思考</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
<div id="lv-container" data-id="city" data-uid="MTAyMC8zNzY0Ny8xNDE3OA==">
  <script type="text/javascript">
     (function(d, s) {
         var j, e = d.getElementsByTagName(s)[0];
         if (typeof LivereTower === 'function') { return; }
         j = d.createElement(s);
         j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
         j.async = true;
         e.parentNode.insertBefore(j, e);
     })(document, 'script');
  </script>
</div>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#iOS11新特性：新增拖拽交互体验"><span class="toc-text">iOS11新特性：新增拖拽交互体验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一、引言"><span class="toc-text">一、引言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#二、拖拽源"><span class="toc-text">二、拖拽源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#三、关于UIDragInteraction类"><span class="toc-text">三、关于UIDragInteraction类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#四、UIDragInteractionDelegate协议"><span class="toc-text">四、UIDragInteractionDelegate协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#五、放置目的地"><span class="toc-text">五、放置目的地</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#六、关于UIDropInteraction类"><span class="toc-text">六、关于UIDropInteraction类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#七、UIDropInteractionDelegate协议"><span class="toc-text">七、UIDropInteractionDelegate协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#八、拖拽数据载体UIDragItem类"><span class="toc-text">八、拖拽数据载体UIDragItem类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#九、UIDropSession与UIDragSession"><span class="toc-text">九、UIDropSession与UIDragSession</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#十、交互预览类UITargetedDragPreview"><span class="toc-text">十、交互预览类UITargetedDragPreview</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#十一、使用拖拽操作进行自定义数据的传递"><span class="toc-text">十一、使用拖拽操作进行自定义数据的传递</span></a></li></ol></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12"> 
                <span>Copyright &copy; 2018
                </span> | 
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> | 
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



<script src="/js/app.js?rev=@@hash"></script>


</body>
</html>
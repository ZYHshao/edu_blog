<script src="https://eqcn.ajz.miesnfu.com/wp-content/plugins/wp-3d-pony/live2dw/lib/L2Dwidget.min.js"></script> 
<script>
　　let models = [
    "https://unpkg.com/live2d-widget-model-chitose@1.0.5/assets/chitose.model.json",
    "https://unpkg.com/live2d-widget-model-shizuku@1.0.5/assets/shizuku.model.json",
    "https://unpkg.com/live2d-widget-model-koharu@1.0.5/assets/koharu.model.json",
    "https://unpkg.com/live2d-widget-model-haruto@1.0.5/assets/haruto.model.json",
    "https://unpkg.com/live2d-widget-model-miku@1.0.5/assets/miku.model.json",
    "https://unpkg.com/live2d-widget-model-z16@1.0.5/assets/z16.model.json"
];
let m = models[Math.round(Math.random()*5)];
　　L2Dwidget.init({ 
　　"model": {jsonPath:m,"scale": 1 }, 
　　"display": { "position": "left", "width": 200, "height": 300,"hOffset": 0, "vOffset": -20 }, 
　　"mobile": { "show": true, "scale": 0.5 }, 
　　"react": { "opacityDefault": 0.7, "opacityOnHover": 0.2 } });
</script> 
<!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="珲少的技术博客">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <link rel="dns-prefetch" href="http://huishao.cc">
    <meta name="referrer" content="no-referrer">
    <!--SEO-->

<meta name="description" content="珲少的技术博客">



<meta name="keywords" content="珲少">



<meta name="robots" content="all">
<meta name="google" content="all">
<meta name="googlebot" content="all">
<meta name="verify" content="all">
    <!--Title-->


<title>iOS开发之CoreLocation框架使用 | 珲少的技术博客</title>


    <link rel="alternate" href="/atom.xml" title="珲少的技术博客" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="/css/bootstrap.min.css?rev=3.3.7">
<link rel="stylesheet" href="/css/font-awesome.min.css?rev=4.5.0">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    





    
</head>

</html>
<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  style="background-image:url(http://7xpw2b.com1.z0.glb.clouddn.com/hexo-sinppet/img/banner.png)"  >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title='珲少'>
            <img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block">
        </a>
        <div class="branding">
        	<!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
                <h2> 学如逆水行舟 </h2>
            
    	</div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only"></span>
                        <i class="fa fa-bars"></i>
                    </span>
                    <a class="navbar-brand" href="http://huishao.cc">珲少的技术博客</a>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation" class="text-center">
                                <a href="/"><i class="fa "></i>主页</a>
                            </li>
                        
                            <li role="presentation" class="text-center">
                                <a href="/archives/"><i class="fa "></i>归档</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="iOS开发之CoreLocation框架使用">
            
	            iOS开发之CoreLocation框架使用
            
        </h1>
        <div class="post-meta">
    
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a href="/categories/iOS逻辑初窥">
            iOS逻辑初窥
        </a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
                
            
        </span>
    </span>
    

    
        
        <span class="fa-wrap">
            <i class="fa fa-clock-o"></i>
            <span class="date-meta">2018/12/26</span>
        </span>
    
</div>

            
            
    </div>
    
    <div class="post-body post-content">
        <h2 id="iOS开发之CoreLocation框架使用"><a href="#iOS开发之CoreLocation框架使用" class="headerlink" title="iOS开发之CoreLocation框架使用"></a>iOS开发之CoreLocation框架使用</h2><pre><code>CoreLocation框架是iOS开发中比较基础的一个位置信息相关框架，关于定位和地图，之前也有博客多详细的介绍。但是对于CoreLocation框架，并没有完整和细致的记录。本篇博客将剖析这个框架的结构并进行应用示例。下图为CoreLocation框架的相关类布局图：
</code></pre><p><img src="https://oscimg.oschina.net/oscnet/edb165fccdf17311fe969ceca2ae877460a.jpg" alt></p>
<p>从图中可以看到，在CoreLocation框架中除了一些数据模型，CLLocationManager作用最为重要，它是整个框架的管理中心，从图中也可以看出，CoreLocation框架功能也非常完善，常规定位，方向信息获取，室内定位，GEO编码等功能都支持。</p>
<h3 id="一、CLLocationManager管理类详解"><a href="#一、CLLocationManager管理类详解" class="headerlink" title="一、CLLocationManager管理类详解"></a>一、CLLocationManager管理类详解</h3><p>CLLocationManager作为整个CoreLocation框架的核心管理类，其第一部分功能是获取设备的功能可用性，如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取位置服务是否可用</span></span><br><span class="line">+ (<span class="built_in">BOOL</span>)locationServicesEnabled;</span><br><span class="line"><span class="comment">//获取方向信息服务是否可用</span></span><br><span class="line">+ (<span class="built_in">BOOL</span>)headingAvailable;</span><br><span class="line"><span class="comment">//获取设备是否支持显著位置更改的监听</span></span><br><span class="line">+ (<span class="built_in">BOOL</span>)significantLocationChangeMonitoringAvailable;</span><br><span class="line"><span class="comment">//获取是否支持针对某种位置区域改变的监听</span></span><br><span class="line">+ (<span class="built_in">BOOL</span>)isMonitoringAvailableForClass:(Class)regionClass;</span><br><span class="line"><span class="comment">//获取是否支持区域监听 同上面一个函数作用一致</span></span><br><span class="line">+ (<span class="built_in">BOOL</span>)regionMonitoringAvailable;</span><br><span class="line"><span class="comment">//获取区域监听是否可用 除了设备支持 还需要 用户授权</span></span><br><span class="line">+ (<span class="built_in">BOOL</span>)regionMonitoringEnabled;</span><br><span class="line"><span class="comment">//获取是否支持测距</span></span><br><span class="line">+ (<span class="built_in">BOOL</span>)isRangingAvailable;</span><br></pre></td></tr></table></figure>
<p>在使用CLLocationManager的服务之前，首先需要获取用户的授权，在iOS8之后，还需要在info.plist中添加相关的键，如下：</p>
<p><img src="https://oscimg.oschina.net/oscnet/2415e471fbf16c762802e2f00b02487190d.jpg" alt></p>
<p>上面标出的3个键，只需要设置一个，根据自己的定位要求来选择即可。</p>
<p>下面列出了与用户授权相关的方法：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取当前用户授权类型</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">CLAuthorizationStatus枚举如下：</span></span><br><span class="line"><span class="comment">kCLAuthorizationStatusNotDetermined  用户目前还没有选择</span></span><br><span class="line"><span class="comment">kCLAuthorizationStatusRestricted     当前应用尚未授权</span></span><br><span class="line"><span class="comment">kCLAuthorizationStatusDenied         用户拒绝使用位置服务</span></span><br><span class="line"><span class="comment">kCLAuthorizationStatusAuthorizedAlways 用户授权始终可以使用位置服务</span></span><br><span class="line"><span class="comment">kCLAuthorizationStatusAuthorizedWhenInUse 用户授权可以在APP使用时使用位置</span></span><br><span class="line"><span class="comment">kCLAuthorizationStatusAuthorized      用户授权使用位置  iOS8之前</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">+ (<span class="built_in">CLAuthorizationStatus</span>)authorizationStatus;</span><br><span class="line"><span class="comment">//请求在APP使用时使用用户的位置信息</span></span><br><span class="line">- (<span class="keyword">void</span>)requestWhenInUseAuthorization;</span><br><span class="line"><span class="comment">//请求始终使用用户的位置信息</span></span><br><span class="line">- (<span class="keyword">void</span>)requestAlwaysAuthorization;</span><br></pre></td></tr></table></figure>
<p>下面列举了CLLocationManager中核心的属性和方法：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置代理</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>, <span class="keyword">nullable</span>) <span class="keyword">id</span>&lt;<span class="built_in">CLLocationManagerDelegate</span>&gt; delegate;</span><br><span class="line"><span class="comment">//定位服务是否可用</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>) <span class="built_in">BOOL</span> locationServicesEnabled;</span><br><span class="line"><span class="comment">//位置服务的用途，目前这个属性不再使用，在info.plist中配置</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">copy</span>, <span class="keyword">nonatomic</span>, <span class="keyword">nullable</span>) <span class="built_in">NSString</span> *purpose;</span><br><span class="line"><span class="comment">//指定定位活动的行为</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">CLActivityTypeAutomotiveNavigation 汽车导航</span></span><br><span class="line"><span class="comment">CLActivityTypeFitness    步行</span></span><br><span class="line"><span class="comment">CLActivityTypeOtherNavigation  其他导航 如火车 轮船</span></span><br><span class="line"><span class="comment">CLActivityTypeAirborne  飞机导航</span></span><br><span class="line"><span class="comment">CLActivityTypeOther 其他类型</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CLActivityType</span> activityType;</span><br><span class="line"><span class="comment">//设置以米为单位的精度，当小于此精度的位置改变不会收到通知CLLocationDistance就是double类型</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CLLocationDistance</span> distanceFilter;</span><br><span class="line"><span class="comment">//设置预期的定位精度CLLocationAccuracy为double类型 不一定完全精准 只是设置预期</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CLLocationAccuracy</span> desiredAccuracy;</span><br><span class="line"><span class="comment">//设置是否自动暂停位置更新 根据电量等</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">BOOL</span> pausesLocationUpdatesAutomatically;</span><br><span class="line"><span class="comment">//设置是否在后台一直更新定位</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">BOOL</span> allowsBackgroundLocationUpdates;</span><br><span class="line"><span class="comment">//当后台定位时 是否显示活动指示器 在状态栏上</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">BOOL</span> showsBackgroundLocationIndicator;</span><br><span class="line"><span class="comment">//最近的一次位置信息</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">nullable</span>) <span class="built_in">CLLocation</span> *location;</span><br><span class="line"><span class="comment">//是否支持方向</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>) <span class="built_in">BOOL</span> headingAvailable;</span><br><span class="line"><span class="comment">//设置最小方向更新精度</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CLLocationDegrees</span> headingFilter;</span><br><span class="line"><span class="comment">//用来作为参考的物理设备方向</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    CLDeviceOrientationUnknown ,</span></span><br><span class="line"><span class="comment">    CLDeviceOrientationPortrait,</span></span><br><span class="line"><span class="comment">    CLDeviceOrientationPortraitUpsideDown,</span></span><br><span class="line"><span class="comment">    CLDeviceOrientationLandscapeLeft,</span></span><br><span class="line"><span class="comment">    CLDeviceOrientationLandscapeRight,</span></span><br><span class="line"><span class="comment">    CLDeviceOrientationFaceUp,</span></span><br><span class="line"><span class="comment">    CLDeviceOrientationFaceDown</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CLDeviceOrientation</span> headingOrientation;</span><br><span class="line"><span class="comment">//最近一次更新的方向信息</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">nullable</span>) <span class="built_in">CLHeading</span> *heading;</span><br><span class="line"><span class="comment">//设置最大的区域监听范围</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CLLocationDistance</span> maximumRegionMonitoringDistance;</span><br><span class="line"><span class="comment">//一组目前正在监听的范围集合</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSSet</span>&lt;__kindof <span class="built_in">CLRegion</span> *&gt; *monitoredRegions;</span><br><span class="line"><span class="comment">//返回一组支持测距的范围</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSSet</span>&lt;__kindof <span class="built_in">CLRegion</span> *&gt; *rangedRegions;</span><br><span class="line"><span class="comment">//开始更新位置信息</span></span><br><span class="line">- (<span class="keyword">void</span>)startUpdatingLocation;</span><br><span class="line"><span class="comment">//停止更新位置信息</span></span><br><span class="line">- (<span class="keyword">void</span>)stopUpdatingLocation;</span><br><span class="line"><span class="comment">//请求一次位置信息</span></span><br><span class="line">- (<span class="keyword">void</span>)requestLocation;</span><br><span class="line"><span class="comment">//开始更新方向信息</span></span><br><span class="line">- (<span class="keyword">void</span>)startUpdatingHeading;</span><br><span class="line"><span class="comment">//停止更新方向信息</span></span><br><span class="line">- (<span class="keyword">void</span>)stopUpdatingHeading;</span><br><span class="line"><span class="comment">//取消航向校准</span></span><br><span class="line">- (<span class="keyword">void</span>)dismissHeadingCalibrationDisplay;</span><br><span class="line"><span class="comment">//开始显著位置变化的监听</span></span><br><span class="line">- (<span class="keyword">void</span>)startMonitoringSignificantLocationChanges;</span><br><span class="line"><span class="comment">//停止线束位置变化的监听</span></span><br><span class="line">- (<span class="keyword">void</span>)stopMonitoringSignificantLocationChanges;</span><br><span class="line"><span class="comment">//开启范围监听</span></span><br><span class="line">- (<span class="keyword">void</span>)startMonitoringForRegion:(<span class="built_in">CLRegion</span> *)region</span><br><span class="line">                 desiredAccuracy:(<span class="built_in">CLLocationAccuracy</span>)accuracy;</span><br><span class="line">- (<span class="keyword">void</span>)startMonitoringForRegion:(<span class="built_in">CLRegion</span> *)region;</span><br><span class="line"><span class="comment">//停止范围监听</span></span><br><span class="line">- (<span class="keyword">void</span>)stopMonitoringForRegion:(<span class="built_in">CLRegion</span> *)region;</span><br><span class="line"><span class="comment">//获取指定区域的状态 会在代理回调中返回</span></span><br><span class="line">- (<span class="keyword">void</span>)requestStateForRegion:(<span class="built_in">CLRegion</span> *)region;</span><br><span class="line"><span class="comment">//开始计算信标范围  关于Beacon 是一种专门的室内定位服务</span></span><br><span class="line">- (<span class="keyword">void</span>)startRangingBeaconsInRegion:(<span class="built_in">CLBeaconRegion</span> *)region;</span><br><span class="line"><span class="comment">//停止计算信标范围</span></span><br><span class="line">- (<span class="keyword">void</span>)stopRangingBeaconsInRegion:(<span class="built_in">CLBeaconRegion</span> *)region;</span><br><span class="line"><span class="comment">//允许延迟更新  即位置改变了多少距离或者间隔了多少秒后更新</span></span><br><span class="line">- (<span class="keyword">void</span>)allowDeferredLocationUpdatesUntilTraveled:(<span class="built_in">CLLocationDistance</span>)distance</span><br><span class="line">                      timeout:(<span class="built_in">NSTimeInterval</span>)timeout;</span><br><span class="line"><span class="comment">//不允许进行延迟更新</span></span><br><span class="line">- (<span class="keyword">void</span>)disallowDeferredLocationUpdates;</span><br><span class="line"><span class="comment">//设备是否支持延迟更新</span></span><br><span class="line">+ (<span class="built_in">BOOL</span>)deferredLocationUpdatesAvailable;</span><br></pre></td></tr></table></figure>
<h3 id="二、CLLocationManagerDelegate协议"><a href="#二、CLLocationManagerDelegate协议" class="headerlink" title="二、CLLocationManagerDelegate协议"></a>二、CLLocationManagerDelegate协议</h3><pre><code>CLLocationManagerDelegate配合CLLocationManager进行使用，其中定义了管理器在提供服务时进行回调的相关函数。解析如下：
</code></pre><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//位置更新后调用的回调 会将原位置和更新后的位置信息传入</span></span><br><span class="line">- (<span class="keyword">void</span>)locationManager:(<span class="built_in">CLLocationManager</span> *)manager</span><br><span class="line">    didUpdateToLocation:(<span class="built_in">CLLocation</span> *)newLocation</span><br><span class="line">           fromLocation:(<span class="built_in">CLLocation</span> *)oldLocation;</span><br><span class="line"><span class="comment">//位置更新后调用的回调 会传入按时间排序的一组位置信息对象</span></span><br><span class="line">- (<span class="keyword">void</span>)locationManager:(<span class="built_in">CLLocationManager</span> *)manager</span><br><span class="line">     didUpdateLocations:(<span class="built_in">NSArray</span>&lt;<span class="built_in">CLLocation</span> *&gt; *)locations;</span><br><span class="line"><span class="comment">//方向信息更新后调用的回调</span></span><br><span class="line">- (<span class="keyword">void</span>)locationManager:(<span class="built_in">CLLocationManager</span> *)manager</span><br><span class="line">       didUpdateHeading:(<span class="built_in">CLHeading</span> *)newHeading;</span><br><span class="line"><span class="comment">//返回布尔值设置是否需要进行方向校准</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)locationManagerShouldDisplayHeadingCalibration:(<span class="built_in">CLLocationManager</span> *)manager;</span><br><span class="line"><span class="comment">//当监听的区域状态变化时调用</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">CLRegionState定义区域的状态</span></span><br><span class="line"><span class="comment">CLRegionStateUnknown 未知状态</span></span><br><span class="line"><span class="comment">CLRegionStateInside  进入</span></span><br><span class="line"><span class="comment">CLRegionStateOutside 出去</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)locationManager:(<span class="built_in">CLLocationManager</span> *)manager</span><br><span class="line">    didDetermineState:(<span class="built_in">CLRegionState</span>)state forRegion:(<span class="built_in">CLRegion</span> *)region ;</span><br><span class="line"><span class="comment">//区域内有新的信标可用时调用</span></span><br><span class="line">- (<span class="keyword">void</span>)locationManager:(<span class="built_in">CLLocationManager</span> *)manager</span><br><span class="line">    didRangeBeacons:(<span class="built_in">NSArray</span>&lt;<span class="built_in">CLBeacon</span> *&gt; *)beacons inRegion:(<span class="built_in">CLBeaconRegion</span> *)region;</span><br><span class="line"><span class="comment">//区域内的信标测距发生错误时调用</span></span><br><span class="line">- (<span class="keyword">void</span>)locationManager:(<span class="built_in">CLLocationManager</span> *)manager</span><br><span class="line">    rangingBeaconsDidFailForRegion:(<span class="built_in">CLBeaconRegion</span> *)region</span><br><span class="line">    withError:(<span class="built_in">NSError</span> *)error;</span><br><span class="line"><span class="comment">//进入监听区域时调用</span></span><br><span class="line">- (<span class="keyword">void</span>)locationManager:(<span class="built_in">CLLocationManager</span> *)manager</span><br><span class="line">    didEnterRegion:(<span class="built_in">CLRegion</span> *)region;</span><br><span class="line"><span class="comment">//退出监听区域时调用</span></span><br><span class="line">- (<span class="keyword">void</span>)locationManager:(<span class="built_in">CLLocationManager</span> *)manager</span><br><span class="line">    didExitRegion:(<span class="built_in">CLRegion</span> *)region;</span><br><span class="line"><span class="comment">//服务发生错误时调用</span></span><br><span class="line">- (<span class="keyword">void</span>)locationManager:(<span class="built_in">CLLocationManager</span> *)manager</span><br><span class="line">    didFailWithError:(<span class="built_in">NSError</span> *)error;</span><br><span class="line"><span class="comment">//监听区域发生错误时调用</span></span><br><span class="line">- (<span class="keyword">void</span>)locationManager:(<span class="built_in">CLLocationManager</span> *)manager</span><br><span class="line">    monitoringDidFailForRegion:(<span class="keyword">nullable</span> <span class="built_in">CLRegion</span> *)region</span><br><span class="line">    withError:(<span class="built_in">NSError</span> *)error;</span><br><span class="line"><span class="comment">//用户授权改变时调用</span></span><br><span class="line">- (<span class="keyword">void</span>)locationManager:(<span class="built_in">CLLocationManager</span> *)manager didChangeAuthorizationStatus:(<span class="built_in">CLAuthorizationStatus</span>)status;</span><br><span class="line"><span class="comment">//开启区域监听时调用</span></span><br><span class="line">- (<span class="keyword">void</span>)locationManager:(<span class="built_in">CLLocationManager</span> *)manager</span><br><span class="line">    didStartMonitoringForRegion:(<span class="built_in">CLRegion</span> *)region;</span><br><span class="line"><span class="comment">//暂停位置更新时调用</span></span><br><span class="line">- (<span class="keyword">void</span>)locationManagerDidPauseLocationUpdates:(<span class="built_in">CLLocationManager</span> *)manager;</span><br><span class="line"><span class="comment">//恢复位置更新时调用</span></span><br><span class="line">- (<span class="keyword">void</span>)locationManagerDidResumeLocationUpdates:(<span class="built_in">CLLocationManager</span> *)manager;</span><br><span class="line"><span class="comment">//延迟更新位置信息错误时调用</span></span><br><span class="line">- (<span class="keyword">void</span>)locationManager:(<span class="built_in">CLLocationManager</span> *)manager</span><br><span class="line">    didFinishDeferredUpdatesWithError:(<span class="keyword">nullable</span> <span class="built_in">NSError</span> *)error;</span><br><span class="line"><span class="comment">//如果启用了访问监听 则收到访问会调用</span></span><br><span class="line">- (<span class="keyword">void</span>)locationManager:(<span class="built_in">CLLocationManager</span> *)manager didVisit:(<span class="built_in">CLVisit</span> *)visit;</span><br></pre></td></tr></table></figure>
<h3 id="三、进行GEO编码的工具类CLGeocoder"><a href="#三、进行GEO编码的工具类CLGeocoder" class="headerlink" title="三、进行GEO编码的工具类CLGeocoder"></a>三、进行GEO编码的工具类CLGeocoder</h3><pre><code>如前所述，使用CLLocationManager获取到的位置信息是CLLocation对象，这个对象封装了经纬度等基础信息，但是在实际开发中，我们往往需要获取到的是位置的更多实际信息，比如国家，省份，城市等等，GEO编码的作用就是通过经纬度信息发起请求，获取现实意义的更多数据。CLGeocoder类解析如下：
</code></pre><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//是否正在进行GEO编码</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">getter</span>=isGeocoding) <span class="built_in">BOOL</span> geocoding;</span><br><span class="line"><span class="comment">//反地理位置信息编码 </span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">CLGeocodeCompletionHandler会传回一组标志建筑物</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)reverseGeocodeLocation:(<span class="built_in">CLLocation</span> *)location completionHandler:(<span class="built_in">CLGeocodeCompletionHandler</span>)completionHandler;</span><br><span class="line"><span class="comment">//作用同上 local用来设置区域 可以通过这个参数控制返回的语言</span></span><br><span class="line">- (<span class="keyword">void</span>)reverseGeocodeLocation:(<span class="built_in">CLLocation</span> *)location preferredLocale:(<span class="keyword">nullable</span> <span class="built_in">NSLocale</span> *)locale completionHandler:(<span class="built_in">CLGeocodeCompletionHandler</span>)completionHandler;</span><br><span class="line"></span><br><span class="line"><span class="comment">//下面这些方法通常与 AddressBook配合使用</span></span><br><span class="line"><span class="comment">//将地址信息字典进行编码 这个方法与AddressBook框架配合使用 AddressBook框架中定义这个字典</span></span><br><span class="line">- (<span class="keyword">void</span>)geocodeAddressDictionary:(<span class="built_in">NSDictionary</span> *)addressDictionary completionHandler:(<span class="built_in">CLGeocodeCompletionHandler</span>)completionHandler;</span><br><span class="line">- (<span class="keyword">void</span>)geocodeAddressString:(<span class="built_in">NSString</span> *)addressString completionHandler:(<span class="built_in">CLGeocodeCompletionHandler</span>)completionHandler;</span><br><span class="line">- (<span class="keyword">void</span>)geocodeAddressString:(<span class="built_in">NSString</span> *)addressString inRegion:(<span class="keyword">nullable</span> <span class="built_in">CLRegion</span> *)region completionHandler:(<span class="built_in">CLGeocodeCompletionHandler</span>)completionHandler;</span><br><span class="line">- (<span class="keyword">void</span>)geocodeAddressString:(<span class="built_in">NSString</span> *)addressString inRegion:(<span class="keyword">nullable</span> <span class="built_in">CLRegion</span> *)region preferredLocale:(<span class="keyword">nullable</span> <span class="built_in">NSLocale</span> *)locale completionHandler:(<span class="built_in">CLGeocodeCompletionHandler</span>)completionHandler;</span><br><span class="line"><span class="comment">//对邮编地址进行GEO编码</span></span><br><span class="line">- (<span class="keyword">void</span>)geocodePostalAddress:(<span class="built_in">CNPostalAddress</span> *)postalAddress completionHandler:(<span class="built_in">CLGeocodeCompletionHandler</span>)completionHandler;</span><br><span class="line">- (<span class="keyword">void</span>)geocodePostalAddress:(<span class="built_in">CNPostalAddress</span> *)postalAddress preferredLocale:(<span class="keyword">nullable</span> <span class="built_in">NSLocale</span> *)locale completionHandler:(<span class="built_in">CLGeocodeCompletionHandler</span>)completionHandler;</span><br><span class="line"><span class="comment">//取消编码</span></span><br><span class="line">- (<span class="keyword">void</span>)cancelGeocode;</span><br></pre></td></tr></table></figure>
<h3 id="四、位置信息模型CLLocation相关类"><a href="#四、位置信息模型CLLocation相关类" class="headerlink" title="四、位置信息模型CLLocation相关类"></a>四、位置信息模型CLLocation相关类</h3><pre><code>首先在CoreLocation框架中，位置的经纬度是由CLLocationCoordinate2D结构体描述的，这个结构体定义如下：
</code></pre><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="built_in">CLLocationCoordinate2D</span> &#123;</span><br><span class="line">    <span class="built_in">CLLocationDegrees</span> latitude; <span class="comment">//精度</span></span><br><span class="line">    <span class="built_in">CLLocationDegrees</span> longitude;<span class="comment">//维度</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>使用下面的函数可以快速的检查和创建CLLocationCoordinate2D对象：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//检查经纬度对象是否有效</span></span><br><span class="line"><span class="built_in">BOOL</span> <span class="built_in">CLLocationCoordinate2DIsValid</span>(<span class="built_in">CLLocationCoordinate2D</span> coord);</span><br><span class="line"><span class="comment">//创建对象</span></span><br><span class="line"><span class="built_in">CLLocationCoordinate2D</span> <span class="built_in">CLLocationCoordinate2DMake</span>(<span class="built_in">CLLocationDegrees</span> latitude, <span class="built_in">CLLocationDegrees</span> longitude);</span><br></pre></td></tr></table></figure>
<p>CLFloor类是一个用来描述楼层信息的模型，并不一定精准，是基于地面的粗略计算，其中属性如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CLFloor</span> : <span class="title">NSObject</span> &lt;<span class="title">NSCopying</span>, <span class="title">NSSecureCoding</span>&gt;</span></span><br><span class="line"><span class="comment">//楼层 地下室可能为负值</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSInteger</span> level;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>下面列举了CLLocation中封装的属性的方法：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//初始化方法</span></span><br><span class="line"><span class="comment">//通过经纬度初始化 CLLocationDegrees就是double类型</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithLatitude:(<span class="built_in">CLLocationDegrees</span>)latitude</span><br><span class="line">    longitude:(<span class="built_in">CLLocationDegrees</span>)longitude;</span><br><span class="line"><span class="comment">//初始化方法</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">hAccuracy设置水平方向的精确度</span></span><br><span class="line"><span class="comment">verticalAccuracy 设置垂直方向的精确度</span></span><br><span class="line"><span class="comment">timestamp 设置时间戳</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithCoordinate:(<span class="built_in">CLLocationCoordinate2D</span>)coordinate</span><br><span class="line">    altitude:(<span class="built_in">CLLocationDistance</span>)altitude</span><br><span class="line">    horizontalAccuracy:(<span class="built_in">CLLocationAccuracy</span>)hAccuracy</span><br><span class="line">    verticalAccuracy:(<span class="built_in">CLLocationAccuracy</span>)vAccuracy</span><br><span class="line">    timestamp:(<span class="built_in">NSDate</span> *)timestamp;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">course设置方向</span></span><br><span class="line"><span class="comment">speed 设置速度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithCoordinate:(<span class="built_in">CLLocationCoordinate2D</span>)coordinate</span><br><span class="line">    altitude:(<span class="built_in">CLLocationDistance</span>)altitude</span><br><span class="line">    horizontalAccuracy:(<span class="built_in">CLLocationAccuracy</span>)hAccuracy</span><br><span class="line">    verticalAccuracy:(<span class="built_in">CLLocationAccuracy</span>)vAccuracy</span><br><span class="line">    course:(<span class="built_in">CLLocationDirection</span>)course</span><br><span class="line">    speed:(<span class="built_in">CLLocationSpeed</span>)speed</span><br><span class="line">    timestamp:(<span class="built_in">NSDate</span> *)timestamp;</span><br><span class="line"><span class="comment">//获取位置对象的经纬度信息</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CLLocationCoordinate2D</span> coordinate;</span><br><span class="line"><span class="comment">//获取海波高度</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CLLocationDistance</span> altitude;</span><br><span class="line"><span class="comment">//水平方向精度</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CLLocationAccuracy</span> horizontalAccuracy;</span><br><span class="line"><span class="comment">//垂直方向精度</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CLLocationAccuracy</span> verticalAccuracy;</span><br><span class="line"><span class="comment">//方向值 0-360之间</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CLLocationDirection</span> course;</span><br><span class="line"><span class="comment">//速度  单位m/s</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CLLocationSpeed</span> speed;</span><br><span class="line"><span class="comment">//时间戳</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSDate</span> *timestamp;</span><br><span class="line"><span class="comment">//楼层信息</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>, <span class="keyword">copy</span>, <span class="keyword">nullable</span>) <span class="built_in">CLFloor</span> *floor;</span><br><span class="line"><span class="comment">//获取到某个位置之间的距离</span></span><br><span class="line">- (<span class="built_in">CLLocationDistance</span>)getDistanceFrom:(<span class="keyword">const</span> <span class="built_in">CLLocation</span> *)location;</span><br><span class="line">- (<span class="built_in">CLLocationDistance</span>)distanceFromLocation:(<span class="keyword">const</span> <span class="built_in">CLLocation</span> *)location;</span><br></pre></td></tr></table></figure>
<h3 id="五、航向信息模型CLHeading"><a href="#五、航向信息模型CLHeading" class="headerlink" title="五、航向信息模型CLHeading"></a>五、航向信息模型CLHeading</h3><pre><code>当使用CLLocationManager进行航向信息的请求时，代理回调中会获取到CLHeading对象，这个对象封装了航向相关数据，解析如下：
</code></pre><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//地磁方向0-360</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CLLocationDirection</span> magneticHeading;</span><br><span class="line"><span class="comment">//地理方向0-360</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CLLocationDirection</span> trueHeading;</span><br><span class="line"><span class="comment">//航向精度</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CLLocationDirection</span> headingAccuracy;</span><br><span class="line"><span class="comment">//x轴测量的原始值</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CLHeadingComponentValue</span> x;</span><br><span class="line"><span class="comment">//y轴测量的原始值</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CLHeadingComponentValue</span> y;</span><br><span class="line"><span class="comment">//z轴测量的原始值</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CLHeadingComponentValue</span> z;</span><br><span class="line"><span class="comment">//时间戳</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSDate</span> *timestamp;</span><br></pre></td></tr></table></figure>
<h3 id="六、地标数据模型CLPlacemark"><a href="#六、地标数据模型CLPlacemark" class="headerlink" title="六、地标数据模型CLPlacemark"></a>六、地标数据模型CLPlacemark</h3><pre><code>CLPlacemark是进行GEO编码后返回的地标对象，解析如下：
</code></pre><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//初始化方法 使用另一个placemark拷贝</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithPlacemark:(<span class="built_in">CLPlacemark</span> *) placemark;</span><br><span class="line"><span class="comment">//位置信息</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>, <span class="keyword">nullable</span>) <span class="built_in">CLLocation</span> *location;</span><br><span class="line"><span class="comment">//区域范围信息</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>, <span class="keyword">nullable</span>) <span class="built_in">CLRegion</span> *region;</span><br><span class="line"><span class="comment">//时区</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>, <span class="keyword">nullable</span>) <span class="built_in">NSTimeZone</span> *timeZone;</span><br><span class="line"><span class="comment">//地理信息字典</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>, <span class="keyword">nullable</span>) <span class="built_in">NSDictionary</span> *addressDictionary;</span><br><span class="line"><span class="comment">//地标名字</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>, <span class="keyword">nullable</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="comment">//街道名字</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>, <span class="keyword">nullable</span>) <span class="built_in">NSString</span> *thoroughfare;</span><br><span class="line"><span class="comment">//子街道名字</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>, <span class="keyword">nullable</span>) <span class="built_in">NSString</span> *subThoroughfare;</span><br><span class="line"><span class="comment">//城镇</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>, <span class="keyword">nullable</span>) <span class="built_in">NSString</span> *locality;</span><br><span class="line"><span class="comment">//子城镇</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>, <span class="keyword">nullable</span>) <span class="built_in">NSString</span> *subLocality;</span><br><span class="line"><span class="comment">//州域信息</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>, <span class="keyword">nullable</span>) <span class="built_in">NSString</span> *administrativeArea;</span><br><span class="line"><span class="comment">//子州域信息</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>, <span class="keyword">nullable</span>) <span class="built_in">NSString</span> *subAdministrativeArea;</span><br><span class="line"><span class="comment">//邮编</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>, <span class="keyword">nullable</span>) <span class="built_in">NSString</span> *postalCode;</span><br><span class="line"><span class="comment">//ISO国家编码</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>, <span class="keyword">nullable</span>) <span class="built_in">NSString</span> *ISOcountryCode;</span><br><span class="line"><span class="comment">//国家</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>, <span class="keyword">nullable</span>) <span class="built_in">NSString</span> *country;</span><br><span class="line"><span class="comment">//水域名称</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>, <span class="keyword">nullable</span>) <span class="built_in">NSString</span> *inlandWater;</span><br><span class="line"><span class="comment">//海洋名称</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>, <span class="keyword">nullable</span>) <span class="built_in">NSString</span> *ocean;</span><br><span class="line"><span class="comment">//相关的兴趣点数组</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>, <span class="keyword">nullable</span>) <span class="built_in">NSArray</span>&lt;<span class="built_in">NSString</span> *&gt; *areasOfInterest;</span><br></pre></td></tr></table></figure>
<p>在CLPlacemark对象中有封装region对象，这个对象封装区域信息，如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过中心点和半径创建区域</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initCircularRegionWithCenter:(<span class="built_in">CLLocationCoordinate2D</span>)center</span><br><span class="line">                                      radius:(<span class="built_in">CLLocationDistance</span>)radius</span><br><span class="line">                                  identifier:(<span class="built_in">NSString</span> *)identifier;</span><br><span class="line"><span class="comment">//区域中心</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CLLocationCoordinate2D</span> center;</span><br><span class="line"><span class="comment">//半径</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CLLocationDistance</span> radius;</span><br><span class="line"><span class="comment">//进入区域是否发出提醒  需要开启了位置区域监听</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> notifyOnEntry;</span><br><span class="line"><span class="comment">//离开区域是否发出提醒  需要开启了位置区域监听</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> notifyOnExit;</span><br><span class="line"><span class="comment">//检查某个点是否在区域内</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)containsCoordinate:(<span class="built_in">CLLocationCoordinate2D</span>)coordinate;</span><br></pre></td></tr></table></figure>
<p>CLRegion类还有两个子类，CLCircularRegion类用来创建圆形区域，提供了一个便捷的初始化方法，其作用和CLRegion基本一致。CLBeaconRegion专门用来支持Beacon技术，Beacon技术是室内定位技术的一种，例如商场中有很多店铺，如果有店铺部署了Beacon发射设备，则当iOS设备作为接收设备靠近时会受到通知。CLBeaconRegion除了包含基础的区域信息外，还封装了与Beacon设备相关的设备码等信息。</p>
<h3 id="七、区域访问功能"><a href="#七、区域访问功能" class="headerlink" title="七、区域访问功能"></a>七、区域访问功能</h3><pre><code>在iOS8之前，如果我们想获取用户是否在某个区域停留了一段时间是比较困难的，可能要多次定位并进行整理和分析。在iOS8后，CoreLocation框架中提供了方便的方法来处理这个问题。

首先，用户的区域停留可以理解为用户对某个区域进行了访问，开启和关闭访问监听十分方便，如下：
</code></pre><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CLLocationManager</span> (<span class="title">CLVisitExtensions</span>)</span></span><br><span class="line"><span class="comment">//开启服务</span></span><br><span class="line">- (<span class="keyword">void</span>)startMonitoringVisits;</span><br><span class="line"><span class="comment">//关闭服务</span></span><br><span class="line">- (<span class="keyword">void</span>)stopMonitoringVisits;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>开启后，当有相关的访问信息时，会回调代理中的相应函数，并且收到CLVisit对象，这个对象信息如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//访问开始时间</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>) <span class="built_in">NSDate</span> *arrivalDate;</span><br><span class="line"><span class="comment">//访问结束时间</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>, <span class="keyword">copy</span>) <span class="built_in">NSDate</span> *departureDate;</span><br><span class="line"><span class="comment">//位置</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">CLLocationCoordinate2D</span> coordinate;</span><br><span class="line"><span class="comment">//精度</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="built_in">CLLocationAccuracy</span> horizontalAccuracy;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>热爱技术，热爱生活，写代码，交朋友 珲少  QQ：316045346</p>
</blockquote>

    </div>

    <div class="post-footer">
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © 微信：15137348047
            
        </div>
        <div>
            
        </div>
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
        <a href="/2019/01/22/388iOS开发之CoreMotion框架的应用/" class="pre-post btn btn-default" title='iOS开发之CoreMotion框架的应用'>
            <i class="fa fa-angle-left fa-fw"></i><span class="hidden-lg">上一篇</span>
            <span class="hidden-xs">iOS开发之CoreMotion框架的应用</span>
        </a>
    
    
        <a href="/2018/12/22/386iOS开发之CoreImage框架使用/" class="next-post btn btn-default" title='iOS开发之CoreImage框架使用'>
            <span class="hidden-lg">下一篇</span>
            <span class="hidden-xs">iOS开发之CoreImage框架使用</span><i class="fa fa-angle-right fa-fw"></i>
        </a>
    
</div>


    <div id="comments">
        
	
<div id="lv-container" data-id="city" data-uid="MTAyMC8zNzY0Ny8xNDE3OA==">
  <script type="text/javascript">
     (function(d, s) {
         var j, e = d.getElementsByTagName(s)[0];
         if (typeof LivereTower === 'function') { return; }
         j = d.createElement(s);
         j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
         j.async = true;
         e.parentNode.insertBefore(j, e);
     })(document, 'script');
  </script>
</div>


    </div>





                </main>
                
                    <aside id="article-toc" role="navigation" class="col-md-4">
    <div class="widget">
        <h3 class="title">文章目录</h3>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#iOS开发之CoreLocation框架使用"><span class="toc-text">iOS开发之CoreLocation框架使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一、CLLocationManager管理类详解"><span class="toc-text">一、CLLocationManager管理类详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#二、CLLocationManagerDelegate协议"><span class="toc-text">二、CLLocationManagerDelegate协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#三、进行GEO编码的工具类CLGeocoder"><span class="toc-text">三、进行GEO编码的工具类CLGeocoder</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#四、位置信息模型CLLocation相关类"><span class="toc-text">四、位置信息模型CLLocation相关类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#五、航向信息模型CLHeading"><span class="toc-text">五、航向信息模型CLHeading</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#六、地标数据模型CLPlacemark"><span class="toc-text">六、地标数据模型CLPlacemark</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#七、区域访问功能"><span class="toc-text">七、区域访问功能</span></a></li></ol></li></ol>
        
    </div>
</aside>

                
            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="icon-btn hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12"> 
                <span>Copyright &copy; 2018
                </span> | 
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> | 
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



<script src="/js/app.js?rev=@@hash"></script>


</body>
</html>